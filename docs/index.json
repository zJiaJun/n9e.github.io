[
  {
    "content": " é‡‡ç”¨Docker Composeåšç¼–æ’ï¼Œç”¨äºå•æœºå¿«é€Ÿå¯åŠ¨ç¯å¢ƒåšæµ‹è¯•ï¼ŒåŒ…å«äº†MySQLã€Redisã€Prometheusã€Ibexã€Nightingaleã€Telegraf\n ä»Githubä¸‹è½½å¤œèºçš„æºç ï¼Œè¿›å…¥dockerç›®å½•ï¼Œæ‰§è¡Œdocker-compose up -då³å¯ï¼Œdocker-composeä¼šè‡ªåŠ¨æ‹‰å–é•œåƒå¹¶å¯åŠ¨ï¼ŒæŸ¥çœ‹å„ä¸ªå®¹å™¨å¯åŠ¨çŠ¶æ€ï¼Œä½¿ç”¨å‘½ä»¤docker-compose psï¼Œéƒ½æ˜¯UpçŠ¶æ€åˆ™è¡¨ç¤ºå¯åŠ¨æˆåŠŸã€‚\nå¦‚æœibexã€nserverã€nwebapiç­‰æ¨¡å—ä¸€ç›´åœ¨Restartingï¼Œå¯èƒ½æ˜¯æ•°æ®åº“å®¹å™¨å¯åŠ¨å¤ªæ…¢äº†æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå¯ä»¥æ‰§è¡Œdocker-compose downåœæ‰å†é‡æ–°å°è¯•å¯åŠ¨æµ‹è¯•ï¼Œè¿™ä¸ªé—®é¢˜å—é™äºä¸ªäººçŸ¥è¯†æ°´å¹³ä¸€ç›´ä¸çŸ¥é“å¦‚ä½•è§£å†³ï¼Œå¦‚æœæœ‰å¯¹ docker-compose æœºåˆ¶ç†Ÿæ‚‰çš„å°ä¼™ä¼´å¯ä»¥èµæ•™ä¸‹ï¼Œæ€ä¹ˆä¿è¯å„ä¸ªå®¹å™¨çš„å¯åŠ¨é¡ºåºï¼Œè¦æ±‚ MySQL è¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œå…¶ä»–çš„è¿›ç¨‹æ‰å¯åŠ¨ã€‚\n$ git clone https://github.com/didi/nightingale.git $ cd nightingale/docker $ docker-compose up -d Creating network \"docker_nightingale\" with driver \"bridge\" Creating mysql ... done Creating redis ... done Creating prometheus ... done Creating ibex ... done Creating agentd ... done Creating nwebapi ... done Creating nserver ... done Creating telegraf ... done $ docker-compose ps Name Command State Ports ---------------------------------------------------------------------------------------------------------------------------- agentd /app/ibex agentd Up 10090/tcp, 20090/tcp ibex /app/ibex server Up 0.0.0.0:10090-\u003e10090/tcp, 0.0.0.0:20090-\u003e20090/tcp mysql docker-entrypoint.sh mysqld Up 0.0.0.0:3306-\u003e3306/tcp, 33060/tcp nserver /app/n9e server Up 18000/tcp, 0.0.0.0:19000-\u003e19000/tcp nwebapi /app/n9e webapi Up 0.0.0.0:18000-\u003e18000/tcp, 19000/tcp prometheus /bin/prometheus --config.f ... Up 0.0.0.0:9090-\u003e9090/tcp redis docker-entrypoint.sh redis ... Up 0.0.0.0:6379-\u003e6379/tcp telegraf /entrypoint.sh telegraf Up 0.0.0.0:8092-\u003e8092/udp, 0.0.0.0:8094-\u003e8094/tcp, 0.0.0.0:8125-\u003e8125/udp æ›´å¤šdocker-composeç›¸å…³çŸ¥è¯†è¯·å‚è€ƒå®˜ç½‘\nWarningå¯åŠ¨æˆåŠŸä¹‹åï¼Œå»ºè®®æŠŠinitsqlç›®å½•ä¸‹çš„å†…å®¹æŒªèµ°ï¼Œè¿™æ ·ä¸‹æ¬¡é‡å¯çš„æ—¶å€™ï¼ŒDBå°±ä¸ä¼šé‡æ–°åˆå§‹åŒ–äº†ã€‚å¦åˆ™ä¸‹æ¬¡å¯åŠ¨mysqlè¿˜æ˜¯ä¼šè‡ªåŠ¨æ‰§è¡Œinitsqlä¸‹é¢çš„sqlæ–‡ä»¶å¯¼è‡´DBé‡æ–°åˆå§‹åŒ–ï¼Œé¡µé¢ä¸Šåˆ›å»ºçš„è§„åˆ™ã€ç”¨æˆ·ç­‰éƒ½ä¼šä¸¢å¤±ã€‚\ndocker-compose è¿™ç§éƒ¨ç½²æ–¹å¼ï¼Œåªæ˜¯ç”¨äºç®€å•æµ‹è¯•ï¼Œä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå½“ç„¶äº†ï¼Œå¦‚æœæ‚¨æ˜¯ docker-compose ä¸“å®¶ï¼Œå¦å½“åˆ«è®ºã€‚\n æœåŠ¡å¯åŠ¨ä¹‹åï¼Œæµè§ˆå™¨è®¿é—®nwebapiçš„ç«¯å£ï¼Œå³18000ï¼Œé»˜è®¤ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯root.2020\n",
    "description": "",
    "tags": null,
    "title": "ä½¿ç”¨Dockerå¿«é€Ÿå¯åŠ¨æµ‹è¯•",
    "uri": "/quickstart/compose/"
  },
  {
    "content": " æœ¬èŠ‚è®²è¿°å¦‚ä½•éƒ¨ç½²å•æœºç‰ˆï¼Œå•æœºç‰ˆå¯¹äºå¾ˆå¤šä¸­å°å…¬å¸è¶³å¤Ÿç”¨äº†ï¼Œç®€å•é«˜æ•ˆã€å¿«é€Ÿç›´æ¥ï¼Œå»ºè®®ä½¿ç”¨äº‘ä¸»æœºï¼Œæ€§èƒ½ä¸å¤Ÿäº†ç›´æ¥å‡é…ï¼Œå¯ä»¥åº”å¯¹æ¯ç§’ä¸ŠæŠ¥çš„æ•°æ®ç‚¹å°äº100ä¸‡çš„æƒ…å½¢ï¼Œå¦‚æœåªæ˜¯ç›‘æ§æœºå™¨ï¼ˆæ¯å°æœºå™¨æ¯ä¸ªå‘¨æœŸå¤§æ¦‚é‡‡é›†200ä¸ªæ•°æ®ç‚¹ï¼‰é‡‡é›†å‘¨æœŸé¢‘ç‡è®¾ç½®10ç§’çš„è¯ï¼Œæ”¯æ’‘ä¸Šé™æ˜¯5ä¸‡å°\n å¦‚æœä»…ä»…æ˜¯ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼ŒDocker éƒ¨ç½²æ–¹å¼æ˜¯æœ€å¿«çš„ï¼Œä¸è¿‡å¾ˆå¤šæœ‹å‹æœªå¿…æœ‰ Docker ç¯å¢ƒï¼Œå¦å¤–ä¸ºäº†å‡å°‘å¼•å…¥æ›´å¤šæŠ€æœ¯æ ˆï¼Œå¢å¼ºç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§ï¼Œæœ‰äº›æœ‹å‹å¯èƒ½ä¹Ÿä¸æ„¿æ„ç”¨ Dockerï¼Œé‚£æœ¬ç¯‡å°±æ¥è®²è§£å¦‚ä½•å¿«é€Ÿéƒ¨ç½²å•æœºç‰ˆï¼Œå•æœºç‰ˆçš„é…å¥—æ—¶åºåº“æ˜¯ä½¿ç”¨ Prometheusã€‚å¦‚æœè¦ç›‘æ§çš„æœºå™¨æœ‰å‡ åƒå°ï¼ŒæœåŠ¡æœ‰å‡ ç™¾ä¸ªï¼Œå•æœºç‰ˆçš„å®¹é‡æ— æ³•æ»¡è¶³ï¼Œå¯ä»¥ä¸Šé›†ç¾¤ç‰ˆï¼Œé›†ç¾¤ç‰ˆçš„æ—¶åºåº“å»ºè®®ä½¿ç”¨ VictoriaMetricsï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ M3DBï¼Œä¸è¿‡ M3DB çš„æ¶æ„æ›´å¤æ‚ï¼Œå¾ˆå¤šæœ‹å‹æ— æ³•æå®šï¼Œé€‰æ‹©ç®€å•çš„ VictoriaMetricsï¼Œå¯¹å¤§éƒ¨åˆ†å…¬å¸æ¥è®²ï¼Œè¶³å¤Ÿç”¨äº†ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœåŠ¡ç«¯æ¶æ„ï¼š\næŒ‰ç…§å•æœºç‰ˆæœ¬çš„è¿™ä¸ªæ¶æ„å›¾å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯éœ€è¦å®‰è£…çš„ç»„ä»¶æœ‰ï¼šMySQLã€Redisã€Prometheusã€n9e-serverã€n9e-webapiï¼ŒAgent æœ‰å¤šç§é€‰å‹ï¼Œå¯ä»¥æ˜¯ Telegrafã€Datadog-Agentã€Grafana-Agent ç­‰ï¼ŒAgent åº”è¯¥éƒ¨ç½²åœ¨æ‰€æœ‰çš„ç›®æ ‡æœºå™¨ä¸Šï¼ŒåŒ…æ‹¬æœåŠ¡ç«¯çš„è¿™å°æœºå™¨ï¼ŒExporters æ˜¯æŒ‡ Prometheus ç”Ÿæ€çš„å„ç±» Exporter é‡‡é›†å™¨ï¼Œæ¯”å¦‚ mysqld_exporterã€redis_exporterã€blackbox_exporter ç­‰ï¼Œè¿™äº› Exporter æ˜¯éå¿…é¡»çš„ï¼Œçœ‹å„è‡ªå…¬å¸çš„æƒ…å†µã€‚\nç¯å¢ƒå‡†å¤‡ ä¾èµ–çš„ç»„ä»¶æœ‰ï¼šmysqlã€redisã€prometheusï¼Œè¿™ä¸‰ä¸ªç»„ä»¶éƒ½æ˜¯å¼€æºè½¯ä»¶ï¼Œè¯·å¤§å®¶è‡ªè¡Œå®‰è£…ï¼Œå…¶ä¸­prometheusåœ¨å¯åŠ¨çš„æ—¶å€™è¦æ³¨æ„å¼€å¯ --enable-feature=remote-write-receiver è¿™é‡Œä¹Ÿæä¾›ä¸€ä¸ªå°è„šæœ¬æ¥å®‰è£…è¿™3ä¸ªç»„ä»¶ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼š\n# install prometheus mkdir -p /opt/prometheus wget https://s3-gz01.didistatic.com/n9e-pub/prome/prometheus-2.28.0.linux-amd64.tar.gz -O prometheus-2.28.0.linux-amd64.tar.gz tar xf prometheus-2.28.0.linux-amd64.tar.gz cp -far prometheus-2.28.0.linux-amd64/* /opt/prometheus/ # service  cat \u003c\u003cEOF \u003e/etc/systemd/system/prometheus.service [Unit] Description=\"prometheus\" Documentation=https://prometheus.io/ After=network.target [Service] Type=simple ExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml --storage.tsdb.path=/opt/prometheus/data --web.enable-lifecycle --enable-feature=remote-write-receiver --query.lookback-delta=2m Restart=on-failure SuccessExitStatus=0 LimitNOFILE=65536 StandardOutput=syslog StandardError=syslog SyslogIdentifier=prometheus [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable prometheus systemctl restart prometheus systemctl status prometheus # install mysql yum -y install mariadb* systemctl enable mariadb systemctl restart mariadb mysql -e \"SET PASSWORD FOR 'root'@'localhost' = PASSWORD('1234');\" # install redis yum install -y redis systemctl enable redis systemctl restart redis ä¸Šä¾‹ä¸­mysqlçš„rootå¯†ç è®¾ç½®ä¸ºäº†1234ï¼Œå»ºè®®ç»´æŒè¿™ä¸ªä¸å˜ï¼Œåç»­å°±çœå»äº†ä¿®æ”¹é…ç½®æ–‡ä»¶çš„éº»çƒ¦ã€‚\nå®‰è£…å¤œèºç»„ä»¶ mkdir -p /opt/n9e \u0026\u0026 cd /opt/n9e # å» https://github.com/didi/nightingale/releases æ‰¾æœ€æ–°ç‰ˆæœ¬çš„åŒ…ï¼Œæ–‡æ¡£é‡Œçš„åŒ…åœ°å€å¯èƒ½å·²ç»ä¸æ˜¯æœ€æ–°çš„äº† tarball=n9e-5.5.0.tar.gz urlpath=https://github.com/didi/nightingale/releases/download/v5.5.0/${tarball} wget $urlpath || exit 1 tar zxvf ${tarball} mysql -uroot -p1234 \u003c docker/initsql/a-n9e.sql nohup ./n9e server \u0026\u003e server.log \u0026 nohup ./n9e webapi \u0026\u003e webapi.log \u0026 # check logs # check port å¦‚æœå¯åŠ¨æˆåŠŸï¼Œserver é»˜è®¤ä¼šç›‘å¬åœ¨ 19000 ç«¯å£ï¼Œwebapi ä¼šç›‘å¬åœ¨ 18000 ç«¯å£ï¼Œä¸”æ—¥å¿—æ²¡æœ‰æŠ¥é”™ã€‚ä¸Šé¢ä½¿ç”¨ nohup ç®€å•æ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨ systemd æ‰˜ç®¡ï¼Œç›¸å…³ service æ–‡ä»¶å¯ä»¥åœ¨ etc/service ç›®å½•ä¸‹ï¼Œä¾›å‚è€ƒã€‚\né…ç½®æ–‡ä»¶etc/server.confå’Œetc/webapi.confä¸­éƒ½å«æœ‰ mysql çš„è¿æ¥åœ°å€é…ç½®ï¼Œæ£€æŸ¥ä¸€ä¸‹ç”¨æˆ·åå’Œå¯†ç ï¼Œprometheus å¦‚æœä½¿ç”¨ä¸Šé¢çš„è„šæœ¬å®‰è£…ï¼Œé»˜è®¤ä¼šç›‘å¬æœ¬æœº 9090 ç«¯å£ï¼Œserver.conf å’Œ webapi.conf ä¸­çš„ prometheus ç›¸å…³åœ°å€éƒ½ä¸ç”¨ä¿®æ”¹å°±æ˜¯å¯¹çš„ã€‚\nå¥½äº†ï¼Œæµè§ˆå™¨è®¿é—® webapi çš„ç«¯å£ï¼ˆé»˜è®¤æ˜¯18000ï¼‰å°±å¯ä»¥ä½“éªŒç›¸å…³åŠŸèƒ½äº†ï¼Œé»˜è®¤ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯root.2020ã€‚å¦‚æœå®‰è£…è¿‡ç¨‹å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒå…¬ä¼—å·ï¼ˆäº‘åŸç”Ÿç›‘æ§ï¼‰çš„è§†é¢‘æ•™ç¨‹ã€‚\nå¤œèºæœåŠ¡ç«¯éƒ¨ç½²å¥½äº†ï¼Œæ¥ä¸‹æ¥è¦è€ƒè™‘ç›‘æ§æ•°æ®é‡‡é›†çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯ Prometheus é‡åº¦ç”¨æˆ·ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨å„ç±» Exporter æ¥é‡‡é›†ï¼Œåªè¦æ•°æ®è¿›äº†æ—¶åºåº“äº†ï¼Œå¤œèºå°±èƒ½å¤Ÿæ¶ˆè´¹ï¼ˆåˆ¤æ–­å‘Šè­¦ã€å±•ç¤ºå›¾è¡¨ç­‰ï¼‰ï¼›å¦‚æœæƒ³å¿«é€Ÿçœ‹åˆ°æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ Telegraf æ¥é‡‡é›†ç›‘æ§æ•°æ®ï¼Œè¯·å‚è€ƒåç»­æ–‡æ¡£ç« èŠ‚ã€‚\n",
    "description": "",
    "tags": null,
    "title": "ä½¿ç”¨äºŒè¿›åˆ¶éƒ¨ç½²å•æœºç‰ˆæœåŠ¡ç«¯",
    "uri": "/quickstart/standalone/"
  },
  {
    "content": "å¦‚æœæ‚¨å¯¹Dockerçš„ä½¿ç”¨éå¸¸ç†Ÿæ‚‰ï¼Œå»ºè®®åˆ©ç”¨Docker composeçš„æ–¹å¼å¿«é€Ÿå¯åŠ¨æµ‹è¯•ï¼Œè¯·å‚è€ƒä½¿ç”¨Docker Composeå¿«é€Ÿéƒ¨ç½²ï¼Œå¦‚æœå¯¹Dockerä¸ç†Ÿæ‚‰ï¼Œé‚£å°±ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²ï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œæœ€å°çš„å¯è¿è¡Œç¯å¢ƒæ˜¯Prometheus+MySQL+Redis+Nightingaleï¼Œè¯·å‚è€ƒå¿«é€Ÿåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¯åŠ¨å•æœºç‰ˆã€‚è¿™ä¸ªæœ€å°çš„ç¯å¢ƒåªæœ‰Prometheusé‡‡é›†åˆ°çš„è‡ªèº«çš„ä¸€äº›ç›‘æ§æŒ‡æ ‡ï¼Œç•¥æ˜¾å•è–„ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥Telegrafï¼Œé‡‡é›†æœºå™¨ã€ç½‘ç»œè®¾å¤‡ã€å„ç±»ä¸­é—´ä»¶çš„æŒ‡æ ‡ï¼Œè¯·å‚è€ƒä½¿ç”¨Telegrafé‡‡é›†ç›‘æ§æ•°æ®ã€‚\nå¦‚æœå…¬å¸ä½“é‡å¾ˆå¤§ï¼Œå»ºè®®æŠŠå•æœºç‰ˆæœ¬çš„Prometheusæ›¿æ¢ä¸ºVictoriaMetricsï¼Œè¯·å‚è€ƒä½¿ç”¨VictoriaMetricsä½œä¸ºæ—¶åºåº“ã€‚æˆ–è€…ç›´æ¥éƒ¨ç½²å¤šä¸ªPrometheusï¼ŒæŒ‰ç…§ä¸šåŠ¡çº¿æˆ–è€…æŒ‰ç…§åœ°åŸŸæ¥åˆ’åˆ†é›†ç¾¤ï¼Œæ­¤æ—¶ä½ å¯èƒ½éœ€è¦æ¥å…¥å¤šä¸ªProm/VM/M3DBé›†ç¾¤ï¼Œåœ¨å¼•å…¥å¤šä¸ªTSDBçš„è¿‡ç¨‹ä¸­ï¼Œå°±è¦åŒæ­¥ä½¿ç”¨å¤œèºçš„å¤šServeréƒ¨ç½²æ¨¡å‹äº†ï¼Œè¯·å‚è€ƒç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤ç‰ˆ\n",
    "description": "",
    "tags": null,
    "title": "å®‰è£…éƒ¨ç½²",
    "uri": "/quickstart/"
  },
  {
    "content": " Telegraf æ˜¯ InfluxData å¼€æºçš„ä¸€æ¬¾é‡‡é›†å™¨ï¼Œå¯ä»¥é‡‡é›†æ“ä½œç³»ç»Ÿã€å„ç§ä¸­é—´ä»¶çš„ç›‘æ§æŒ‡æ ‡ï¼Œé‡‡é›†ç›®æ ‡åˆ—è¡¨ï¼Œçœ‹èµ·æ¥æ˜¯éå¸¸ä¸°å¯Œï¼ŒTelegrafæ˜¯ä¸€ä¸ªå¤§ä¸€ç»Ÿçš„è®¾è®¡ï¼Œå³ä¸€ä¸ªäºŒè¿›åˆ¶å¯ä»¥é‡‡é›†CPUã€å†…å­˜ã€mysqlã€mongodbã€redisã€snmpç­‰ï¼Œä¸åƒPrometheusçš„exporterï¼Œæ¯ä¸ªç›‘æ§å¯¹è±¡ä¸€ä¸ªexporterï¼Œç®¡ç†èµ·æ¥ç•¥éº»çƒ¦ã€‚ä¸€ä¸ªäºŒè¿›åˆ¶åˆ†å‘èµ·æ¥ç¡®å®æ¯”è¾ƒæ–¹ä¾¿ã€‚\n è¿™é‡Œæä¾›å¿«é€Ÿå®‰è£…çš„æ•™ç¨‹ï¼ŒTelegrafçš„æ›´å¤šçŸ¥è¯†ï¼Œè¯·å‚è€ƒTelegrafå®˜ç½‘ï¼Œç¬”è€…ä¹‹å‰ä¹Ÿå†™äº†ä¸€ä¸ªTelegrafè°ƒç ”ç¬”è®°ï¼Œè®²è§£äº†Telegrafçš„åŸºæœ¬ç”¨æ³•ï¼Œä¸€å®šè¦çœ‹ï¼ï¼ï¼ï¼Œå¤§å®¶äº¦å¯å‚è€ƒã€‚\nTelegrafä¸‹è½½åœ°å€åœ¨è¿™é‡Œï¼Œæ ¹æ®è‡ªå·±çš„å¹³å°é€‰æ‹©å¯¹åº”çš„äºŒè¿›åˆ¶ä¸‹è½½å³å¯ã€‚ç¬”è€…çš„ç¯å¢ƒæ˜¯CentOSï¼Œä¸‹é¢æ˜¯å®‰è£…è„šæœ¬ï¼Œ/opt/telegraf/telegraf.conf æ˜¯ä¸€ä¸ªç»è¿‡åˆ å‡çš„å¹²å‡€çš„é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº†opentsdb output pluginï¼Œè¿™ä¸ªpluginçš„å†™å…¥åœ°å€é…ç½®çš„æ˜¯n9e-serverï¼Œæ‰€ä»¥ï¼ŒTelegrafé‡‡é›†çš„æ•°æ®ä¼šè¢«æ¨é€ç»™n9e-serverï¼ŒäºŒè€…è´¯é€šï¼š\n#!/bin/sh  version=1.20.4 tarball=telegraf-${version}_linux_amd64.tar.gz wget https://dl.influxdata.com/telegraf/releases/$tarball tar xzvf $tarball mkdir -p /opt/telegraf cp -far telegraf-${version}/usr/bin/telegraf /opt/telegraf cat \u003c\u003cEOF \u003e /opt/telegraf/telegraf.conf [global_tags] [agent] interval = \"10s\" round_interval = true metric_batch_size = 1000 metric_buffer_limit = 10000 collection_jitter = \"0s\" flush_interval = \"10s\" flush_jitter = \"0s\" precision = \"\" hostname = \"\" omit_hostname = false [[outputs.opentsdb]] host = \"http://127.0.0.1\" port = 19000 http_batch_size = 50 http_path = \"/opentsdb/put\" debug = false separator = \"_\" [[inputs.cpu]] percpu = true totalcpu = true collect_cpu_time = false report_active = true [[inputs.disk]] ignore_fs = [\"tmpfs\", \"devtmpfs\", \"devfs\", \"iso9660\", \"overlay\", \"aufs\", \"squashfs\"] [[inputs.diskio]] [[inputs.kernel]] [[inputs.mem]] [[inputs.processes]] [[inputs.system]] fielddrop = [\"uptime_format\"] [[inputs.net]] ignore_protocol_stats = true EOF cat \u003c\u003cEOF \u003e /etc/systemd/system/telegraf.service [Unit] Description=\"telegraf\" After=network.target [Service] Type=simple ExecStart=/opt/telegraf/telegraf --config telegraf.conf WorkingDirectory=/opt/telegraf SuccessExitStatus=0 LimitNOFILE=65536 StandardOutput=syslog StandardError=syslog SyslogIdentifier=telegraf KillMode=process KillSignal=SIGQUIT TimeoutStopSec=5 Restart=always [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable telegraf systemctl restart telegraf systemctl status telegraf  Warning/opt/telegraf/telegraf.confçš„å†…å®¹æ˜¯ä¸ªåˆ å‡ç‰ˆï¼Œåªæ˜¯ä¸ºäº†è®©å¤§å®¶å¿«é€Ÿè·‘èµ·æ¥ï¼Œå¦‚æœè¦é‡‡é›†æ›´å¤šç›‘æ§å¯¹è±¡ï¼Œæ¯”å¦‚mysqlã€redisã€tomcatç­‰ï¼Œè¿˜æ˜¯è¦ä»”ç»†å»é˜…è¯»ä»tarballé‡Œè§£å‹å‡ºæ¥çš„é‚£ä¸ªé…ç½®æ–‡ä»¶ï¼Œé‚£é‡Œæœ‰å¾ˆè¯¦ç»†çš„æ³¨é‡Šï¼Œä¹Ÿå¯ä»¥å‚è€ƒå®˜æ–¹æä¾›çš„å„ä¸ªé‡‡é›†æ’ä»¶ä¸‹çš„README\n ğŸ’¡ Telegraf é‡‡é›†çš„ Linux å±‚é¢çš„ç›‘æ§æ•°æ®ï¼Œæˆ‘ä»¬æ•´ç†äº†ä¸€ä¸ªå‘Šè­¦è§„åˆ™é…ç½®ï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ï¼ŒJSONåœ¨è¿™é‡Œ ç›‘æ§å¤§ç›˜æ­£åœ¨æ•´ç†ï¼Œæœªæ¥ä¼šæ”¾åˆ° è¿™é‡Œ\n",
    "description": "",
    "tags": null,
    "title": "ä½¿ç”¨Telegrafé‡‡é›†ç›‘æ§æ•°æ®",
    "uri": "/quickstart/telegraf/"
  },
  {
    "content": " VictoriaMetrics æ¶æ„ç®€å•ï¼Œå¯é æ€§é«˜ï¼Œåœ¨æ€§èƒ½ï¼Œæˆæœ¬ï¼Œå¯æ‰©å±•æ€§æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œç¤¾åŒºæ´»è·ƒï¼Œä¸”å’Œ Prometheus ç”Ÿæ€ç»‘å®šç´§å¯†ã€‚å¤œèºæ¨èæ‚¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ VictoriaMetrics ä½œä¸ºæ—¶åºæ•°æ®åº“ã€‚\n VictoriaMetrics æä¾›å•æœºç‰ˆå’Œé›†ç¾¤ç‰ˆã€‚å¦‚æœæ‚¨çš„æ¯ç§’å†™å…¥æ•°æ®ç‚¹æ•°å°äº100ä¸‡ï¼ŒVictoriaMetrics å®˜æ–¹é»˜è®¤æ¨èæ‚¨ä½¿ç”¨å•æœºç‰ˆï¼Œå•æœºç‰ˆå¯ä»¥é€šè¿‡å¢åŠ æœåŠ¡å™¨çš„CPUæ ¸å¿ƒæ•°ï¼Œå¢åŠ å†…å­˜ï¼Œå¢åŠ IOPSæ¥è·å¾—çº¿æ€§çš„æ€§èƒ½æå‡ã€‚ä¸”å•æœºç‰ˆæ˜“äºé…ç½®å’Œè¿ç»´ã€‚\næ¥ä¸‹æ¥çš„æ–‡ç« ï¼Œä»‹ç»åœ¨å¤œèºä¸­ï¼Œä»¥ VictoriaMetrics é›†ç¾¤ç‰ˆæœ¬ä½œä¸ºæ—¶åºæ•°æ®åº“ä¸ºä¾‹ï¼Œå®Œæ•´çš„å®‰è£…å’Œé…ç½®è¿‡ç¨‹ã€‚\nvmstorageã€vminsertã€vmselect ä¸‰è€…ç»„åˆæ„æˆ VictoriaMetrics çš„é›†ç¾¤åŠŸèƒ½ï¼Œä¸‰è€…éƒ½å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ªå®ä¾‹æ¥åˆ†æ‹…æ‰¿è½½æµé‡ã€‚\n vmstorage æ˜¯æ•°æ®å­˜å‚¨æ¨¡å—ï¼š\n  å…¶æ•°æ®ä¿å­˜åœ¨-storageDataPathæŒ‡å®šçš„ç›®å½•ä¸­ï¼Œé»˜è®¤ä¸º./vmstorage-data/ï¼Œvmstorage æ˜¯æœ‰çŠ¶æ€æ¨¡å—ï¼Œåˆ é™¤ storage node ä¼šä¸¢å¤±çº¦ 1/Nçš„å†å²æ•°æ®ï¼ˆN ä¸ºé›†ç¾¤ä¸­ vmstorage node çš„èŠ‚ç‚¹æ•°é‡ï¼‰ã€‚å¢åŠ  storage nodeï¼Œåˆ™éœ€è¦åŒæ­¥ä¿®æ”¹ vminsert å’Œ vmselect çš„å¯åŠ¨å‚æ•°ï¼Œå°†æ–°åŠ å…¥çš„storage nodeèŠ‚ç‚¹åœ°å€é€šè¿‡å‘½ä»¤è¡Œå‚æ•° -storageNodeä¼ å…¥ç»™vminsertå’Œvmselectã€‚ vmstorage å¯åŠ¨åï¼Œä¼šç›‘å¬ä¸‰ä¸ªç«¯å£ï¼Œåˆ†åˆ«æ˜¯ -httpListenAddr :8482ã€-vminsertAddr :8400ã€-vmselectAddr :8401ã€‚ç«¯å£8400è´Ÿè´£æ¥æ”¶æ¥è‡ª vminsert çš„å†™å…¥è¯·æ±‚ï¼Œç«¯å£8401è´Ÿè´£æ¥æ”¶æ¥è‡ª vmselect çš„æ•°æ®æŸ¥è¯¢è¯·æ±‚ï¼Œç«¯å£8482åˆ™æ˜¯ vmstorage è‡ªèº«æä¾›çš„ http api æ¥å£ã€‚   vminsert æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®å†™å…¥è¯·æ±‚ï¼Œå¹¶è´Ÿè´£è½¬å‘åˆ°é€‰å®šçš„vmstorageï¼š\n  vminsert æ¥æ”¶åˆ°æ•°æ®å†™å…¥è¯·æ±‚åï¼ŒæŒ‰ç…§ jump consistent hash ç®—æ³•ï¼Œå°†æ•°æ®è½¬å‘åˆ°é€‰å®šçš„æŸä¸ªvmstorage node ä¸Šã€‚vminsert æœ¬èº«æ˜¯æ— çŠ¶æ€æ¨¡å—ï¼Œå¯ä»¥å¢åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®ä¾‹ï¼Œè€Œä¸ä¼šé€ æˆæ•°æ®çš„æŸå¤±ã€‚vminsert æ¨¡å—é€šè¿‡å¯åŠ¨æ—¶çš„å‚æ•° -storageNode xxx,yyy,zzz æ¥æ„ŸçŸ¥åˆ°æ•´ä¸ª vmstorage é›†ç¾¤çš„å®Œæ•´ node åœ°å€åˆ—è¡¨ã€‚ vminsert å¯åŠ¨åï¼Œä¼šç›‘å¬ä¸€ä¸ªç«¯å£-httpListenAddr :8480ã€‚è¯¥ç«¯å£å®ç°äº† prometheus remote_writeåè®®ï¼Œå› æ­¤å¯ä»¥æ¥æ”¶å’Œè§£æé€šè¿‡ remote_write åè®®å†™å…¥çš„æ•°æ®ã€‚ä¸è¿‡è¦æ³¨æ„ï¼ŒVictoriaMetrics é›†ç¾¤ç‰ˆæœ¬å…·æœ‰å¤šç§Ÿæˆ·åŠŸèƒ½ï¼Œå› æ­¤ç§Ÿæˆ·IDä¼šä»¥å¦‚ä¸‹å½¢å¼å‡ºç°åœ¨ API URL ä¸­: http://vminsert:8480/insert/\u003caccount_id\u003e/prometheus/api/v1/writeã€‚ æ›´å¤š URL Format å¯ä»¥å‚è€ƒ VictoriaMetricså®˜ç½‘ã€‚   vmselect æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®æŸ¥è¯¢è¯·æ±‚ï¼Œå¹¶è´Ÿè´£è½¬å‘åˆ°æ‰€æœ‰çš„ vmstorage æŸ¥è¯¢ç»“æœå¹¶åˆå¹¶ï¼š\n  vmselect å¯åŠ¨åï¼Œä¼šç›‘å¬ä¸€ä¸ªç«¯å£-httpListenAddr :8481ã€‚è¯¥ç«¯å£å®ç°äº† prometheus remote_queryç­‰åè®®ï¼Œå› æ­¤å¯ä»¥æ¥æ”¶å’Œè§£æ remote_query åè®®çš„æŸ¥è¯¢ã€‚ä¸è¿‡è¦æ³¨æ„ï¼ŒVictoriaMetrics é›†ç¾¤ç‰ˆæœ¬å…·æœ‰å¤šç§Ÿæˆ·åŠŸèƒ½ï¼Œå› æ­¤ç§Ÿæˆ·IDä¼šä»¥å¦‚ä¸‹å½¢å¼å‡ºç°åœ¨ API URL ä¸­: http://vminsert:8481/select/\u003caccount_id\u003e/prometheus/api/v1/queryã€‚ æ›´å¤š URL Format å¯ä»¥å‚è€ƒ VictoriaMetricså®˜ç½‘ã€‚  ä¸‹è½½å’Œå®‰è£… VictoriaMetrics é›†ç¾¤ç‰ˆ  å» vm release ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘ä»¬é€‰æ‹©ä¸‹è½½ v1.69.0 amd64ã€‚ è§£å‹ç¼©åå¾—åˆ°ï¼š  $ls -l vm*-prod -rwxr-xr-x 1 work work 10946416 Nov 8 22:03 vminsert-prod* -rwxr-xr-x 1 work work 13000624 Nov 8 22:03 vmselect-prod* -rwxr-xr-x 1 work work 11476736 Nov 8 22:03 vmstorage-prod*  å¯åŠ¨ä¸‰ä¸ª vmstorage å®ä¾‹(å¯ä»¥ç”¨ä¸‹é¢çš„è„šæœ¬å¿«é€Ÿç”Ÿæˆä¸åŒå®ä¾‹çš„å¯åŠ¨å‘½ä»¤)ï¼š  #!/bin/bash  for i in `seq 0 2`; do if [ $i -eq 0 ]; then i=\"\" fi pp=$i httpListenAddr=${pp}8482 vminsertAddr=${pp}8400 vmselectAddr=${pp}8401 storageDataPath=./${pp}vmstorage-data prog=\"nohup ./vmstorage-prod -loggerTimezone Asia/Shanghai \\ -storageDataPath $storageDataPath\\ -httpListenAddr :$httpListenAddr\\ -vminsertAddr :$vminsertAddr\\ -vmselectAddr :$vmselectAddr\\ \u0026\u003e ${pp}vmstor.log \u0026\" echo $prog (exec \"$prog\") done ä¹Ÿå¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¡Œå¯åŠ¨ä¸‰ä¸ªå®ä¾‹ï¼š\nnohup ./vmstorage-prod -loggerTimezone Asia/Shanghai -storageDataPath ./vmstorage-data -httpListenAddr :8482 -vminsertAddr :8400 -vmselectAddr :8401 \u0026\u003e vmstor.log \u0026 nohup ./vmstorage-prod -loggerTimezone Asia/Shanghai -storageDataPath ./1vmstorage-data -httpListenAddr :18482 -vminsertAddr :18400 -vmselectAddr :18401 \u0026\u003e 1vmstor.log \u0026 nohup ./vmstorage-prod -loggerTimezone Asia/Shanghai -storageDataPath ./2vmstorage-data -httpListenAddr :28482 -vminsertAddr :28400 -vmselectAddr :28401 \u0026\u003e 2vmstor.log \u0026  å¯åŠ¨ä¸€ä¸ª vminsert å®ä¾‹ï¼š  nohup ./vminsert-prod -httpListenAddr :8480 -storageNode=127.0.0.1:8400,127.0.0.1:18400,127.0.0.1:28400 \u0026\u003evminsert.log \u0026  å¯åŠ¨ä¸€ä¸ª vmselect å®ä¾‹ï¼š  nohup ./vmselect-prod -httpListenAddr :8481 -storageNode=127.0.0.1:8401,127.0.0.1:18401,127.0.0.1:28401 \u0026\u003evmselect.log \u0026  æŸ¥çœ‹ vmstorageï¼Œvminsertï¼Œvmselect çš„ /metrics æ¥å£:  curl http://127.0.0.1:8482/metrics curl http://127.0.0.1:18482/metrics curl http://127.0.0.1:28482/metrics curl http://127.0.0.1:8481/metrics curl http://127.0.0.1:8480/metrics  n9e-serveré€šè¿‡remote writeæ¥å£å†™å…¥æ—¶åºåº“ï¼Œvmä½œä¸ºæ—¶åºåº“çš„ä¸€ä¸ªé€‰æ‹©ï¼Œå…¶remote writeæ¥å£åœ°å€ä¸ºï¼šhttp://127.0.0.1:8480/insert/0/prometheus/api/v1/write æŠŠè¿™ä¸ªåœ°å€é…ç½®åˆ°server.confå½“ä¸­å³å¯ï¼Œé…ç½®å®Œäº†é‡å¯n9e-server  # Readeréƒ¨åˆ†ä¿®æ”¹Url [Reader] Url = \"http://172.21.0.8:8481/select/0/prometheus\" # Writerséƒ¨åˆ†ä¿®æ”¹Url [[Writers]] Url = \"http://172.21.0.8:8480/insert/0/prometheus/api/v1/write\"  ä¿®æ”¹æ‚¨çš„ n9e-webapi çš„é…ç½®æ–‡ä»¶ ./etc/webapi.conf å¦‚ä¸‹ï¼š  [[Clusters]] # Prometheus cluster name Name = \"Default\" # Prometheus APIs base url Prom = \"http://127.0.0.1:8481/select/0/prometheus\" ç„¶åï¼Œé‡æ–°å¯åŠ¨n9e-webapiï¼Œè¿™æ ·å¤œèºå°±å¯ä»¥é€šè¿‡ remote query æŸ¥è¯¢åˆ° victoriametrics é›†ç¾¤çš„æ•°æ®äº†ã€‚\nInfon9e-webapi çš„å®‰è£…ã€é…ç½®å’Œå¯åŠ¨ï¼Œè¯·å‚è€ƒ è¿™é‡Œã€‚\n FAQ  VictoriaMetrics å•æœºç‰ˆæœ¬å¦‚ä½•ä¿éšœæ•°æ®çš„å¯é æ€§ï¼Ÿ  vm é’ˆå¯¹ç£ç›˜IOæœ‰é’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œå•æœºç‰ˆå¯ä»¥è€ƒè™‘å°†æ•°æ®çš„å¯é æ€§ä¿éšœäº¤ç»™ EBS ç­‰äº‘ç›˜æ¥ä¿è¯ã€‚\n  VictoriaMetrics å¦‚ä½•è¯„ä¼°å®¹é‡ï¼Ÿ  å‚è€ƒvmçš„å®˜æ–¹æ–‡æ¡£ã€‚\n  VictoriaMetrics é›†ç¾¤ç‰ˆæœ¬å¢åŠ æˆ–è€…åˆ é™¤vmstorage Nodeçš„æ—¶å€™ï¼Œæ•°æ®å¦‚ä½•å†å¹³è¡¡ï¼Ÿ  vm ä¸æ”¯æŒæ‰©ç¼©å®¹èŠ‚ç‚¹æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œè‡ªåŠ¨çš„å†å¹³è¡¡ã€‚\n  VictoriaMetrics çš„æ•°æ®å¤§å°å¦‚ä½•æŸ¥çœ‹ï¼Ÿ  å¯ä»¥é€šè¿‡ vmstorage å®ä¾‹æš´éœ²çš„ /metrics æ¥å£æ¥è·å–åˆ°ç›¸åº”çš„ç»Ÿè®¡æ•°æ®ï¼Œè­¬å¦‚ï¼š\n $ curl http://127.0.0.1:8482/metrics |grep -i data_size vm_data_size_bytes{type=\"indexdb\"} 609291 vm_data_size_bytes{type=\"storage/big\"} 0 vm_data_size_bytes{type=\"storage/small\"} 8749893  vminsert åœ¨å°†æ•°æ®å†™å…¥å¤šä¸ª vmstorage Nodeçš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§ä»€ä¹ˆè§„åˆ™å°†æ•°æ®å†™å…¥åˆ°ä¸åŒçš„ node ä¸Šçš„ï¼Ÿ  é‡‡ç”¨jump consistent hash å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå†™å…¥åˆ°ç›¸åº”çš„storage nodeä¸Šã€‚\n  vmselect åœ¨æ¥åˆ°æŸ¥è¯¢è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚ä½•å®šä½åˆ°è¯·æ±‚çš„æ•°æ®æ˜¯åœ¨å“ªä¸ª storage nodeä¸Šçš„ï¼Ÿ  vmselect å¹¶ä¸çŸ¥é“æ¯ä¸ªmetricså¯¹åº”çš„æ•°æ®åˆ†å¸ƒçš„storage nodeï¼Œvmselectä¼šå¯¹æ‰€æœ‰çš„storage nodeå‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œæœ€åè¿›è¡Œæ•°æ®åˆå¹¶ï¼Œå¹¶è¿”å›ã€‚\n  VictoriaMetrics å’Œ M3db çš„å¯¹æ¯”å’Œé€‰æ‹©ï¼Ÿ  m3dbæ¶æ„è®¾è®¡ä¸Šæ›´é«˜çº§ï¼Œå®ç°éš¾åº¦é«˜ï¼Œm3dbåœ¨æ—¶åºæ•°æ®åŠŸèƒ½ä¹‹åï¼Œé‡ç‚¹è§£å†³äº†è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œæ•°æ®è‡ªåŠ¨å¹³è¡¡ç­‰è¿ç»´éš¾é¢˜ã€‚ä½†æ˜¯å› æ­¤ä¹Ÿæ›´å¤æ‚ï¼Œå¯é æ€§ç›®å‰ä¹Ÿæ›´éš¾ä¿è¯ã€‚VictoriaMetricsæ¶æ„è®¾è®¡ä¸Šçš„tradeoff æ›´å€¾å‘äºç®€å•å¯é ï¼Œé‡ç‚¹ä¼˜åŒ–äº†å•æœºç‰ˆçš„æ€§èƒ½ï¼Œå¼ºè°ƒå‚ç›´æ‰©å±•ï¼ŒåŒæ—¶å’Œprometheus ç”Ÿæ€åšåˆ°å…¼å®¹ï¼Œç”šè‡³äºåœ¨å¾ˆå¤šçš„ç‚¹ä¸Šåšåˆ°äº†åŠ å¼ºã€‚ä½†æ˜¯ VictoriaMetrics å¯¹äºæ—¶åºæ•°æ®downsampleï¼ŒèŠ‚ç‚¹çš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œæ•°æ®è‡ªåŠ¨å†å¹³è¡¡ç­‰é«˜çº§åŠŸèƒ½å’Œåˆ†å¸ƒå¼èƒ½åŠ›ï¼Œæ˜¯æœ‰ç¼ºå¤±çš„ã€‚\n   ç›¸å…³èµ„æ–™  ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½² VictoriaMetricsã€‚ ä½¿ç”¨ Helm Chart å¿«é€Ÿåœ¨ Kubernetesä¸­éƒ¨ç½² VictoriaMetricsã€‚ ä½¿ç”¨ VictoriaMetrics Operator åœ¨ Kubernetesä¸­éƒ¨ç½² VictoriaMetricsã€‚ VictoriaMetrics é›†ç¾¤ç‰ˆæ¶æ„ï¼š   ",
    "description": "",
    "tags": null,
    "title": "ä½¿ç”¨VictoriaMetricsä½œä¸ºæ—¶åºåº“",
    "uri": "/quickstart/victoriametrics/"
  },
  {
    "content": "ç”±äºPrometheusæ²¡æœ‰é›†ç¾¤ç‰ˆæœ¬ï¼Œå—é™äºå®¹é‡é—®é¢˜ï¼Œå¾ˆå¤šå…¬å¸ä¼šæ­å»ºå¤šå¥—Prometheusï¼Œæ¯”å¦‚æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†ï¼Œä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„Prometheusé›†ç¾¤ï¼Œæˆ–è€…æŒ‰ç…§åœ°åŸŸæ‹†åˆ†ï¼Œä¸åŒçš„åœ°åŸŸä½¿ç”¨ä¸åŒçš„Prometheusé›†ç¾¤ã€‚è¿™é‡Œæ˜¯ä»¥Prometheusæ¥ä¸¾ä¾‹ï¼ŒVictoriaMetricsã€M3DBéƒ½æœ‰é›†ç¾¤ç‰ˆæœ¬ï¼Œä¸è¿‡æœ‰æ—¶ä¸ºäº†ä¸ç›¸äº’å¹²æ‰°å’Œåœ°åŸŸç½‘ç»œé—®é¢˜ï¼Œä¹Ÿä¼šæ‹†æˆå¤šä¸ªé›†ç¾¤ã€‚å¯¹äºå¤šé›†ç¾¤çš„ååŒï¼Œéœ€è¦åœ¨å¤œèºé‡Œåšä¸€äº›é…ç½®ï¼Œå›é¡¾ä¸€ä¸‹å¤œèºçš„æ¶æ„å›¾ï¼š\nå›¾ä¸Šåˆ†äº† 3 ä¸ª regionï¼Œæ¯ä¸ª region ä¸€å¥—æ—¶åºåº“ï¼Œæ¯ä¸ª region ä¸€å¥— n9e-serverï¼Œn9e-server ä¾èµ– redisï¼Œæ‰€ä»¥æ¯ä¸ª region ä¸€ä¸ª redisï¼Œn9e-webapi å’Œ mysql æ”¾åˆ°ä¸­å¿ƒï¼Œn9e-webapi ä¹Ÿä¾èµ–ä¸€ä¸ª redisï¼Œæ‰€ä»¥ä¸­å¿ƒç«¯æ”¾ç½®çš„æ˜¯ n9e-webapiã€redisã€mysqlï¼Œå¦‚æœæƒ³å›¾çœäº‹ï¼Œredis ä¹Ÿæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œå„ä¸ª region çš„ n9e-server éƒ½è¿æ¥ä¸­å¿ƒçš„ redis ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\nä¸ºäº†é«˜å¯ç”¨ï¼Œå„ä¸ª region çš„ n9e-server å¯ä»¥å¤šéƒ¨ç½²å‡ ä¸ªå®ä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œé›†ç¾¤ä¸­çš„æ‰€æœ‰ n9e-server çš„é…ç½®æ–‡ä»¶ server.conf ä¸­çš„ ClusterName è¦è®¾ç½®æˆä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚\nå‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ—¶åºåº“ï¼Œåœ¨åŒ—äº¬æ­å»ºäº†ä¸€ä¸ª Prometheusï¼Œåœ¨å¹¿å·æ­å»ºäº†ä¸€ä¸ª VictoriaMetricsï¼Œn9e-webapi ä¼šæŠŠè¿™ä¸¤ä¸ªæ—¶åºåº“ä½œä¸º DataSourceï¼Œæ‰€ä»¥åœ¨ n9e-webapi çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè¦é…ç½®ä¸Šè¿™ä¿©å­˜å‚¨çš„åœ°å€ï¼Œä¸¾ä¾‹ï¼š\n[[Clusters]] # cluster name Name = \"Prom-Beijing\" # Prometheus APIs base url Prom = \"http://10.2.3.4:9090\" # Basic auth username BasicAuthUser = \"\" # Basic auth password BasicAuthPass = \"\" # timeout settings, unit: ms Timeout = 30000 DialTimeout = 10000 TLSHandshakeTimeout = 30000 ExpectContinueTimeout = 1000 IdleConnTimeout = 90000 # time duration, unit: ms KeepAlive = 30000 MaxConnsPerHost = 0 MaxIdleConns = 100 MaxIdleConnsPerHost = 100 [[Clusters]] # cluster name Name = \"VM-Guangzhou\" # Prometheus APIs base url Prom = \"http://172.21.0.8:8481/select/0/prometheus\" # Basic auth username BasicAuthUser = \"\" # Basic auth password BasicAuthPass = \"\" # timeout settings, unit: ms Timeout = 30000 DialTimeout = 10000 TLSHandshakeTimeout = 30000 ExpectContinueTimeout = 1000 IdleConnTimeout = 90000 # time duration, unit: ms KeepAlive = 30000 MaxConnsPerHost = 0 MaxIdleConns = 100 MaxIdleConnsPerHost = 100 å¦å¤–å›¾ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ª n9e-server å¯¹åº”ä¸€ä¸ªæ—¶åºåº“ï¼Œæ‰€ä»¥åœ¨ n9e-server çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿéœ€è¦é…ç½®å¯¹åº”çš„æ—¶åºåº“çš„åœ°å€ï¼Œæ¯”å¦‚åŒ—äº¬çš„ serverï¼Œé…ç½®å¦‚ä¸‹ï¼ŒWriters ä¸‹é¢çš„ Url é…ç½®çš„æ˜¯ remote write çš„åœ°å€ï¼Œè€Œ Reader ä¸‹é¢é…ç½®çš„ Url æ˜¯å®ç°Prometheus åŸç”ŸæŸ¥è¯¢æ¥å£çš„ BaseUrlã€‚\n[Reader] # prometheus base url Url = \"http://127.0.0.1:9090\" # Basic auth username BasicAuthUser = \"\" # Basic auth password BasicAuthPass = \"\" # timeout settings, unit: ms Timeout = 30000 DialTimeout = 10000 TLSHandshakeTimeout = 30000 ExpectContinueTimeout = 1000 IdleConnTimeout = 90000 # time duration, unit: ms KeepAlive = 30000 MaxConnsPerHost = 0 MaxIdleConns = 100 MaxIdleConnsPerHost = 10 [[Writers]] Url = \"http://127.0.0.1:9090/api/v1/write\" # Basic auth username BasicAuthUser = \"\" # Basic auth password BasicAuthPass = \"\" # timeout settings, unit: ms Timeout = 30000 DialTimeout = 10000 TLSHandshakeTimeout = 30000 ExpectContinueTimeout = 1000 IdleConnTimeout = 90000 # time duration, unit: ms KeepAlive = 30000 MaxConnsPerHost = 0 MaxIdleConns = 100 MaxIdleConnsPerHost = 100 å‡è®¾ä¸Šæµ·åŒºåŸŸç”¨çš„æ˜¯ VictoriaMetricsï¼Œæ‰€ä»¥ Url ç•¥æœ‰ä¸åŒï¼Œé…ç½®å¦‚ä¸‹ï¼š\n[Reader] # prometheus base url Url = \"http://127.0.0.1:8481/select/0/prometheus\" # Basic auth username BasicAuthUser = \"\" # Basic auth password BasicAuthPass = \"\" # timeout settings, unit: ms Timeout = 30000 DialTimeout = 10000 TLSHandshakeTimeout = 30000 ExpectContinueTimeout = 1000 IdleConnTimeout = 90000 # time duration, unit: ms KeepAlive = 30000 MaxConnsPerHost = 0 MaxIdleConns = 100 MaxIdleConnsPerHost = 10 [[Writers]] Url = \"http://127.0.0.1:8480/insert/0/prometheus/api/v1/write\" # Basic auth username BasicAuthUser = \"\" # Basic auth password BasicAuthPass = \"\" # timeout settings, unit: ms Timeout = 30000 DialTimeout = 10000 TLSHandshakeTimeout = 30000 ExpectContinueTimeout = 1000 IdleConnTimeout = 90000 # time duration, unit: ms KeepAlive = 30000 MaxConnsPerHost = 0 MaxIdleConns = 100 MaxIdleConnsPerHost = 100 n9e-webapi æ˜¯è¦å“åº”å‰ç«¯ ajax è¯·æ±‚çš„ï¼Œå‰ç«¯ä¼šä» n9e-webapi æŸ¥è¯¢ç›‘æ§æ•°æ®ï¼Œn9e-webapi è‡ªèº«ä¸å­˜å‚¨ç›‘æ§æ•°æ®ï¼Œè€Œæ˜¯ä»…ä»…åšäº†ä¸€ä¸ªä»£ç†ï¼ŒæŠŠè¯·æ±‚ä»£ç†ç»™åç«¯çš„æ—¶åºåº“ï¼Œå‰ç«¯è¯»å–æ•°æ®æ—¶ä¼šè°ƒç”¨ Prometheus çš„é‚£äº›åŸç”Ÿæ¥å£ï¼Œå³ï¼š/api/v1/query /api/v1/query_range /api/v1/labels è¿™ç§æ¥å£ï¼Œæ‰€ä»¥æ³¨æ„å•¦ï¼Œn9e-webapi ä¸­é…ç½®çš„ Clusters ä¸‹é¢çš„Urlï¼Œéƒ½æ˜¯è¦æ”¯æŒPrometheus åŸç”Ÿæ¥å£çš„ BaseUrlã€‚\nå¯¹äº n9e-serverï¼Œæœ‰ä¸¤ä¸ªé‡è¦ä½œç”¨ï¼Œä¸€ä¸ªæ˜¯æ¥æ”¶ç›‘æ§æ•°æ®ï¼Œç„¶åè½¬å‘ç»™åç«¯å¤šä¸ª Writerï¼Œæ‰€ä»¥ï¼ŒWriter å¯ä»¥é…ç½®å¤šä¸ªï¼Œé…ç½®æ–‡ä»¶æ˜¯ toml æ ¼å¼ï¼Œ[[Writers]]åŒä¸­æ‹¬å·è¿™ç§å°±è¡¨ç¤ºæ•°ç»„ï¼Œæ•°æ®å†™ç»™åç«¯å­˜å‚¨ï¼Œèµ°çš„åè®®æ˜¯ Prometheus çš„ Remote Writeï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰æ”¯æŒ Remote Write çš„å­˜å‚¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ã€‚n9e-server çš„å¦ä¸€ä¸ªé‡è¦ä½œç”¨ï¼Œæ˜¯åšå‘Šè­¦åˆ¤æ–­ï¼Œä¼šå‘¨æœŸæ€§ä» mysql åŒæ­¥å‘Šè­¦è§„åˆ™ï¼Œç„¶åæ ¹æ®ç”¨æˆ·é…ç½®çš„ PromQL è°ƒç”¨æ—¶åºåº“çš„ query æ¥å£ï¼Œæ‰€ä»¥ n9e-server çš„ Reader ä¸‹é¢çš„ Urlï¼Œä¹Ÿæ˜¯è¦é…ç½®æ”¯æŒ Prometheus åŸç”Ÿæ¥å£çš„ BaseUrlã€‚å¦å¤–æ³¨æ„ï¼ŒWriter å¯ä»¥é…ç½®å¤šä¸ªï¼Œä½†æ˜¯ Reader åªèƒ½é…ç½®ä¸€ä¸ªã€‚æ¯”å¦‚ç›‘æ§æ•°æ®å¯ä»¥å†™ä¸€ä»½åˆ°Prometheus å­˜å‚¨è¿‘æœŸæ•°æ®ç”¨äºå‘Šè­¦åˆ¤æ–­ï¼Œå†å†™ä¸€ä»½åˆ° OpenTSDB å­˜å‚¨é•¿æœŸæ•°æ®ï¼ŒWriter å°±å¯ä»¥é…ç½®ä¸º Prometheus å’Œ OpenTSDB è¿™ä¸¤ä¸ªï¼Œè€Œ Reader åªé…ç½® Prometheus å³å¯ã€‚\n",
    "description": "",
    "tags": null,
    "title": "æ¥å…¥å¤šä¸ªProm/VM/M3DBé›†ç¾¤",
    "uri": "/quickstart/multitsdb/"
  },
  {
    "content": "å¯¹äºè§„æ¨¡ç›¸å¯¹è¾ƒå°çš„å…¬å¸ï¼Œæ¯”å¦‚å‡ ç™¾å°æœºå™¨è¿™ä¸ªä½“é‡ï¼Œä¸ªäººè®¤ä¸ºå•æœºç‰ˆè¶³å¤Ÿç”¨äº†ï¼Œä½¿ç”¨äº‘ä¸»æœºéƒ¨ç½²ï¼Œæ€§èƒ½ä¸è¶³å¯ä»¥ç›´æ¥å‡é…ï¼Œå­˜å‚¨ä½¿ç”¨äº‘å­˜å‚¨ä¿è¯ï¼Œç¡¬ä»¶æ•…éšœäº‘å¹³å°ä¹Ÿä¼šè‡ªåŠ¨æŠŠè™šæ‹Ÿæœºçƒ­è¿ç§»èµ°ï¼Œéå¸¸çœå¿ƒã€‚é‚£å¦‚æœå’±ä»¬ä½“é‡ç¡®å®æ¯”è¾ƒå¤§ï¼Œæˆ–è€…æ²¡æœ‰äº‘ä¸»æœºè¿™ç§åŸºç¡€è®¾æ–½ï¼Œè¿™é‡Œä¼šè®²è§£é›†ç¾¤ç‰ˆçš„éƒ¨ç½²æ–¹å¼ã€‚\næ—¶åºåº“ æ—¶åºåº“çš„é›†ç¾¤éƒ¨ç½²ï¼Œå°±çœ‹æ—¶åºåº“è‡ªèº«çš„æœºåˆ¶äº†ï¼Œè¿™é‡Œä¸å±•å¼€ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ Prometheusï¼ŒPrometheus æ²¡æœ‰é›†ç¾¤ç‰ˆï¼ŒVictoriaMetricsã€M3DBã€Thanos ç­‰éƒ½æ˜¯æœ‰é›†ç¾¤ç‰ˆçš„ï¼Œè¯·å‚è€ƒä»–ä»¬çš„æ–‡æ¡£\nMySQL MySQL ä¸€èˆ¬éƒ¨ç½²æˆä¸»ä»ï¼Œè¿™ä¸ªè¯·ä½ ä»¬çš„ DBA æ¥æå§ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨äº‘ä¸Š RDSï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†\nRedis å¤œèºå½“å‰ n9e-webapi å’Œ n9e-server éƒ½ä¾èµ– redisï¼Œredis ä¸€èˆ¬æœ‰ä¸‰ç§æ¨¡å¼ï¼Œå•æœºæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼ã€å“¨å…µæ¨¡å¼ï¼Œå¤œèºå½“å‰åªæ”¯æŒå•æœºæ¨¡å¼ã€‚å…·ä½“ä½¿ç”¨å‡ ä¸ª redisï¼Œè¦çœ‹å¤§å®¶çš„ç¯å¢ƒæƒ…å†µï¼Œå¦‚æœå›¾çœäº‹ï¼Œå…¨å±€å°±ä½¿ç”¨ä¸€ä¸ª redis ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¹Ÿå¯ä»¥æŠŠ n9e-webapi ç”¨çš„ redis å’Œ n9e-server ç”¨çš„ redis åˆ†å¼€ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ï¼šæ¥å…¥å¤šä¸ª Prom/VM/M3DB é›†ç¾¤\nn9e-webapi è¿™ä¸ªæ¨¡å—æ˜¯æ”¾ä¸­å¿ƒçš„ï¼Œå¯ä»¥éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œå‰é¢ç»Ÿä¸€æ”¾ç½® nginx æˆ–è€… lvsï¼ŒæŸä¸ª n9e-webapi å®ä¾‹å¦‚æœæŒ‚äº†ï¼Œnginxã€lvs éƒ½å¯ä»¥è‡ªåŠ¨æ‘˜é™¤ï¼Œä¿è¯äº†é«˜å¯ç”¨ã€‚\nn9e-server n9e-server æ˜¯éšç€æ—¶åºåº“èµ°çš„ï¼Œæ¯ä¸ªæ—¶åºåº“å¯¹åº”ä¸€å¥— n9e-serverï¼Œä¸€å¥— n9e-server å¯ä»¥åªæœ‰ä¸€ä¸ª n9e-server å®ä¾‹ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²å¤šä¸ªä¿è¯é«˜å¯ç”¨å’Œæ€§èƒ½ã€‚åŒä¸€å¥— n9e-server å†…éƒ¨çš„å¤šä¸ªå®ä¾‹ï¼Œå…¶é…ç½®æ–‡ä»¶ server.conf ä¸­çš„ ClusterName å­—æ®µï¼Œè¦é…ç½®æˆä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚\n",
    "description": "",
    "tags": null,
    "title": "ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤ç‰ˆ",
    "uri": "/quickstart/clusters/"
  },
  {
    "content": "é¦–é¡µæœ‰ä¸ªæ¶æ„å›¾ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¤œèºæŠŠæ¥æ”¶åˆ°çš„ç›‘æ§æ•°æ®éƒ½ç›´æ¥å†™å…¥äº†åç«¯æ—¶åºæ•°æ®åº“ï¼Œæ‰€ä»¥ï¼Œè¯»å–ç›‘æ§æ•°æ®ï¼Œæ— éœ€ç»ç”±å¤œèºçš„æ¥å£ï¼Œç›´æ¥è¯»å–åç«¯çš„æ—¶åºåº“çš„æ¥å£å°±å¯ä»¥äº†ã€‚å³ï¼šå¦‚æœä½¿ç”¨äº† Prometheusï¼Œå°±é€šè¿‡ Prometheus çš„æ¥å£è¯»å–ç›‘æ§æ•°æ®ï¼Œå¦‚æœç”¨äº† VictoriaMetricsï¼Œå°±é€šè¿‡ VictoriaMetrics çš„æ¥å£è¯»å–ç›‘æ§æ•°æ®ã€‚\næ¯”å¦‚ Prometheusï¼Œå°±æ˜¯é‚£äº›/api/v1/query /api/v1/query_rangeä¹‹ç±»çš„æ¥å£ã€‚ç›¸å…³æ¥å£æ–‡æ¡£è¯·å‚è€ƒï¼šPrometheuså®˜ç½‘\n",
    "description": "",
    "tags": null,
    "title": "è¯»å–ç›‘æ§æ•°æ®",
    "uri": "/api/read/"
  },
  {
    "content": "æ¦‚è¿° æ‰€è°“çš„å‘Šè­¦è‡ªæ„ˆï¼Œå…¸å‹æ‰‹æ®µæ˜¯åœ¨å‘Šè­¦è§¦å‘æ—¶è‡ªåŠ¨å›è°ƒæŸä¸ªwebhookåœ°å€ï¼Œåœ¨è¿™ä¸ªwebhooké‡Œå†™å‘Šè­¦è‡ªæ„ˆçš„é€»è¾‘ï¼Œå¤œèºé»˜è®¤æ”¯æŒè¿™ç§æ–¹å¼ã€‚å¦å¤–ï¼Œå¤œèºè¿˜å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œé…åˆibexè¿™ä¸ªæ¨¡å—ï¼Œåœ¨å‘Šè­¦è§¦å‘çš„æ—¶å€™ï¼Œè‡ªåŠ¨å»å‘Šè­¦çš„æœºå™¨æ‰§è¡ŒæŸä¸ªè„šæœ¬ï¼Œè¿™ç§æœºåˆ¶å¯ä»¥å¤§å¹…ç®€åŒ–æ„å»ºè¿ç»´è‡ªæ„ˆé“¾è·¯çš„å·¥ä½œé‡ï¼Œæ¯•ç«Ÿï¼Œä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½æ“…é•¿å†™http serverï¼Œä½†æ‰€æœ‰çš„è¿ç»´äººå‘˜ï¼Œéƒ½æ“…é•¿å†™è„šæœ¬ã€‚è¿™ç§æ–¹å¼æ˜¯å…¸å‹çš„ç‰©ç†æœºæ—¶ä»£çš„äº§ç‰©ï¼Œå¸Œæœ›å„ä½æœ‹å‹ç”¨ä¸åˆ°è¿™ä¸ªå·¥å…·ï¼ˆè¯´æ˜è´µå¸çš„ITæŠ€æœ¯å·²ç»èµ°å¾—éå¸¸é å‰äº†ï¼‰ã€‚\næ¶æ„ ibexæ¨¡å—ï¼Œç±»ä¼¼ä¹‹å‰å¤œèºv3ç‰ˆæœ¬ä¸­çš„jobæ¨¡å—ï¼Œå¯ä»¥æ‰¹é‡æ‰§è¡Œè„šæœ¬ï¼Œå…¶æ¶æ„éå¸¸ç®€å•ï¼ŒåŒ…æ‹¬serverå’Œagentdä¸¤ä¸ªæ¨¡å—ï¼Œagentdå‘¨æœŸæ€§è°ƒç”¨serverçš„rpcæ¥å£ï¼Œè¯¢é—®æœ‰å“ªäº›ä»»åŠ¡è¦æ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ†é…ç»™è‡ªå·±çš„ä»»åŠ¡ï¼Œå°±ä»serveræ‹¿åˆ°ä»»åŠ¡è„šæœ¬ä¿¡æ¯ï¼Œåœ¨æœ¬åœ°forkä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼Œç„¶åå°†ç»“æœä¸ŠæŠ¥ç»™æœåŠ¡ç«¯ã€‚ä¸ºäº†ç®€åŒ–éƒ¨ç½²ï¼Œserverå’Œagentdèåˆæˆäº†ä¸€ä¸ªäºŒè¿›åˆ¶ï¼Œå°±æ˜¯ibexï¼Œé€šè¿‡ä¼ å…¥ä¸åŒçš„å‚æ•°æ¥å¯åŠ¨ä¸åŒçš„è§’è‰²ã€‚ibexæ¶æ„å›¾å¦‚ä¸‹ï¼š\né¡¹ç›®åœ°å€  Gitä»“åº“ï¼šhttps://gitee.com/cnperl/ibex ç¼–è¯‘æ–¹æ³•çœ‹è¿™é‡Œ Linux ä¸‹ç¼–è¯‘å¥½çš„åŒ… åœ¨è¿™é‡Œ  å®‰è£…å¯åŠ¨ ä¸‹è½½å®‰è£…åŒ…ä¹‹åï¼Œè§£å‹ç¼©ï¼Œåœ¨etcä¸‹å¯ä»¥æ‰¾åˆ°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨sqlç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°åˆå§‹åŒ–sqlè„šæœ¬ã€‚\nåˆå§‹åŒ–sql mysql \u003c sql/ibex.sql å¯åŠ¨server serverçš„é…ç½®æ–‡ä»¶æ˜¯etc/server.confï¼Œæ³¨æ„ä¿®æ”¹é‡Œè¾¹çš„mysqlè¿æ¥åœ°å€ï¼Œé…ç½®æ­£ç¡®çš„mysqlç”¨æˆ·åå’Œå¯†ç ã€‚ç„¶åå°±å¯ä»¥ç›´æ¥å¯åŠ¨äº†ï¼š\nnohup ./ibex server \u0026\u003e server.log \u0026 ibexæ²¡æœ‰webé¡µé¢ï¼Œåªæä¾›apiæ¥å£ï¼Œé‰´æƒæ–¹å¼æ˜¯http basic authï¼Œbasic authçš„ç”¨æˆ·åå’Œå¯†ç é»˜è®¤éƒ½æ˜¯ibexï¼Œåœ¨etc/server.confä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå¦‚æœibexéƒ¨ç½²åœ¨äº’è”ç½‘ï¼Œä¸€å®šè¦ä¿®æ”¹é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œå½“ç„¶ï¼Œå› ä¸ºn9eè¦è°ƒç”¨ibexï¼Œæ‰€ä»¥n9eçš„server.confå’Œwebapi.confä¸­ä¹Ÿé…ç½®äº†ibexçš„basic authè´¦å·ä¿¡æ¯ï¼Œè¦æ”¹å°±è¦ä¸€èµ·æ”¹å•¦ã€‚\nå¯åŠ¨agentd å®¢æˆ·ç«¯çš„é…ç½®éå¸¸éå¸¸ç®€å•ï¼Œagentd.confå†…å®¹å¦‚ä¸‹ï¼š\n# debug, release RunMode = \"release\" # task meta storage dir MetaDir = \"./meta\" [HTTP] Enable = true # http listening address Host = \"0.0.0.0\" # http listening port Port = 2090 # https cert file path CertFile = \"\" # https key file path KeyFile = \"\" # whether print access log PrintAccessLog = true # whether enable pprof PProf = false # http graceful shutdown timeout, unit: s ShutdownTimeout = 30 # max content length: 64M MaxContentLength = 67108864 # http server read timeout, unit: s ReadTimeout = 20 # http server write timeout, unit: s WriteTimeout = 40 # http server idle timeout, unit: s IdleTimeout = 120 [Heartbeat] # unit: ms Interval = 1000 # rpc servers Servers = [\"10.2.3.4:20090\"] # $ip or $hostname or specified string Host = \"telegraf01\" å®¢æˆ·ç«¯çš„HTTPæ¥å£ç”¨å¤„ä¸å¤§ï¼Œå¯ä»¥æŠŠEnableè®¾ç½®ä¸ºfalseï¼Œå…³é—­ç›‘å¬ï¼Œé‡ç‚¹å…³æ³¨Heartbeatè¿™ä¸ªéƒ¨åˆ†ï¼ŒIntervalæ˜¯å¿ƒè·³é¢‘ç‡ï¼Œé»˜è®¤æ˜¯1000æ¯«ç§’ï¼Œå¦‚æœæœºå™¨é‡æ¯”è¾ƒå°ï¼Œæ¯”å¦‚å°äº1000å°ï¼Œç»´æŒ1000æ²¡é—®é¢˜ï¼Œå¦‚æœæœºå™¨é‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§è¿™ä¸ªé¢‘ç‡ï¼Œæ¯”å¦‚2000æˆ–è€…3000ï¼Œå¯ä»¥å‡è½»æœåŠ¡ç«¯çš„å‹åŠ›ã€‚Serversæ˜¯ä¸ªæ•°ç»„ï¼Œé…ç½®çš„æ˜¯ibex-serverçš„åœ°å€ï¼Œibex-serverå¯ä»¥å¯åŠ¨å¤šä¸ªï¼Œå¤šä¸ªåœ°å€éƒ½é…ç½®åˆ°è¿™é‡Œå³å¯ï¼ŒHostè¿™ä¸ªå­—æ®µï¼Œæ˜¯æœ¬æœºçš„å”¯ä¸€æ ‡è¯†ï¼Œæœ‰ä¸‰ç§é…ç½®æ–¹å¼ï¼Œå¦‚æœé…ç½®ä¸º$ipï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¢æµ‹æœ¬æœºçš„IPï¼Œå¦‚æœæ˜¯$hostnameï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¢æµ‹æœ¬æœºçš„hostnameï¼Œå¦‚æœæ˜¯å…¶ä»–å­—ç¬¦ä¸²ï¼Œé‚£å°±ç›´æ¥æŠŠè¯¥å­—ç¬¦ä¸²ä½œä¸ºæœ¬æœºçš„å”¯ä¸€æ ‡è¯†ã€‚æ¯ä¸ªæœºå™¨ä¸Šéƒ½è¦éƒ¨ç½²ibex-agentdï¼Œä¸åŒçš„æœºå™¨è¦ä¿è¯Hostå­—æ®µè·å–çš„å†…å®¹ä¸èƒ½é‡å¤ã€‚\nå¦å¤–ï¼ŒTelegrafçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸‹é¢è¿™ä¹ˆä¸€æ®µï¼š\n[agent] interval = \"10s\" round_interval = true metric_batch_size = 1000 metric_buffer_limit = 10000 collection_jitter = \"0s\" flush_interval = \"10s\" flush_jitter = \"0s\" precision = \"\" hostname = \"\" omit_hostname = false å…¶ä¸­hostnameé»˜è®¤ç•™ç©ºï¼Œè¡¨ç¤ºè‡ªåŠ¨æ¢æµ‹æœ¬æœºçš„hostnameï¼Œå¦‚æœå†™äº†å…·ä½“çš„æŸä¸ªå­—ç¬¦ä¸²ï¼Œé‚£å°±æŠŠå†™çš„é‚£ä¸ªå­—ç¬¦ä¸²ä½œä¸ºç›‘æ§æ•°æ®çš„hostå­—æ®µçš„å†…å®¹ï¼Œè¿™ä¸ªhostnameå­—æ®µè¦å’Œibexçš„agentd.confä¸­çš„Hostå­—æ®µä¿æŒä¸€è‡´ï¼Œå…¸å‹çš„åšæ³•æœ‰ï¼š\n Telegrafä¸­æŠŠhostnameé…ç½®ä¸ºç©ºï¼ŒTelegrafè‡ªåŠ¨è·å–æœ¬æœºhostnameï¼Œibexçš„Hosté…ç½®ä¸º$hostnameï¼Œibexä¹Ÿä¼šè‡ªåŠ¨è·å–æœ¬æœºhostnameï¼Œè¿™æ ·Telegrafå’Œibexå¯ä»¥è·å–åˆ°ç›¸åŒçš„æ ‡è¯†å†…å®¹ Telegrafä¸­æ‰‹å·¥æŠŠhostnameé…ç½®ä¸ºæœ¬æœºçš„ipï¼Œibexåˆ™æŠŠHosté…ç½®ä¸º$ipï¼Œè¿™æ ·äºŒè€…ä¹Ÿå¯ä»¥è·å–åˆ°ç›¸åŒçš„æ ‡è¯†å†…å®¹ Telegrafå’Œibexéƒ½ä½¿ç”¨æŸä¸ªç‰¹å®šå†™æ­»çš„å­—ç¬¦ä¸²æ¥ä½œä¸ºæ ‡è¯†ä¿¡æ¯ï¼Œè¿™æ ·ä¹ŸOKï¼Œä½†æ˜¯è¦ä¿è¯ä¸åŒçš„æœºå™¨ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä¸èƒ½é‡å¤  ä¸‹é¢æ˜¯å¯åŠ¨ibex-agentdçš„å‘½ä»¤ï¼š\nnohup ./ibex agentd \u0026\u003e agentd.log \u0026 å¦å¤–ï¼Œç»†å¿ƒçš„è¯»è€…åº”è¯¥ä¼šå‘ç°ibexçš„å‹ç¼©åŒ…é‡Œçš„etcç›®å½•ä¸‹æœ‰ä¸ªserviceç›®å½•ï¼Œé‡Œè¾¹å‡†å¤‡å¥½äº†ä¸¤ä¸ªserviceæ ·ä¾‹æ–‡ä»¶ï¼Œä¾¿äºå¤§å®¶ä½¿ç”¨systemdæ¥ç®¡ç†ibexè¿›ç¨‹ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨systemdæ¥ç®¡ç†ã€‚\n",
    "description": "",
    "tags": null,
    "title": "å‘Šè­¦è‡ªæ„ˆä¾èµ–çš„è„šæœ¬ä¸‹å‘æ‰§è¡Œæ¨¡å—",
    "uri": "/quickstart/ibex/"
  },
  {
    "content": "è°ƒç”¨ n9e-server çš„ /opentsdb/put æ¥å£ï¼ŒPOST æ–¹æ³•ï¼Œè¯¥æ¥å£å®ç°äº† OpenTSDB çš„æ•°æ®åè®®ï¼Œç›‘æ§æ•°æ®åšæˆ JSON æ”¾åˆ° HTTP Request Body ä¸­ï¼Œä¸¾ä¾‹ï¼š\n[ { \"metric\": \"cpu_usage_idle\", \"timestamp\": 1637732157, \"tags\": { \"cpu\": \"cpu-total\", \"ident\": \"c3-ceph01.bj\" }, \"value\": 30.5 }, { \"metric\": \"cpu_usage_util\", \"timestamp\": 1637732157, \"tags\": { \"cpu\": \"cpu-total\", \"ident\": \"c3-ceph01.bj\" }, \"value\": 69.5 } ] æ˜¾ç„¶ï¼ŒJSON æœ€å¤–å±‚æ˜¯ä¸ªæ•°ç»„ï¼Œå¦‚æœåªä¸ŠæŠ¥ä¸€æ¡ç›‘æ§æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸è¦å¤–é¢çš„ä¸­æ‹¬å·ï¼Œç›´æ¥æŠŠå¯¹è±¡ç»“æ„ä¸ŠæŠ¥ï¼š\n{ \"metric\": \"cpu_usage_idle\", \"timestamp\": 1637732157, \"tags\": { \"cpu\": \"cpu-total\", \"ident\": \"c3-ceph01.bj\" }, \"value\": 30.5 } æœåŠ¡ç«¯ä¼šçœ‹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯[ï¼Œæ¥åˆ¤æ–­ä¸ŠæŠ¥çš„æ˜¯æ•°ç»„ï¼Œè¿˜æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè‡ªåŠ¨åšç›¸åº”çš„ Decodeã€‚å¦‚æœè§‰å¾—ä¸ŠæŠ¥çš„å†…å®¹å¤ªè¿‡å ç”¨å¸¦å®½ï¼Œä¹Ÿå¯ä»¥åš gzip å‹ç¼©ï¼Œæ­¤æ—¶ä¸ŠæŠ¥çš„æ•°æ®ï¼Œè¦å¸¦æœ‰Content-Encoding: gzipçš„ Headerã€‚\nInfoæ³¨æ„ ident è¿™ä¸ªæ ‡ç­¾ï¼Œident æ˜¯ identity çš„ç¼©å†™ï¼Œè¡¨ç¤ºè®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœæ ‡ç­¾ä¸­æœ‰ ident æ ‡ç­¾ï¼Œn9e-server å°±è®¤ä¸ºè¿™ä¸ªç›‘æ§æ•°æ®æ˜¯æ¥è‡ªæŸä¸ªæœºå™¨çš„ï¼Œä¼šè‡ªåŠ¨è·å– ident çš„ valueï¼Œæ³¨å†Œåˆ°ç›‘æ§å¯¹è±¡çš„åˆ—è¡¨é‡Œ\n ",
    "description": "",
    "tags": null,
    "title": "æ¨é€ç›‘æ§æ•°æ®ï¼ˆOpenTSDBåè®®ï¼‰",
    "uri": "/api/opentsdb/"
  },
  {
    "content": " æœ¬èŠ‚è®²è¿° Nightingale çš„æºç ç¼–è¯‘æ–¹å¼ï¼Œåˆ†å‰åç«¯ä¸¤éƒ¨åˆ†ã€‚å¦å¤–ï¼Œå¦‚æœç”¨åˆ°å‘Šè­¦è‡ªæ„ˆæ¨¡å—ï¼Œä¼šç”¨åˆ° ibex è¿™ä¸ªæ¨¡å—ï¼Œæœ¬èŠ‚ä¹Ÿä¼šä¸€å¹¶è®²è§£ ibex æ¨¡å—çš„ç¼–è¯‘æ–¹æ³•ã€‚å¯¹äº ARM çš„å¤„ç†å™¨ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ï¼Œå¤§å®¶å°±è¦ç”¨ä¸‹é¢çš„æ–¹æ³•è‡ªè¡Œç¼–è¯‘äº†ã€‚\n å‰ç«¯ git clone https://github.com/n9e/fe-v5.git cd fe-v5 npm install npm run build åç«¯ Nightingale åç«¯é‡‡ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œç¼–è¯‘çš„å‰ç½®æ¡ä»¶å°±æ˜¯é…ç½® Go çš„å¼€å‘ç¯å¢ƒã€‚\né…ç½®Goç¯å¢ƒ åˆ°Goå®˜ç½‘é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ä¸‹è½½ï¼Œæˆ‘çš„ç¯å¢ƒæ˜¯Linuxï¼Œé€‰æ‹©çš„go1.17.3.linux-amd64.tar.gzï¼Œç›´æ¥ä¸‹è½½åˆ°/rootç›®å½•ä¸‹äº†ï¼Œç„¶åè§£å‹ç¼©ï¼Œå³Goçš„å†…å®¹éƒ½æ”¾åˆ°äº†/root/goç›®å½•ä¸‹äº†ã€‚åŒæ—¶å‡†å¤‡gopathç›®å½•ï¼Œå¦‚ä¸‹ï¼š\ncd /root \u0026\u0026 mkdir -p gopath/src echo \"GOROOT=/root/go\" \u003e\u003e .bash_profile echo \"GOPATH=/root/gopath\" \u003e\u003e .bash_profile echo 'export PATH=$GOROOT/bin:$GOPATH/bin:$PATH' \u003e\u003e .bash_profile source .bash_profile ç¼–è¯‘n9e git clone https://github.com/didi/nightingale.git # å›½å†…é…ç½®ä¸€ä¸‹ä»£ç†ï¼Œå¯ä»¥åŠ é€Ÿç¼–è¯‘ export GOPROXY=https://goproxy.cn # æ‰§è¡Œç¼–è¯‘ cd nightingale \u0026\u0026 make ç¼–è¯‘å®Œæˆä¹‹åå¦‚æœç”ŸæˆäºŒè¿›åˆ¶ï¼šn9eï¼Œå°±è¡¨ç¤ºç¼–è¯‘æˆåŠŸï¼æƒ³è¦å¿«é€Ÿå…¥é—¨Goè¯­è¨€ï¼Ÿå¯ä»¥å‚è€ƒGOCNçš„èµ„æ–™ï¼\nç¼–è¯‘ibex å¦‚æœéœ€è¦å‘Šè­¦è‡ªæ„ˆèƒ½åŠ›ï¼Œå¤œèºä¾èµ–ibexåšå‘½ä»¤ä¸‹å‘æ‰§è¡Œï¼Œibexçš„ç¼–è¯‘å’Œn9eå‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œå¦‚ä¸‹ï¼š\ngit clone https://gitee.com/cnperl/ibex.git # å›½å†…é…ç½®ä¸€ä¸‹ä»£ç†ï¼Œå¯ä»¥åŠ é€Ÿç¼–è¯‘ export GOPROXY=https://goproxy.cn # æ‰§è¡Œç¼–è¯‘ cd ibex \u0026\u0026 make ç¼–è¯‘å®Œæˆä¹‹åå¦‚æœç”ŸæˆäºŒè¿›åˆ¶ï¼šibexï¼Œå°±è¡¨ç¤ºç¼–è¯‘æˆåŠŸï¼\n",
    "description": "",
    "tags": null,
    "title": "æºç ç¼–è¯‘å¤œèºå‰åç«¯åŠå‘Šè­¦è‡ªæ„ˆæ¨¡å—",
    "uri": "/quickstart/compile/"
  },
  {
    "content": "ç®€ä»‹ n9e-webapi æ¨¡å—æä¾›äº†ä¸¤ç±»æ¥å£ï¼Œä¸€ä¸ªæ˜¯ /api/n9e æ‰“å¤´çš„ï¼Œç»™å‰ç«¯è°ƒç”¨ï¼Œå¦ä¸€ç±»æ˜¯ /v1/n9e æ‰“å¤´çš„ï¼Œç»™ç¬¬ä¸‰æ–¹ç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœæƒ³ä»¥ä¸ªäººèº«ä»½æ¨¡ä»¿WEBæ“ä½œï¼Œä¹Ÿæ˜¯è°ƒç”¨ /api/n9e ç›¸å…³æ¥å£ã€‚\nä»¥ä¸ªäººèº«ä»½æ¨¡ä»¿WEBæ“ä½œ è¿™ç§æ–¹å¼ï¼Œé¡µé¢ä¸Š JavaScript å¯ä»¥è°ƒç”¨çš„æ‰€æœ‰æ¥å£ï¼Œä½ éƒ½å¯ä»¥ç”¨ç¨‹åºè°ƒç”¨ï¼Œæ‰“å¼€ chrome çš„å¼€å‘è€…å·¥å…·ï¼Œæ‰’æ‹‰è¿™äº›æ¥å£ï¼Œè¿˜æ˜¯éå¸¸å®¹æ˜“çš„ã€‚å½“ç„¶ï¼Œè¦å…ˆç™»å½•ï¼Œç™»å½•è°ƒç”¨ webapi æ¨¡å—çš„ /api/n9e/auth/login æ¥å£ï¼Œç³»ç»Ÿä½¿ç”¨ jwt è®¤è¯ï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œä¼šè¿”å› access_token å’Œ refresh_tokenï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½è¦æŠŠ access_token æ”¾åˆ° Header é‡Œï¼Œaccess_token å·®ä¸å¤š15åˆ†é’Ÿè¿‡æœŸï¼Œä¹‹åå¯ä»¥é‡æ–°è°ƒç”¨ç™»å½•æ¥å£æ¢ tokenï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ /api/n9e/auth/refresh æ¥å£ç”¨ refresh_token æ¢ä¸€ä¸ªæ–°çš„ access_tokenï¼Œå½“ç„¶ï¼Œä¹Ÿä¼šé¡ºé“è¿”å›ä¸€ä¸ªæ–°çš„ refresh_tokenï¼Œä¸¾ä¾‹ï¼š\n# è°ƒç”¨ç™»å½•æ¥å£æ‹¿åˆ°access_tokenå’Œrefresh_tokenè®°å½•ä¸‹æ¥ï¼Œåé¢è°ƒç”¨å…¶ä»–æ¥å£çš„æ—¶å€™ä¼šç”¨åˆ° [root@10-255-0-34 ~]# curl -X POST 'http://localhost:18000/api/n9e/auth/login' -d '{\"username\": \"root\", \"password\": \"root.2020\"}' {\"dat\":{\"access_token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCIsImF1dGhvcml6ZWQiOnRydWUsImV4cCI6MTYzNzgyMzA1OSwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.nJ56Pc7qS5Ik_UaVmlNWu_QlABaBc4pZ_WkU45u2wWk\",\"refresh_token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzgzMzc4NTksInJlZnJlc2hfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCsrMS1yb290IiwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.JKsbfTYBCOOfR_oPsf496N9ml9yXbP7BHb4E8Yfnzbo\",\"user\":{\"id\":1,\"username\":\"root\",\"nickname\":\"è¶…ç®¡\",\"phone\":\"\",\"email\":\"\",\"portrait\":\"\",\"roles\":[\"Admin\"],\"contacts\":{},\"create_at\":1637545881,\"create_by\":\"system\",\"update_at\":1637546351,\"update_by\":\"root\",\"admin\":true}},\"err\":\"\"} # access_tokenæ”¾åˆ°Authorizationè¿™ä¸ªHeaderé‡Œï¼ŒBearerçš„éªŒè¯æ–¹å¼ [root@10-255-0-34 ~]# curl -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCIsImF1dGhvcml6ZWQiOnRydWUsImV4cCI6MTYzNzgyMzA1OSwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.nJ56Pc7qS5Ik_UaVmlNWu_QlABaBc4pZ_WkU45u2wWk\" 'http://localhost:18000/api/n9e/self/profile' {\"dat\":{\"id\":1,\"username\":\"root\",\"nickname\":\"è¶…ç®¡\",\"phone\":\"\",\"email\":\"\",\"portrait\":\"\",\"roles\":[\"Admin\"],\"contacts\":{},\"create_at\":1637545881,\"create_by\":\"system\",\"update_at\":1637546351,\"update_by\":\"root\",\"admin\":true},\"err\":\"\"} # å¦‚æœtokenè¿‡æœŸäº†ï¼Œåç«¯ä¼šè¿”å›å¼‚å¸¸HTTPçŠ¶æ€ç ï¼Œæ­¤æ—¶è¦è°ƒç”¨refreshæ¥å£æ¢å–æ–°çš„token [root@10-255-0-34 ~]# curl -X POST 'http://localhost:18000/api/n9e/auth/refresh' -d '{\"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzgzMzc4NTksInJlZnJlc2hfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCsrMS1yb290IiwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.JKsbfTYBCOOfR_oPsf496N9ml9yXbP7BHb4E8Yfnzbo\"}' {\"dat\":{\"access_token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NfdXVpZCI6IjAxMzkzYzkxLTk5MWItNGE0Yi04ODk2LTJhZGRjMDUwYjcxMCIsImF1dGhvcml6ZWQiOnRydWUsImV4cCI6MTYzNzgyMzMxOCwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.2BeWyYfcnRi3qw69zecaaeFnPFUNAGsiPIZBBnd5lug\",\"refresh_token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzgzMzgxMTgsInJlZnJlc2hfdXVpZCI6IjAxMzkzYzkxLTk5MWItNGE0Yi04ODk2LTJhZGRjMDUwYjcxMCsrMS1yb290IiwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.zFZaRYcJI6G5maSgDVF-jZzxQ3Tb5dybIqufJhBy034\"},\"err\":\"\"} ç¬¬ä¸‰æ–¹ç³»ç»Ÿè°ƒç”¨å¤œèº æ¯”å¦‚ç¬¬ä¸‰æ–¹ç³»ç»Ÿæƒ³è·å–å¤œèºä¸­çš„æ‰€æœ‰æœªæ¢å¤å‘Šè­¦ï¼Œæˆ–è€…è·å–å¤œèºä¸­çš„å…¨é‡ç”¨æˆ·åˆ—è¡¨ï¼Œè¿™äº›éœ€æ±‚ï¼Œå»ºè®®èµ° /v1/n9e æ‰“å¤´çš„æ¥å£ï¼Œè¿™äº›æ¥å£èµ° BasicAuth è®¤è¯ï¼ŒBasicAuth çš„ç”¨æˆ·åå’Œå¯†ç åœ¨ webapi.conf ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå°±æ˜¯ BasicAuth é‚£ä¸ª section çš„é…ç½®ã€‚å½“å‰è¿™ä¸ªé˜¶æ®µï¼Œ/v1/n9e å‰ç¼€çš„æ¥å£è¿˜æ¯”è¾ƒå°‘ï¼Œä¸è¿‡ä»£ç æ¡†æ¶å·²ç»æ­èµ·æ¥äº†ï¼Œä»£ç åœ¨ src/webapi/router/router.go æ–‡ä»¶ä¸­ï¼Œå¦‚æœè´µå¸è¦å°è£…å¤œèºçš„æ¥å£ï¼Œå¯èƒ½è¦åœ¨è¿™ä¸ªè·¯ç”±åˆ†ç»„ä¸‹åŠ ä¸€äº›è·¯ç”±é…ç½®äº†ã€‚ä½œä¸ºå¼€æºè½¯ä»¶ï¼Œè¯´æ¸…æ¥šåŸç†å°±å¥½äº†ï¼Œå¦‚æœè´µå¸ä»ç„¶æä¸æ˜ç™½å¯ä»¥è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬æä¾›å•†ä¸šæŠ€æœ¯æ”¯æŒæœåŠ¡ :-)\n",
    "description": "",
    "tags": null,
    "title": "è°ƒç”¨webapiçš„æ¥å£",
    "uri": "/api/webapi/"
  },
  {
    "content": "å¤œèºæ— éœ€å¯¹æ¥ Grafanaï¼Œå¤œèºä¼šæŠŠç›‘æ§æ•°æ®è½¬å­˜åˆ°åç«¯æ—¶åºåº“ï¼Œæ¯”å¦‚ Prometheusã€VictoriaMetricsã€M3DB ç­‰ï¼ŒæŠŠè¿™äº›æ—¶åºåº“é…ç½®ä¸º Grafana çš„æ•°æ®æºå³å¯ã€‚\n",
    "description": "",
    "tags": null,
    "title": "å¯¹æ¥Grafana",
    "uri": "/usage/grafana/"
  },
  {
    "content": "ç›‘æ§ Linux å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡éƒ¨ç½² Telegrafï¼Œä¸€ä¸ªæ˜¯é€šè¿‡ node_exporterï¼Œå…³æ³¨ä¸‰ä¸ªå±‚é¢çš„é—®é¢˜ï¼šæ€ä¹ˆéƒ¨ç½²ï¼Ÿé…ç½®å“ªäº›å‘Šè­¦è§„åˆ™ï¼Ÿç›‘æ§å¤§ç›˜å¦‚ä½•é…ç½®ï¼Ÿ\nTelegraf  éƒ¨ç½²æ–¹å¼ï¼šä½¿ç”¨Telegrafé‡‡é›†ç›‘æ§æ•°æ® å‘Šè­¦è§„åˆ™ï¼šhttps://github.com/didi/nightingale/blob/main/etc/alerts/linux_by_telegraf.json ç›‘æ§å¤§ç›˜ï¼šæ­£åœ¨æ•´ç†  node_exporter  éƒ¨ç½²æ–¹å¼ï¼šhttps://github.com/prometheus/node_exporter å‘Šè­¦è§„åˆ™ï¼šhttps://github.com/didi/nightingale/blob/main/etc/alerts/node_by_exporter.json ç›‘æ§å¤§ç›˜ï¼šhttps://github.com/didi/nightingale/blob/main/etc/dashboards/node_by_exporter.json  ",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§Linux",
    "uri": "/usage/linux/"
  },
  {
    "content": "æ¨èä½¿ç”¨ windows_exporter ç›‘æ§ windows\n éƒ¨ç½²æ–¹å¼ï¼šhttps://github.com/prometheus-community/windows_exporter å‘Šè­¦è§„åˆ™ï¼šhttps://github.com/didi/nightingale/blob/main/etc/alerts/windows_by_exporter.json ç›‘æ§å¤§ç›˜ï¼šhttps://github.com/didi/nightingale/blob/main/etc/dashboards/windows_by_exporter.json  ",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§Windows",
    "uri": "/usage/windows/"
  },
  {
    "content": "Telegrafå†…ç½®æ”¯æŒsnmpçš„é‡‡é›†ï¼Œæœ¬èŠ‚ç»™ä¸€ä¸ªå…¥é—¨ä¾‹å­ï¼Œè®©å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ï¼Œæ›´å¤šå…·ä½“çŸ¥è¯†å¯ä»¥å‚è€ƒè¿™é‡Œã€‚åœ¨telegraf.confä¸­æœç´¢inputs.snmpï¼Œå³å¯æ‰¾åˆ°å¯¹åº”çš„é…ç½®ï¼Œä¾‹å­å¦‚ä¸‹ï¼š\n[[inputs.snmp]] agents = [\"udp://172.25.79.194:161\"] timeout = \"5s\" version = 3 agent_host_tag = \"ident\" retries = 1 sec_name = \"managev3user\" auth_protocol = \"SHA\" auth_password = \"example.Demo.c0m\" [[inputs.snmp.field]] oid = \"RFC1213-MIB::sysUpTime.0\" name = \"uptime\" [[inputs.snmp.field]] oid = \"RFC1213-MIB::sysName.0\" name = \"source\" is_tag = true [[inputs.snmp.table]] oid = \"IF-MIB::ifTable\" name = \"interface\" inherit_tags = [\"source\"] [[inputs.snmp.table.field]] oid = \"IF-MIB::ifDescr\" name = \"ifDescr\" is_tag = true ä¸Šé¢éå¸¸å…³é”®çš„éƒ¨åˆ†æ˜¯ï¼šagent_host_tag = \"ident\"ï¼Œå› ä¸ºå¤œèºå¯¹identè¿™ä¸ªæ ‡ç­¾ä¼šç‰¹æ®Šå¯¹å¾…å¤„ç†ï¼ŒæŠŠæºæœ‰è¿™ä¸ªæ ‡ç­¾çš„æ•°æ®å½“åšéš¶å±æŸä¸ªç›‘æ§å¯¹è±¡çš„æ•°æ®ï¼Œæœºå™¨å’Œç½‘ç»œè®¾å¤‡éƒ½æ˜¯å…¸å‹çš„æœŸæœ›ä½œä¸ºç›‘æ§å¯¹è±¡æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥snmpçš„é‡‡é›†ä¸­ï¼Œæˆ‘ä»¬æŠŠç½‘ç»œè®¾å¤‡çš„ipæ”¾åˆ°identè¿™ä¸ªæ ‡ç­¾é‡Œå¸¦ä¸Šå»ã€‚\nå¦å¤–è¿™ä¸ªé‡‡é›†è§„åˆ™æ˜¯v3çš„æ ¡éªŒæ–¹æ³•ï¼Œä¸åŒçš„å…¬å¸å¯èƒ½é…ç½®çš„æ ¡éªŒæ–¹å¼ä¸åŒï¼Œè¯·å„ä½å‚ç…§telegraf.confä¸­é‚£äº›snmpç›¸å…³çš„æ³¨é‡Šä»”ç»†æ ¸å¯¹ï¼Œå¦‚æœæ˜¯v2ä¼šç®€å•å¾ˆå¤šï¼ŒæŠŠä¸Šä¾‹ä¸­çš„å¦‚ä¸‹éƒ¨åˆ†ï¼š\nversion = 3 sec_name = \"managev3user\" auth_protocol = \"SHA\" auth_password = \"example.Demo.c0m\" æ¢æˆï¼š\nversion = 2 community = \"public\" å³å¯ï¼Œå½“ç„¶äº†ï¼Œcommunityè¦æ”¹æˆä½ ä»¬è‡ªå·±çš„ï¼Œè¿™é‡Œå†™çš„publicåªæ˜¯ä¸¾ä¸ªä¾‹å­ã€‚\ninputs.snmp.fieldç›¸å…³çš„é‚£äº›é…ç½®ï¼Œå¯ä»¥é‡‡é›†åˆ°å„ä¸ªç½‘å£çš„ç›‘æ§æŒ‡æ ‡ï¼Œæ›´å¤šçš„ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒå®˜ç½‘\n å¦å¤–ï¼Œsnmpçš„é‡‡é›†ï¼Œå»ºè®®å¤§å®¶ä½¿ç”¨ä¸“é—¨çš„Telegrafæ¥åšï¼Œå› ä¸ºå’Œæœºå™¨ã€ä¸­é—´ä»¶ç­‰çš„é‡‡é›†é¢‘ç‡å¯èƒ½ä¸åŒï¼Œæ¯”å¦‚è¾¹ç¼˜äº¤æ¢æœºï¼Œæˆ‘ä»¬5miné‡‡é›†ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œå¦‚æœæŒ‰ç…§é»˜è®¤çš„é…ç½®å¯æ˜¯10sé‡‡é›†ä¸€æ¬¡ï¼Œå®åœ¨æ˜¯å¤ªé¢‘ç¹äº†ï¼Œå¯èƒ½ä¼šç»™ä¸€äº›è€å¼äº¤æ¢æœºé€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ï¼Œé‡‡é›†é¢‘ç‡åœ¨telegraf.confçš„æœ€ä¸Šé¢[agent]éƒ¨åˆ†ï¼Œè¾¹ç¼˜äº¤æ¢æœºå»ºè®®é…ç½®ä¸ºï¼š\n[agent] interval = \"300s\" flush_interval = \"300s\" æ ¸å¿ƒäº¤æ¢æœºå¯ä»¥é…ç½®çš„é¢‘ç¹ä¸€äº›ï¼Œæ¯”å¦‚60sæˆ–è€…120sï¼Œè¯·å„ä½ç½‘ç»œå·¥ç¨‹å¸ˆæœ‹å‹è‡ªè¡Œæ–Ÿé…Œã€‚\n",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§ç½‘ç»œè®¾å¤‡",
    "uri": "/usage/snmp/"
  },
  {
    "content": "Googleæå‡ºäº†åº”ç”¨ç›‘æ§çš„4ä¸ªé»„é‡‘æŒ‡æ ‡ï¼Œåˆ†åˆ«æ˜¯ï¼šæµé‡ã€å»¶è¿Ÿã€é”™è¯¯ã€é¥±å’Œåº¦ï¼Œå…¶ä¸­å‰é¢3ä¸ªæŒ‡æ ‡éƒ½å¯ä»¥é€šè¿‡å†…åµŒSDKçš„æ–¹å¼åŸ‹ç‚¹é‡‡é›†ã€‚å¤œèºæ ¸å¿ƒæ¨¡å—æœ‰ä¸¤ä¸ªï¼Œwebapiä¸»è¦æ˜¯æä¾›httpæ¥å£ç»™JavaScriptè°ƒç”¨ï¼Œserverä¸»è¦æ˜¯è´Ÿè´£æ¥æ”¶ç›‘æ§æ•°æ®ï¼Œå¤„ç†å‘Šè­¦è§„åˆ™ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—éƒ½å¼•å…¥äº†Prometheusçš„Goçš„SDKï¼Œç”¨æ­¤æ–¹å¼åšApp Performanceç›‘æ§ï¼Œæœ¬èŠ‚ä»¥å¤œèºçš„ä»£ç ä¸ºä¾‹ï¼Œè®²è§£å¦‚ä½•ä½¿ç”¨Prometheusçš„SDKã€‚\nwebapiç›‘æ§ webapiæ¨¡å—ä¸»è¦ç»Ÿè®¡ä¸¤ä¸ªå†…å®¹ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚çš„æ•°é‡ç»Ÿè®¡ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚çš„å»¶è¿Ÿç»Ÿè®¡ï¼Œç»Ÿè®¡æ—¶ï¼Œè¦ç”¨ä¸åŒçš„Labelåšç»´åº¦åŒºåˆ†ï¼Œåé¢å°±å¯ä»¥é€šè¿‡ä¸åŒçš„ç»´åº¦åšå¤šç§å¤šæ ·çš„ç»Ÿè®¡åˆ†æï¼Œå¯¹äºHTTPè¯·æ±‚ï¼Œè§„åˆ’4ä¸ªæ ¸å¿ƒLabelï¼Œåˆ†åˆ«æ˜¯ï¼šserviceã€codeã€pathã€methodã€‚serviceæ ‡è¯†æœåŠ¡åç§°ï¼Œè¦æ±‚å…¨å±€å”¯ä¸€ï¼Œä¾¿äºå’Œå…¶ä»–æœåŠ¡åç§°åŒºåˆ†å¼€ï¼Œæ¯”å¦‚webapiæ¨¡å—ï¼Œå°±å®šä¹‰ä¸ºn9e-webapiï¼Œcodeæ˜¯httpè¿”å›çš„çŠ¶æ€ç ï¼Œ200å°±è¡¨ç¤ºæˆåŠŸæ•°é‡ï¼Œå…¶ä»–codeå°±æ˜¯å¤±è´¥çš„ï¼Œåé¢æˆ‘ä»¬å¯ä»¥æ®æ­¤ç»Ÿè®¡æˆåŠŸç‡ï¼Œmethodæ˜¯HTTPæ–¹æ³•ï¼ŒGETã€POSTã€PUTã€DELETEç­‰ï¼Œæ¯”å¦‚æ–°å¢ç”¨æˆ·å’Œè·å–ç”¨æˆ·åˆ—è¡¨å¯èƒ½éƒ½æ˜¯/api/n9e/usersï¼Œä»è·¯å¾„ä¸Šæ— æ³•åŒºåˆ†ï¼Œåªèƒ½å†åŠ ä¸Šmethodæ‰èƒ½åŒºåˆ†å¼€ã€‚\npathç€é‡è¯´ä¸€ä¸‹ï¼Œè¡¨ç¤ºè¯·æ±‚è·¯å¾„ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„/api/n9e/usersï¼Œä½†æ˜¯ï¼Œåœ¨restfulå®è·µä¸­ï¼Œurlä¸­ç»å¸¸ä¼šæœ‰å‚æ•°ï¼Œæ¯”å¦‚è·å–ç¼–å·ä¸º1çš„ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¥å£æ˜¯/api/n9e/user/1ï¼Œè·å–ç¼–å·ä¸º2çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥å£æ˜¯/api/n9e/user/2ï¼Œå¦‚æœè¿™ä¿©å¸¦æœ‰ç”¨æˆ·ç¼–å·çš„urléƒ½ä½œä¸ºLabelï¼Œä¼šé€ æˆæ—¶åºåº“ç´¢å¼•çˆ†ç‚¸ï¼Œè€Œä¸”ä»ä¸šåŠ¡æ–¹ä½¿ç”¨è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å…³æ³¨ç¼–å·ä¸º1çš„ç”¨æˆ·è·å–è¯·æ±‚è¿˜æ˜¯ç¼–å·ä¸º2çš„ç”¨æˆ·è·å–è¯·æ±‚ï¼Œè€Œæ˜¯å…³æ³¨æ•´ä½“çš„GET /api/n9e/user/:idè¿™ä¸ªæ¥å£çš„ç›‘æ§æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è®¾ç½®Labelçš„æ—¶å€™ï¼Œè¦æŠŠpathè®¾ç½®ä¸º/api/n9e/user/:idï¼Œè€Œä¸æ˜¯é‚£å…·ä½“çš„å¸¦æœ‰ç”¨æˆ·ç¼–å·çš„urlè·¯å¾„ã€‚å¤œèºç”¨çš„ginæ¡†æ¶ï¼Œginæ¡†æ¶æœ‰ä¸ªFullPathæ–¹æ³•å°±æ˜¯è·å–è¿™ä¸ªä¿¡æ¯çš„ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬åœ¨webapiä¸‹é¢åˆ›å»ºä¸€ä¸ªstatåŒ…ï¼Œæ”¾ç½®ç›¸å…³ç»Ÿè®¡å˜é‡ï¼š\npackage stat import ( \"time\" \"github.com/prometheus/client_golang/prometheus\" ) const Service = \"n9e-webapi\" var ( labels = []string{\"service\", \"code\", \"path\", \"method\"} uptime = prometheus.NewCounterVec( prometheus.CounterOpts{ Name: \"uptime\", Help: \"HTTP service uptime.\", }, []string{\"service\"}, ) RequestCounter = prometheus.NewCounterVec( prometheus.CounterOpts{ Name: \"http_request_count_total\", Help: \"Total number of HTTP requests made.\", }, labels, ) RequestDuration = prometheus.NewHistogramVec( prometheus.HistogramOpts{ Buckets: []float64{.01, .1, 1, 10}, Name: \"http_request_duration_seconds\", Help: \"HTTP request latencies in seconds.\", }, labels, ) ) func Init() { // Register the summary and the histogram with Prometheus's default registry. \tprometheus.MustRegister( uptime, RequestCounter, RequestDuration, ) go recordUptime() } // recordUptime increases service uptime per second. func recordUptime() { for range time.Tick(time.Second) { uptime.WithLabelValues(Service).Inc() } } uptimeå˜é‡æ˜¯é¡ºæ‰‹ä¸ºä¹‹ï¼Œç»Ÿè®¡è¿›ç¨‹å¯åŠ¨äº†å¤šä¹…æ—¶é—´ï¼Œä¸ç”¨å¤ªå…³æ³¨ï¼ŒRequestCounterå’ŒRequestDurationï¼Œåˆ†åˆ«ç»Ÿè®¡è¯·æ±‚æµé‡å’Œè¯·æ±‚å»¶è¿Ÿã€‚Initæ–¹æ³•æ˜¯åœ¨webapiæ¨¡å—è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼Œæ‰€ä»¥è¿›ç¨‹ä¸€èµ·ï¼Œå°±ä¼šè‡ªåŠ¨æ³¨å†Œå¥½ã€‚\nç„¶åæˆ‘ä»¬å†™ä¸€ä¸ªmiddlewareï¼Œåœ¨è¯·æ±‚è¿›æ¥çš„æ—¶å€™æ‹¦æˆªä¸€ä¸‹ï¼Œçœçš„æ¯ä¸ªè¯·æ±‚éƒ½è¦å»ç»Ÿè®¡ï¼Œmiddlewareæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š\nimport ( ... promstat \"github.com/didi/nightingale/v5/src/webapi/stat\" ) func stat() gin.HandlerFunc { return func(c *gin.Context) { start := time.Now() c.Next() code := fmt.Sprintf(\"%d\", c.Writer.Status()) method := c.Request.Method labels := []string{promstat.Service, code, c.FullPath(), method} promstat.RequestCounter.WithLabelValues(labels...).Inc() promstat.RequestDuration.WithLabelValues(labels...).Observe(float64(time.Since(start).Seconds())) } } æœ‰äº†è¿™ä¸ªmiddlewareä¹‹åï¼Œnewå‡ºginçš„engineçš„æ—¶å€™ï¼Œå°±ç«‹é©¬Useä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š\n... r := gin.New() r.Use(stat()) ... æœ€åï¼Œç›‘æ§æ•°æ®è¦é€šè¿‡/metricsæ¥å£æš´éœ²å‡ºå»ï¼Œæˆ‘ä»¬è¦æš´éœ²è¿™ä¸ªè¯·æ±‚ç«¯ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š\nimport ( ... \"github.com/prometheus/client_golang/prometheus/promhttp\" ) func configRoute(r *gin.Engine, version string) { ... r.GET(\"/metrics\", gin.WrapH(promhttp.Handler())) } å¦‚ä¸Šï¼Œæ¯ä¸ªwebapiçš„æ¥å£çš„æµé‡å’ŒæˆåŠŸç‡éƒ½å¯ä»¥ç›‘æ§åˆ°äº†ã€‚å¦‚æœä½ ä¹Ÿéƒ¨ç½²äº†å¤œèºï¼Œè¯·æ±‚webapiçš„ç«¯å£(é»˜è®¤æ˜¯18000)çš„/metricsæ¥å£çœ‹çœ‹å§ã€‚\nInfoå¦‚æœæœåŠ¡éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œç”šè‡³å¤šä¸ªregionï¼Œå¤šä¸ªç¯å¢ƒï¼Œä¸Šé¢çš„4ä¸ªLabelå°±ä¸å¤Ÿç”¨äº†ï¼Œå› ä¸ºåªæœ‰è¿™4ä¸ªLabelä¸è¶³ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ï¼Œæ­¤æ—¶éœ€è¦envã€regionã€instanceè¿™ç§Labelï¼Œè¿™äº›Labelä¸éœ€è¦åœ¨ä»£ç é‡ŒåŸ‹ç‚¹ï¼Œåœ¨é‡‡é›†çš„æ—¶å€™ä¸€èˆ¬å¯ä»¥é™„åŠ é¢å¤–çš„æ ‡ç­¾ï¼Œé€šè¿‡é™„åŠ æ ‡ç­¾çš„æ–¹å¼æ¥å¤„ç†å³å¯\n serverç›‘æ§ serveræ¨¡å—çš„ç›‘æ§ï¼Œå’Œwebapiæ¨¡å—çš„ç›‘æ§å·®å¼‚è¾ƒå¤§ï¼Œå› ä¸ºå…³æ³¨ç‚¹ä¸åŒï¼Œwebapiå…³æ³¨çš„æ˜¯HTTPæ¥å£çš„è¯·æ±‚é‡å’Œå»¶è¿Ÿï¼Œè€Œserveræ¨¡å—å…³æ³¨çš„æ˜¯æ¥æ”¶äº†å¤šå°‘ç›‘æ§æŒ‡æ ‡ï¼Œå†…éƒ¨äº‹ä»¶é˜Ÿåˆ—çš„é•¿åº¦ï¼Œä»æ•°æ®åº“åŒæ­¥å‘Šè­¦è§„åˆ™èŠ±è´¹å¤šä¹…ï¼ŒåŒæ­¥äº†å¤šå°‘æ¡æ•°æ®ç­‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨serverçš„packageä¸‹åˆ›å»ºä¸€ä¸ªstatåŒ…ï¼ŒstatåŒ…ä¸‹æ”¾ç½®stat.goï¼Œå†…å®¹å¦‚ä¸‹ï¼š\npackage stat import ( \"github.com/prometheus/client_golang/prometheus\" ) const ( namespace = \"n9e\" subsystem = \"server\" ) var ( // å„ä¸ªå‘¨æœŸæ€§ä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶ \tGaugeCronDuration = prometheus.NewGaugeVec(prometheus.GaugeOpts{ Namespace: namespace, Subsystem: subsystem, Name: \"cron_duration\", Help: \"Cron method use duration, unit: ms.\", }, []string{\"cluster\", \"name\"}) // ä»æ•°æ®åº“åŒæ­¥æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ­¥çš„æ¡æ•° \tGaugeSyncNumber = prometheus.NewGaugeVec(prometheus.GaugeOpts{ Namespace: namespace, Subsystem: subsystem, Name: \"cron_sync_number\", Help: \"Cron sync number.\", }, []string{\"cluster\", \"name\"}) // ä»å„ä¸ªæ¥æ”¶æ¥å£æ¥æ”¶åˆ°çš„ç›‘æ§æ•°æ®æ€»é‡ \tCounterSampleTotal = prometheus.NewCounterVec(prometheus.CounterOpts{ Namespace: namespace, Subsystem: subsystem, Name: \"samples_received_total\", Help: \"Total number samples received.\", }, []string{\"cluster\", \"channel\"}) // äº§ç”Ÿçš„å‘Šè­¦æ€»é‡ \tCounterAlertsTotal = prometheus.NewCounterVec(prometheus.CounterOpts{ Namespace: namespace, Subsystem: subsystem, Name: \"alerts_total\", Help: \"Total number alert events.\", }, []string{\"cluster\"}) // å†…å­˜ä¸­çš„å‘Šè­¦äº‹ä»¶é˜Ÿåˆ—çš„é•¿åº¦ \tGaugeAlertQueueSize = prometheus.NewGaugeVec(prometheus.GaugeOpts{ Namespace: namespace, Subsystem: subsystem, Name: \"alert_queue_size\", Help: \"The size of alert queue.\", }, []string{\"cluster\"}) ) func Init() { // Register the summary and the histogram with Prometheus's default registry. \tprometheus.MustRegister( GaugeCronDuration, GaugeSyncNumber, CounterSampleTotal, CounterAlertsTotal, GaugeAlertQueueSize, ) } å®šä¹‰ä¸€ä¸ªç›‘æ§æŒ‡æ ‡ï¼Œé™¤äº†nameä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®namespaceã€subsystemï¼Œæœ€ç»ˆé€šè¿‡/metricsæ¥å£æš´éœ²çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°ï¼šç›‘æ§æŒ‡æ ‡çš„æœ€ç»ˆåå­—ï¼Œå°±æ˜¯$namespace_$subsystem_$nameï¼Œä¸‰è€…æ‹¼æ¥åœ¨ä¸€èµ·ã€‚webapiæ¨¡å—çš„ç›‘æ§ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°äº†counterç±»å‹å’Œhistogramç±»å‹çš„å¤„ç†ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‹¿GaugeAlertQueueSizeä¸¾ä¾‹ï¼Œè¿™æ˜¯ä¸ªGAUGEç±»å‹çš„ç»Ÿè®¡æ•°æ®ï¼Œèµ·ä¸€ä¸ªgoroutineå‘¨æœŸæ€§è·å–é˜Ÿåˆ—é•¿åº¦ï¼Œç„¶åSetåˆ°GaugeAlertQueueSizeä¸­ï¼š\npackage engine import ( \"context\" \"time\" \"github.com/didi/nightingale/v5/src/server/config\" promstat \"github.com/didi/nightingale/v5/src/server/stat\" ) func Start(ctx context.Context) error { ... go reportQueueSize() return nil } func reportQueueSize() { for { time.Sleep(time.Second) promstat.GaugeAlertQueueSize.WithLabelValues(config.C.ClusterName).Set(float64(EventQueue.Len())) } } å¦å¤–ï¼ŒInitæ–¹æ³•è¦åœ¨serveræ¨¡å—åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼Œserverçš„router.goä¸­è¦æš´éœ²/metricsç«¯ç‚¹è·¯å¾„ï¼Œè¿™äº›å°±ä¸å†è¯¦è¿°äº†ï¼Œå¤§å®¶å¯ä»¥æ‰’æ‹‰ä¸€ä¸‹å¤œèºçš„ä»£ç çœ‹ä¸€ä¸‹ã€‚\næ•°æ®æŠ“å– åº”ç”¨è‡ªèº«çš„ç›‘æ§æ•°æ®å·²ç»é€šè¿‡/metricsæ¥å£æš´éœ²äº†ï¼Œåç»­é‡‡é›†è§„åˆ™å¯ä»¥åœ¨prometheus.ymlä¸­é…ç½®ï¼Œprometheus.ymlä¸­æœ‰ä¸ªsectionå«ï¼šscrape_configså¯ä»¥é…ç½®æŠ“å–ç›®æ ‡ï¼Œè¿™æ˜¯PrometheusèŒƒç•´çš„çŸ¥è¯†äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒPrometheuså®˜ç½‘ã€‚\nå‚è€ƒèµ„æ–™  https://prometheus.io/docs/instrumenting/clientlibs/ https://github.com/prometheus/client_golang/tree/master/examples  ",
    "description": "",
    "tags": null,
    "title": "åŸ‹ç‚¹ç›‘æ§ä¹‹PromSDK",
    "uri": "/usage/promapm/"
  },
  {
    "content": "StatsDç®€ä»‹ åœ¨å†…åµŒPrometheus SDKåšAPMä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸šåŠ¡è¿›ç¨‹å†…åµŒPrometheusçš„SDKåšåŸ‹ç‚¹ï¼Œè¿™ç§æ–¹å¼ï¼Œä¼šæŠŠç›‘æ§æ•°æ®èšåˆè®¡ç®—çš„é€»è¾‘æ”¾åœ¨ä¸šåŠ¡è¿›ç¨‹ä¸­ï¼Œæ¯”å¦‚ä¸€äº›å¹³å‡å€¼ã€åˆ†ä½å€¼çš„è®¡ç®—ï¼Œå¯èƒ½ä¼šå¯¹ä¸šåŠ¡è¿›ç¨‹é€ æˆå½±å“ï¼Œæœ¬èŠ‚è¦ä»‹ç»çš„StatsDçš„æ–¹å¼ï¼Œç†å¿µæ˜¯æŠŠæŒ‡æ ‡èšåˆè®¡ç®—çš„é€»è¾‘æŒªåˆ°ä¸šåŠ¡è¿›ç¨‹ä¹‹å¤–ï¼Œä¸šåŠ¡è¿›ç¨‹è°ƒç”¨åŸ‹ç‚¹å‡½æ•°çš„æ—¶å€™ï¼Œé€šè¿‡UDPæ¨é€ç»™StatsDï¼Œå³ä½¿StatsDæŒ‚äº†ï¼Œä¹Ÿä¸ä¼šå¯¹ä¸šåŠ¡è¿›ç¨‹é€ æˆå½±å“ã€‚\nStatsDçš„ç®€ä»‹ï¼Œç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼Œè¯·å¤§å®¶è‡ªè¡ŒGoogleï¼Œè¿™é‡Œå°±ä¸é‡å¤æè¿°äº†ã€‚æ ¸å¿ƒè¦ç†è§£ä¸€ä¸‹StatsDçš„è®¾è®¡ç†å¿µã€åè®®ã€æ”¯æŒçš„å„ä¸ªè¯­è¨€çš„SDKï¼ˆåœ¨é™„å½•é‡Œæœ‰ï¼‰å³å¯ï¼Œä¸‹é¢ç›´æ¥æ‹¿ä¸€ä¸ªå°ä¾‹å­è®²è§£å¦‚ä½•åˆ©ç”¨Telegrafæ”¯æŒStatsDåè®®çš„æ•°æ®ï¼Œæ•°æ®åªè¦è¿›äº†Telegrafäº†ï¼Œå°±æ„å‘³ç€å¯ä»¥æ¨åˆ°å¤œèºäº†ï¼Œå¤œèºå°±ç›¸å½“äºæ”¯æŒäº†StatsDçš„åŸ‹ç‚¹ç›‘æ§é‡‡é›†èƒ½åŠ›ã€‚\nTelegrafå¯ç”¨StatsD åœ¨Telegrafçš„é…ç½®æ–‡ä»¶ä¸­æœç´¢inputs.statsdå°±èƒ½çœ‹åˆ°å¯¹åº”çš„sectionï¼š\n[[inputs.statsd]] protocol = \"udp\" service_address = \":8125\" percentiles = [50.0, 90.0, 99.0, 99.9, 99.95, 100.0] metric_separator = \"_\" å¯ç”¨å¦‚ä¸Šé…ç½®ï¼Œpercentilesç•¥å¾®æœ‰ç‚¹å¤šï¼Œå¯ä»¥é…ç½®çš„å°‘ä¸€ç‚¹ï¼Œæ¯”å¦‚percentiles = [50.0, 90.0, 99.0, 100.0]ï¼Œè¿™æ ·æ•´ä½“è®¡ç®—å­˜å‚¨å‹åŠ›ä¹Ÿä¼šå°ä¸€äº›ã€‚é‡å¯Telegrafï¼ŒTelegrafå°±ä¼šåœ¨8125ç«¯å£ç›‘å¬udpåè®®ï¼Œæ¥æ”¶ä¸šåŠ¡åŸ‹ç‚¹æ•°æ®çš„ä¸ŠæŠ¥ã€‚å³ï¼ŒTelegrafå®ç°äº†StatsDçš„åè®®ï¼Œå¯ä»¥ä½œä¸ºStatsDçš„Serverä½¿ç”¨ã€‚\nåœ¨ä¸šåŠ¡ç¨‹åºä¸­åŸ‹ç‚¹ é™„å½•é‡Œç½—åˆ—äº†ä¸€äº›å®¢æˆ·ç«¯SDKï¼Œè¿™é‡Œç¬”è€…ä½¿ç”¨Goè¯­è¨€çš„ä¸€ä¸ªSDKæ¥æµ‹è¯•ï¼Œå®ç°äº†ä¸€ä¸ªå¾ˆå°çš„webç¨‹åºï¼Œä»£ç å¦‚ä¸‹ï¼š\npackage main import ( \"fmt\" \"math/rand\" \"net/http\" \"time\" \"github.com/smira/go-statsd\" ) var client *statsd.Client func homeHandler(w http.ResponseWriter, r *http.Request) { start := time.Now() // random sleep \tnum := rand.Int31n(100) time.Sleep(time.Duration(num) * time.Millisecond) fmt.Fprintf(w, \"duration: %d\", num) client.Incr(\"requests.counter,page=home\", 1) client.PrecisionTiming(\"requests.latency,page=home\", time.Since(start)) } func main() { // init client \tclient = statsd.NewClient(\"localhost:8125\", statsd.TagStyle(statsd.TagFormatInfluxDB), statsd.MaxPacketSize(1400), statsd.MetricPrefix(\"http.\"), statsd.DefaultTags(statsd.StringTag(\"service\", \"n9e-webapi\"), statsd.StringTag(\"region\", \"bj\")), ) defer client.Close() http.HandleFunc(\"/\", homeHandler) http.ListenAndServe(\":8000\", nil) } è¿™ä¸ªwebæœåŠ¡åªæœ‰ä¸€ä¸ªæ ¹è·¯å¾„ï¼Œé€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯éšæœºsleepå‡ åä¸ªæ¯«ç§’å½“åšä¸šåŠ¡å¤„ç†æ—¶é—´ã€‚æ•´ä½“é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬è¦é€šè¿‡statsd.NewClientåˆå§‹åŒ–ä¸€ä¸ªstatsdçš„å®¢æˆ·ç«¯ï¼Œå‚æ•°ä¸­æŒ‡å®šäº†StatsDçš„Serveråœ°å€ï¼ˆåœ¨æœ¬ä¾‹ä¸­å°±æ˜¯Telegrafçš„8125ï¼‰ï¼ŒæŒ‡å®šäº†æ‰€æœ‰ç›‘æ§æŒ‡æ ‡çš„å‰ç¼€æ˜¯http.ï¼Œè¿˜æŒ‡å®šäº†ä¸¤ä¸ªå…¨å±€Tagï¼Œä¸€ä¸ªæ˜¯service=n9e-webapiï¼Œå¦ä¸€ä¸ªæ˜¯region=bjï¼Œé€šè¿‡TagStyleæŒ‡å®šäº†è¦å‘é€çš„æ˜¯InfluxDBæ ·å¼ï¼ˆå› ä¸ºæ•°æ®æ˜¯å‘ç»™Telegrafçš„ï¼ŒTelegrafæ˜¯InfluxDBç”Ÿæ€çš„ï¼‰çš„æ ‡ç­¾ã€‚ç„¶åï¼Œåœ¨è¯·æ±‚çš„å…·ä½“å¤„ç†é€»è¾‘é‡Œä¸ŠæŠ¥äº†ä¸¤ä¸ªç›‘æ§æŒ‡æ ‡ï¼Œä¸€ä¸ªæ˜¯requests.counterï¼Œå¦ä¸€ä¸ªæ˜¯requests.latencyï¼Œå¹¶ä¸”ï¼Œä¸ºè¿™ä¿©æŒ‡æ ‡æŒ‡å®šäº†ä¸€ä¸ªæŒ‡æ ‡çº§åˆ«çš„æ ‡ç­¾page=homeï¼Œæ•´ä½“çœ‹èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚\næµ‹è¯•æ–¹æ³• ä¸Šé¢çš„Goç¨‹åºç¼–è¯‘ä¸€ä¸‹ï¼Œå¯åŠ¨ï¼Œä¼šä½œä¸ºä¸€ä¸ªweb serverç›‘å¬åœ¨8000ç«¯å£ï¼Œç„¶åå‘¨æœŸæ€§è¯·æ±‚è¿™ä¸ªweb serverçš„åœ°å€åšæµ‹è¯•ï¼Œè¿™ä¸ªweb serveræ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå°±è°ƒç”¨statsdçš„sdkï¼Œstatsdçš„sdkçš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯æŠŠæ•°æ®å‘ç»™Telegrafçš„8125ï¼Œç„¶åå°±æ˜¯Telegrafå¤„ç†èšåˆé€»è¾‘ï¼Œèšåˆä¹‹åçš„æ•°æ®æ¯10sï¼ˆé»˜è®¤flushé¢‘ç‡ï¼‰å‘ç»™å¤œèºã€‚\nåœ¨é¡µé¢ä¸Šï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°http_requests_latencyå’Œhttp_requests_counteræ‰“å¤´çš„ç›¸å…³æŒ‡æ ‡ï¼Œæ¯”å¦‚http_requests_latency_meanè¿™ä¸ªæŒ‡æ ‡ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªæŒ‡æ ‡æœ‰å¦‚ä¸‹å‡ ä¸ªæ ‡ç­¾ï¼š\n ident: VM-0-4-centos è¿™ä¸ªæ ‡ç­¾å…¶å®æ˜¯TelegrafåŸå§‹çš„hostæ ‡ç­¾ï¼Œå¤œèºçš„è§„èŒƒé‡Œå«identï¼Œæ‰€ä»¥åšäº†ä¸€ä¸‹rename metric_type: timing è¿™ä¸ªæ˜¾ç„¶æ˜¯æŠŠstatsdçš„æ•°æ®ç±»å‹ä¹Ÿåšä¸ºæ ‡ç­¾äº†ï¼Œå…¶ä»–æ•°æ®ç±»å‹è¿˜æœ‰gaugeã€counterã€setç­‰ page: home è¿™æ˜¯æˆ‘ä»¬ä»£ç é‡Œé™„åˆ°ç›‘æ§æŒ‡æ ‡åé¢çš„æ ‡ç­¾ï¼ŒTelegrafè‡ªåŠ¨å¸®è§£æå‡ºæ¥äº† service: n9e-webapi NewClientæ—¶å€™é™„åŠ çš„å…¨å±€é»˜è®¤æ ‡ç­¾ region: bj NewClientæ—¶å€™é™„åŠ çš„å…¨å±€é»˜è®¤æ ‡ç­¾  é™„å½•èµ„æ–™  Measure Anything, Measure Everything Statsdæ”¯æŒçš„çš„å®¢æˆ·ç«¯SDKåˆ—è¡¨  ",
    "description": "",
    "tags": null,
    "title": "åŸ‹ç‚¹ç›‘æ§ä¹‹StatsdSDK",
    "uri": "/usage/statsd/"
  },
  {
    "content": "è¯·å‚è€ƒå¦‚ä¸‹è§†é¢‘æ•™ç¨‹ï¼š\n 01-ä½¿ç”¨Docker Composeä¸€è¡Œå‘½ä»¤å®‰è£…å¤œèºv5 02-å¿«é€Ÿåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¯åŠ¨å•æœºç‰ˆå¤œèºv5 03-è®²è§£å¤œèºv5äººå‘˜ç»„ç»‡ç›¸å…³åŠŸèƒ½ 04-è®²è§£å¤œèºv5ç›‘æ§çœ‹å›¾ç›¸å…³åŠŸèƒ½ 05-è®²è§£å¤œèºv5å‘Šè­¦è§„åˆ™çš„ä½¿ç”¨ 06-è®²è§£å¤œèºv5å‘Šè­¦å±è”½è§„åˆ™çš„ä½¿ç”¨ 07-è®²è§£å¤œèºå‘Šè­¦è®¢é˜…è§„åˆ™çš„ä½¿ç”¨ 08-è®²è§£å¤œèºv5æ´»è·ƒå‘Šè­¦å’Œå†å²å‘Šè­¦ 09-è®²è§£å¤œèºv5å‘Šè­¦è‡ªæ„ˆè„šæœ¬çš„ä½¿ç”¨ 10-è®²è§£å¤œèºç›‘æ§å¯¹è±¡çš„ç®¡ç†åŠŸèƒ½ 11-å¤œèºv5å¦‚ä½•æ¥å…¥å¤šä¸ªæ—¶åºå­˜å‚¨ 12-è®²è§£å¤œèºv5é…ç½®æ–‡ä»¶  å¦‚æœä»ç„¶æœ‰ä½¿ç”¨é—®é¢˜ï¼Œå¯ä»¥è”ç³»æˆ‘ä»¬ï¼Œè”ç³»æ–¹å¼å¦‚ä¸‹ï¼Œå…¬ä¼—å·ï¼š\n",
    "description": "",
    "tags": null,
    "title": "åŠŸèƒ½ä»‹ç»",
    "uri": "/usage/"
  },
  {
    "content": "ä¹‹å‰åœ¨å†™è°ƒç ”ç¬”è®°çš„æ—¶å€™ï¼Œæµ‹è¯•äº†PINGç›‘æ§å’ŒTCPæ¢æµ‹ç›‘æ§ï¼Œè°ƒç ”ç¬”è®°åœ¨ è¿™é‡Œ è¿™ä¸ªç« èŠ‚ä¸»è¦ç»™å¤§å®¶è®²è§£åŸŸåURLæ¢æµ‹ã€‚ç›´æ¥ä¸Šæµ‹è¯•é…ç½®ï¼š\n[[inputs.http_response]] urls = [\"https://www.baidu.com\", \"http://ulricqin.io/ping\"] response_timeout = \"5s\" method = \"GET\" fielddrop = [\"result_type\"] tagexclude = [\"result\", \"status_code\"] https://www.baidu.com æ˜¾ç„¶æ˜¯é€šçš„ï¼Œhttp://ulricqin.io/ping è¿™ä¸ªæ˜¯ä¸ªå‡çš„URLï¼Œä¸é€šï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹è¾“å‡ºçš„å†…å®¹ï¼š\n[root@10-255-0-34 telegraf-1.20.3]# ./usr/bin/telegraf --config etc/telegraf/telegraf.conf --input-filter http_response --test 2021-12-13T04:16:43Z I! Starting Telegraf 1.20.3 \u003e http_response,host=10-255-0-34,method=GET,server=https://www.baidu.com content_length=227i,http_response_code=200i,response_time=0.028757521,result_code=0i 1639369003000000000 \u003e http_response,host=10-255-0-34,method=GET,server=http://ulricqin.io/ping result_code=5i 1639369003000000000 è¿™é‡Œæœ‰ä¸ªå­—æ®µæ˜¯result_codeï¼Œç”¨è¿™ä¸ªå­—æ®µé…ç½®å‘Šè­¦å³å¯ï¼Œæ­£å¸¸å¯ä»¥è®¿é—®çš„URLï¼Œresult_codeæ˜¯0ï¼Œä¸æ­£å¸¸å°±æ˜¯é0ï¼Œå‘Šè­¦è§„åˆ™é‡Œå¯ä»¥é…ç½®å¦‚ä¸‹promqlï¼š\nhttp_response_result_code != 0 æˆ–è€…ç›´æ¥åœ¨å¤œèºçš„å‘Šè­¦è§„åˆ™é¡µé¢å¯¼å…¥è¿™æ¡å‘Šè­¦è§„åˆ™JSONï¼š\n[ { \"name\": \"æœ‰URLæ¢æµ‹å¤±è´¥ï¼Œè¯·æ³¨æ„\", \"note\": \"\", \"severity\": 1, \"disabled\": 0, \"prom_for_duration\": 60, \"prom_ql\": \"http_response_result_code != 0\", \"prom_eval_interval\": 15, \"enable_stime\": \"00:00\", \"enable_etime\": \"23:59\", \"enable_days_of_week\": [ \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"0\" ], \"notify_recovered\": 1, \"notify_channels\": [ \"email\", \"dingtalk\", \"wecom\" ], \"notify_repeat_step\": 60, \"callbacks\": [], \"runbook_url\": \"\", \"append_tags\": [] } ] å¦‚æœæƒ³å¯¹åŸŸåè¿”å›çš„statuscodeæˆ–è€…response bodyçš„å†…å®¹åšåˆ¤æ–­ï¼ŒTelegrafä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œä½¿ç”¨response_status_codeå’Œresponse_string_matchè¿™äº›å­—æ®µé…ç½®ï¼Œé…ç½®æ–‡ä»¶é‡Œæœ‰æ ·ä¾‹ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå‚è€ƒä¸‹ã€‚\n",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§URL",
    "uri": "/usage/http_response/"
  },
  {
    "content": "å‰è¨€ è¯´åˆ°æ—¥å¿—ç›‘æ§ï¼Œå¤§å®¶ç¬¬ä¸€ååº”çš„å¯èƒ½æ˜¯ELKçš„æ–¹æ¡ˆï¼Œæˆ–è€…Lokiçš„æ–¹æ¡ˆï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆéƒ½æ˜¯æŠŠæ—¥å¿—é‡‡é›†äº†å‘åˆ°ä¸­å¿ƒï¼Œåœ¨ä¸­å¿ƒå­˜å‚¨ã€æŸ¥çœ‹ã€åˆ†æï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆç›¸å¯¹æ¯”è¾ƒé‡é‡çº§ä¸€äº›ï¼Œå¦‚æœæˆ‘ä»¬çš„éœ€æ±‚åªæ˜¯ä»æ—¥å¿—ä¸­æå–ä¸€äº›metricsæ•°æ®ï¼Œæ¯”å¦‚ç»Ÿè®¡ä¸€äº›æ—¥å¿—ä¸­å‡ºç°çš„Erroræ¬¡æ•°ä¹‹ç±»çš„ï¼Œåˆ™æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ¡ˆã€‚\nè¿™ä¸ªæ–¹æ¡ˆåœ¨å¤œèºv4ç‰ˆæœ¬ä¸­æ˜¯æœ‰çš„ï¼Œä¸è¿‡åæ¥æ¨èå¤§å®¶å®¢æˆ·ç«¯ä½¿ç”¨Telegrafï¼ŒTelegrafæ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œæ‰€ä»¥v5ç‰ˆæœ¬çš„å¤œèºæ²¡æ³•ç›‘æ§æ—¥å¿—ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªGoogleå‡ºå“çš„å°å·¥å…·ï¼Œmtailï¼Œmtailå’Œå¤œèºv4çš„æ–¹æ¡ˆç±»ä¼¼ï¼Œå°±æ˜¯æµå¼è¯»å–æ—¥å¿—ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–¹å¼ä»æ—¥å¿—ä¸­æå–metricsæŒ‡æ ‡ï¼Œè¿™ç§æ–¹å¼å¯ä»¥åˆ©ç”¨ç›®æ ‡æœºå™¨çš„ç®—åŠ›ï¼Œä¸è¿‡å¦‚æœé‡å¤ªå¤§ï¼Œå¯èƒ½ä¼šå½±å“ç›®æ ‡æœºå™¨ä¸Šçš„ä¸šåŠ¡ç¨‹åºï¼Œå¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯æ— ä¾µå…¥æ€§ï¼Œä¸éœ€è¦ä¸šåŠ¡åŸ‹ç‚¹ï¼Œå¦‚æœä¸šåŠ¡ç¨‹åºæ˜¯ç¬¬ä¸‰æ–¹ä¾›åº”å•†æä¾›çš„ï¼Œæˆ‘ä»¬æ”¹ä¸äº†å…¶ä»£ç ï¼Œmtailæ­¤æ—¶å°±éå¸¸åˆé€‚äº†ã€‚å½“ç„¶äº†ï¼Œå¦‚æœä¸šåŠ¡ç¨‹åºæ˜¯æˆ‘ä»¬å…¬å¸çš„äººè‡ªå·±å†™çš„ï¼Œé‚£è¿˜æ˜¯å»ºè®®ç”¨åŸ‹ç‚¹çš„æ–¹å¼é‡‡é›†æŒ‡æ ‡ï¼Œmtailåªæ˜¯ä½œä¸ºä¸€ä¸ªè¡¥å……å§ã€‚\nmtailç®€ä»‹ mtailçš„ä½¿ç”¨æ–¹æ¡ˆï¼Œå‚è€ƒå¦‚ä¸‹ä¸¤ä¸ªæ–‡æ¡£ï¼ˆä¸‹è½½çš„è¯å‚è€ƒReleasesé¡µé¢ï¼‰ï¼š\n Deploying Programming Guide  æˆ‘ä»¬æ‹¿mtailçš„å¯åŠ¨å‘½ä»¤æ¥ä¸¾ä¾‹å…¶ç”¨æ³•ï¼š\nmtail --progs /etc/mtail --logs /var/log/syslog --logs /var/log/ntp/peerstats é€šè¿‡ --progs å‚æ•°æŒ‡å®šä¸€ä¸ªç›®å½•ï¼Œè¿™ä¸ªç›®å½•é‡Œæ”¾ç½®ä¸€å †çš„*.mtailæ–‡ä»¶ï¼Œæ¯ä¸ªmtailæ–‡ä»¶å°±æ˜¯æè¿°çš„æ­£åˆ™æå–è§„åˆ™ï¼Œé€šè¿‡ --logs å‚æ•°æ¥æŒ‡å®šè¦ç›‘æ§çš„æ—¥å¿—ç›®å½•ï¼Œå¯ä»¥å†™é€šé…ç¬¦ï¼Œ--logs å¯ä»¥å†™å¤šæ¬¡ï¼Œä¸Šä¾‹ä¸­åªæ˜¯æŒ‡å®šäº† --progs å’Œ --logs ï¼Œæ²¡æœ‰å…¶ä»–å‚æ•°ï¼Œmtailå¯åŠ¨ä¹‹åä¼šè‡ªåŠ¨ç›‘å¬ä¸€ä¸ªç«¯å£3903ï¼Œåœ¨3903çš„/metricsæ¥å£æš´éœ²ç¬¦åˆPrometheusåè®®çš„ç›‘æ§æ•°æ®ï¼ŒPrometheusï¼ˆæˆ–è€…Telegrafï¼‰å°±å¯ä»¥ä» /metrics æ¥å£æå–ç›‘æ§æ•°æ®ã€‚\nè¿™æ ·çœ‹èµ·æ¥ï¼ŒåŸç†å°±å¾ˆæ¸…æ™°äº†ï¼Œmtailå¯åŠ¨ä¹‹åï¼Œæ ¹æ® --logs æ‰¾åˆ°ç›¸å…³æ—¥å¿—æ–‡ä»¶æ–‡ä»¶ï¼Œseekåˆ°æ–‡ä»¶æœ«å°¾ï¼Œå¼€å§‹æµå¼è¯»å–ï¼Œæ¯è¯»åˆ°ä¸€è¡Œï¼Œå°±æ ¹æ® --progs æŒ‡å®šçš„é‚£äº›è§„åˆ™æ–‡ä»¶åšåŒ¹é…ï¼Œçœ‹æ˜¯å¦ç¬¦åˆæŸäº›æ­£åˆ™ï¼Œä»ä¸­æå–æ—¶åºæ•°æ®ï¼Œç„¶åé€šè¿‡3903çš„/metricsæš´éœ²é‡‡é›†åˆ°çš„ç›‘æ§æŒ‡æ ‡ã€‚å½“ç„¶ï¼Œé™¤äº†Prometheusè¿™ç§/metricsæ–¹å¼æš´éœ²ï¼Œmtailè¿˜æ”¯æŒæŠŠç›‘æ§æ•°æ®ç›´æ¥æ¨ç»™graphiteæˆ–è€…statsdï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼šè¿™é‡Œ\nmtailæ ·ä¾‹ è¿™é‡Œæˆ‘ç”¨mtailç›‘æ§ä¸€ä¸‹n9e-serverçš„æ—¥å¿—ï¼Œä»ä¸­æå–ä¸€ä¸‹å„ä¸ªå‘Šè­¦è§„åˆ™è§¦å‘çš„notifyçš„æ•°é‡ï¼Œè¿™ä¸ªæ—¥å¿—ä¸¾ä¾‹ï¼š\n2021-12-27 10:00:30.537582 INFO engine/logger.go:19 event(cbb8d4be5efd07983c296aaa4dec5737 triggered) notify: rule_id=9 [__name__=net_response_result_code author=qin ident=10-255-0-34 port=4567 protocol=tcp server=localhost]2@1640570430 å¾ˆæ˜æ˜¾ï¼Œæ—¥å¿—ä¸­æœ‰è¿™ä¹ˆä¸ªå…³é”®å­—ï¼šnotify: rule_id=9ï¼Œå¯ä»¥ç”¨æ­£åˆ™æ¥åŒ¹é…ï¼Œç»Ÿè®¡å‡ºç°çš„è¡Œæ•°ï¼Œruleidä¹Ÿå¯ä»¥ä»ä¸­æå–åˆ°ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠruleidä½œä¸ºæ ‡ç­¾ä¸ŠæŠ¥ï¼Œäºæ˜¯ä¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºè¿™æ ·çš„mtailè§„åˆ™äº†ï¼š\n[root@10-255-0-34 nightingale]# cat /etc/mtail/n9e-server.mtail counter mtail_alert_rule_notify_total by ruleid /notify: rule_id=(?P\u003cruleid\u003e\\d+)/ { mtail_alert_rule_notify_total[$ruleid]++ } ç„¶åå¯åŠ¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘è¿™é‡Œå°±ç”¨nohupç®€å•æ¥åšï¼š\nnohup mtail -logtostderr --progs /etc/mtail --logs server.log \u0026\u003e stdout.log \u0026 mtailæ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œæ˜¯å› ä¸ºæˆ‘æŠŠmtailçš„äºŒè¿›åˆ¶ç›´æ¥æ”¾åœ¨äº† /usr/bin ä¸‹é¢äº†ï¼Œmtailé»˜è®¤ä¼šç›‘å¬åœ¨3903ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤éªŒè¯ï¼š\ncurl -s localhost:3903/metrics å¯ä»¥çœ‹åˆ°è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š\n# HELP mtail_alert_rule_notify_total defined at n9e-server.mtail:1:9-37 # TYPE mtail_alert_rule_notify_total counter mtail_alert_rule_notify_total{prog=\"n9e-server.mtail\",ruleid=\"9\"} 6 ä¸Šé¢çš„è¾“å‡ºåªæ˜¯æŒ‘é€‰äº†éƒ¨åˆ†å†…å®¹ï¼Œæ²¡æœ‰å…¨éƒ¨æ”¾å‡ºæ¥å“ˆï¼Œè¿™å°±è¡¨ç¤ºæ­£å¸¸é‡‡é›†åˆ°äº†ï¼Œå¦‚æœn9eçš„server.logä¸­å½“å‰æ²¡æœ‰æ‰“å°notifyç›¸å…³çš„æ—¥å¿—ï¼Œé‚£è¯·æ±‚/metricsæ¥å£æ˜¯æ²¡æ³•å¾—åˆ°ä¸Šé¢çš„è¾“å‡ºçš„ï¼Œå¯ä»¥æ‰‹å·¥é…ç½®ä¸€æ¡å¿…ç„¶ä¼šè§¦å‘çš„è§„åˆ™ï¼Œå¾…æ—¥å¿—é‡Œæœ‰ç›¸å…³è¾“å‡ºçš„æ—¶å€™å†æ¬¡è¯·æ±‚ /metrics æ¥å£ï¼Œåº”è¯¥å°±æœ‰äº†\næœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨Telegrafæ¥é‡‡é›†ä¸€ä¸‹ localhost:3903/metrics è¿™ä¸ªåœ°å€çš„è¾“å‡ºï¼Œåœ¨telegraf.confä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š\n[[inputs.prometheus]] urls = [\"http://localhost:3903/metrics\"] å®Œäº‹é‡å¯Telegrafæˆ–è€…ç»™Telegrafè¿›ç¨‹å‘ä¸€ä¸ªSIGHUPä¿¡å·ï¼š\nkill -HUP `pidof telegraf` ç­‰ä¸€ä¼šï¼Œå°±å¯ä»¥åœ¨é¡µé¢ä¸ŠæŸ¥åˆ°ç›¸å…³æŒ‡æ ‡äº†ï¼Œæˆ‘ä»¬æ‹¿ç€mtail_alert_rule_notify_totalè¿™ä¸ªæŒ‡æ ‡å»å³æ—¶æŸ¥è¯¢é‡ŒæŸ¥ï¼Œä¼šå‘ç°æŸ¥ä¸åˆ°æ•°æ®ï¼Œè€Œæ˜¯å‡ºç°äº†ä¸€ä¸ªmtail_alert_rule_notify_total_counterè¿™æ ·çš„æŒ‡æ ‡ï¼Œçœ‹èµ·æ¥åƒæ˜¯Telegrafå¯¹äºPrometheusåè®®çš„ç›‘æ§æ•°æ®ï¼Œè‡ªåŠ¨åŠ äº†åç¼€ï¼Œæ— æ‰€è°“äº†ï¼Œå¤§å®¶æ³¨æ„ä¸€ä¸‹å°±å¥½ã€‚å¦‚æœåœ¨prometheus.yamlä¸­é…ç½®scrape_configæ¥æŠ“å–mtailï¼Œåº”è¯¥ä¸ä¼šè‡ªåŠ¨åŠ ä¸Š_counterçš„åç¼€ã€‚\nå¦å¤–ï¼Œmtailçš„é…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œæ˜¯éœ€è¦é‡å¯mtailæ‰èƒ½ç”Ÿæ•ˆçš„ï¼Œæˆ–è€…ä¹Ÿæ˜¯ç±»ä¼¼Telegrafé‚£æ ·å‘ä¸€ä¸ªSIGHUPä¿¡å·ç»™mtailï¼Œmtailæ”¶åˆ°ä¿¡å·å°±ä¼šé‡æ–°åŠ è½½é…ç½®ã€‚\nmtailæ›´å¤šæ ·ä¾‹ mtailçš„github repoä¸­æœ‰ä¸€ä¸ªexamplesï¼Œé‡Œè¾¹æœ‰æŒºå¤šä¾‹å­ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒã€‚æˆ‘åœ¨è¿™é‡Œå†ç»™å¤§å®¶ä¸¾1ä¸ªç®€å•ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç»Ÿè®¡/var/log/messagesæ–‡ä»¶ä¸­çš„ Out of memory å…³é”®å­—ï¼Œmtailè§„åˆ™åº”è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿå…¶å®æ¯”ä¸Šé¢ä¸¾ä¾‹çš„mtail_alert_rule_notify_totalè¿˜è¦æ›´ç®€å•ï¼š\ncounter mtail_oom_total /Out of memory/ { mtail_oom_total++ } å…³äºæ—¶é—´æˆ³ æœ€åè¯´ä¸€ä¸‹æ—¶é—´æˆ³çš„é—®é¢˜ï¼Œæ—¥å¿—ä¸­æ¯ä¸€è¡Œä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸ªæ—¶é—´æˆ³çš„ï¼Œå¤œèºv4ç‰ˆæœ¬åœ¨é¡µé¢ä¸Šé…ç½®é‡‡é›†è§„åˆ™çš„æ—¶å€™ï¼Œå°±æ˜¯è¦é€‰æ‹©æ—¶é—´æˆ³çš„ï¼Œä½†æ˜¯mtailï¼Œä¸Šé¢çš„ä¾‹å­ä¸­æ²¡æœ‰å¤„ç†æ—¶é—´æˆ³ï¼Œä¸ºå•¥ï¼Ÿå…¶å®mtailä¹Ÿå¯ä»¥æ”¯æŒä»æ—¥å¿—ä¸­æå–æ—¶é—´æˆ³ï¼Œå¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œå°±ç”¨ç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œä¸ªäººè®¤ä¸ºï¼Œç”¨ç³»ç»Ÿå½“å‰æ—¶é—´å°±å¯ä»¥äº†ï¼Œä»æ—¥å¿—ä¸­æå–æ—¶é—´ç¨å¾®è¿˜æœ‰ç‚¹éº»çƒ¦ï¼Œå½“ç„¶ï¼Œç³»ç»Ÿå½“å‰æ—¶é—´å’Œæ—¥å¿—ä¸­çš„æ—¶é—´å¯èƒ½ç¨å¾®æœ‰å·®åˆ«ï¼Œä½†æ˜¯ä¸ä¼šå·®å¾ˆå¤šçš„ï¼Œå¯ä»¥æ¥å—ï¼Œexamplesä¸­çš„mtailæ ·ä¾‹ï¼Œä¹ŸåŸºæœ¬éƒ½æ²¡æœ‰ç»™å‡ºæ—¶é—´æˆ³çš„æå–ï¼Œä¼°è®¡è¿™å°±æ˜¯æœ€ä½³å®è·µã€‚\n",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§æ—¥å¿—",
    "uri": "/usage/mtail/"
  },
  {
    "content": " ç›‘æ§æ–¹å¼ï¼šhttps://github.com/prometheus/mysqld_exporter å‘Šè­¦è§„åˆ™ï¼šhttps://github.com/didi/nightingale/blob/main/etc/alerts/mysql_by_exporter.json ç›‘æ§å¤§ç›˜ï¼šhttps://github.com/didi/nightingale/blob/main/etc/dashboards/mysql_by_exporter.json  ",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§MySQL",
    "uri": "/usage/mysql/"
  },
  {
    "content": " ç›‘æ§æ–¹å¼ï¼šhttps://github.com/oliver006/redis_exporter å‘Šè­¦è§„åˆ™ï¼šhttps://github.com/didi/nightingale/blob/main/etc/alerts/redis_by_exporter.json ç›‘æ§å¤§ç›˜ï¼šhttps://github.com/didi/nightingale/blob/main/etc/dashboards/redis_by_exporter.json  ",
    "description": "",
    "tags": null,
    "title": "ç›‘æ§Redis",
    "uri": "/usage/redis/"
  },
  {
    "content": "",
    "description": "",
    "tags": null,
    "title": "API",
    "uri": "/api/"
  },
  {
    "content": "  å¤šé›†ç¾¤éƒ¨ç½²çš„æ—¶å€™MySQLã€Redisåˆ†åˆ«éƒ¨ç½²å‡ ä¸ªï¼Ÿ   å…¬ä¼—å·æœ‰ä¸ªè§†é¢‘è®²è§£äº† å¦‚ä½•æ¥å…¥å¤šä¸ªæ—¶åºå­˜å‚¨ï¼Œ è¯·å…ˆæŸ¥çœ‹ã€‚MySQLæ˜¯åªéœ€è¦ä¸€ä¸ªï¼Œä¸ç®¡éƒ¨ç½²å¤šå°‘ä¸ªn9e-webapiå¤šå°‘ä¸ªn9e-serverã€‚redisä¹Ÿå¯ä»¥åªç”¨ä¸€ä¸ªï¼Œæ‰€æœ‰çš„n9e-webapiå’Œn9e-serverå…±äº«ï¼Œä½†æ˜¯ï¼Œå¦‚æœéƒ¨ç½²å¤šå¥—n9e-serverï¼ˆä¸€å¥—n9e-serverå¯èƒ½æ˜¯å¤šä¸ªn9e-serverå®ä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼‰åˆ†å¸ƒåœ¨ä¸åŒçš„åœ°åŸŸï¼Œç½‘ç»œé“¾è·¯å¯èƒ½ä¸å¤ªå¥½ï¼Œæ­¤æ—¶æ˜¯å»ºè®®ä¸€å¥—n9e-serverå¯¹åº”ä¸€ä¸ªredisï¼Œn9e-webapiè‡ªå·±ç”¨ä¸€ä¸ªredis\n æ¶æ„ä¸­å¯ä»¥å®Œå…¨ä¸ç”¨Prometheuså—ï¼Ÿ   åŸç†ä¸Šæ˜¯å¯ä»¥çš„ï¼ŒPrometheusåœ¨å¤œèºçš„æ¶æ„ä¸­ï¼Œæ˜¯ä½œä¸ºæ—¶åºåº“ä½¿ç”¨ï¼Œé™¤äº†Prometheusï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨VictoriaMetricsã€M3DBç­‰ï¼Œå› ä¸ºè¿™äº›æ—¶åºåº“éƒ½å®ç°äº†Prometheusçš„Querieræ¥å£ï¼Œè€Œå¤œèºä¾èµ–è¿™äº›æ¥å£æ‹‰å–ç›‘æ§æ•°æ®å’Œåšå‘Šè­¦åˆ¤æ–­ã€‚\n æœºå™¨åªèƒ½å½’å±ä¸€ä¸ªä¸šåŠ¡ç»„å—ï¼Ÿ   æ˜¯çš„ã€‚\nç”¨æˆ·å¯èƒ½ä¼šç»§ç»­è¿½é—®ï¼šä¸€å°æœºå™¨å¯èƒ½æœ‰æ··éƒ¨çš„æƒ…å†µï¼ŒåŒæ—¶éƒ¨ç½²å¤šä¸ªæœåŠ¡ï¼Œé‚£å¦‚ä½•æ¥æè¿°è¿™ç§ç°å®ï¼ˆæ¯•ç«Ÿï¼Œè½¯ä»¶å°±æ˜¯å¯¹ç°å®çš„å»ºæ¨¡ï¼‰å‘¢ï¼Ÿå…¶å®ï¼Œè¿™ç§å…³è”ä¿¡æ¯åœ¨ç›‘æ§ä¸­æ˜¯ä½¿ç”¨æ ‡ç­¾æ¥åæ˜ çš„ã€‚æ¯”å¦‚æŸä¸ªç›‘æ§æ•°æ®å¸¦æœ‰è¿™å‡ ä¸ªæ ‡ç­¾ï¼šhost=cs-node001.hna service=n9e-server method=get api=/ping statuscode=200 è¡¨ç¤ºï¼šè¿™ä¸ªç›‘æ§æ•°æ®æ˜¯n9e-serverè¿™ä¸ªæœåŠ¡çš„ï¼Œæ¥è‡ªcs-node001.hnaè¿™ä¸ªæœºå™¨ï¼Œè¿™æ¡ç›‘æ§æ•°æ®æè¿°çš„æ˜¯/pingæ¥å£ï¼Œ/pingæ¥å£æ˜¯ä¸ªgetæ¥å£ï¼Œstatuscodeæ˜¯200ï¼Œè¿™ä¸ªä¿¡æ¯éå¸¸ä¸°å¯Œï¼Œé‡Œè¾¹æ—¢æœ‰æœåŠ¡åç§°ï¼Œåˆæœ‰æœºå™¨ä¿¡æ¯ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å°±çŸ¥é“æœåŠ¡å’Œæœºå™¨çš„å…³è”å…³ç³»ã€‚\nå¤§å®¶ä¸è¦æŠŠCMDBä¸­çš„æœºå™¨åˆ†ç»„éœ€æ±‚æ”¾åˆ°å¤œèºä¸­æ¥ç»´æŠ¤ï¼Œè¿™æ˜¯èŒè´£ä¸Šçš„é”™é…ã€‚\né‚£ä¸ºä½•è¿˜è¦æä¾›ä¸šåŠ¡ç»„è¿™ä¸ªæ¦‚å¿µï¼Ÿå²‚ä¸æ˜¯å¤šä½™äº†ï¼Ÿä¸šåŠ¡ç»„æ›´å¤šçš„æ˜¯æƒ³å¤„ç†æƒé™çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å‘Šè­¦è§„åˆ™ã€å±è”½è§„åˆ™ã€è®¢é˜…è§„åˆ™ã€ç›‘æ§å¤§ç›˜ã€è‡ªæ„ˆè„šæœ¬ç­‰ï¼Œåªèƒ½ç”±æˆ‘ä»¬è‡ªå·±ç®¡ç†ï¼Œä¸èƒ½è¢«æ— å…³äººå‘˜ä¿®æ”¹äº†æˆ–åˆ é™¤äº†ã€‚æŠŠè¿™äº›è§„åˆ™ç±»ä¿¡æ¯æ”¾åˆ°æŸä¸ªä¸šåŠ¡ç»„ä¸­ï¼Œåªæœ‰è¿™ä¸ªä¸šåŠ¡ç»„çš„ç®¡ç†å‘˜æœ‰æƒé™ç®¡ç†ï¼Œå…¶ä»–äººå°±æ²¡æœ‰æƒé™ä¹±æäº†ã€‚\né‚£æœºå™¨ä¸ºä½•è¦å½’å±ä¸šåŠ¡ç»„ï¼Ÿå…¶å®ä¹Ÿæ˜¯ä»æƒé™ä¸Šè€ƒè™‘çš„ï¼Œè‡ªæ„ˆè„šæœ¬æ˜¯å½’å±ä¸šåŠ¡ç»„çš„ï¼Œè„šæœ¬çš„æ‰§è¡Œéœ€è¦æœ‰æƒé™æ§åˆ¶ï¼Œä¸èƒ½éšä¾¿å»æœºå™¨ä¸Šè¿è¡Œï¼Œç°åœ¨çš„æ§åˆ¶é€»è¾‘æ˜¯è„šæœ¬åªèƒ½åœ¨è‡ªå·±çš„ä¸šåŠ¡ç»„ä¸‹è¾–çš„æœºå™¨ä¸Šè¿è¡Œã€‚\nç»¼ä¸Šï¼Œå¦ç™½è®²ï¼Œæˆ‘æ²¡æœ‰æƒ³åˆ°ä»€ä¹ˆåœºæ™¯æ˜¯å¿…é¡»è®©æœºå™¨ï¼ˆå³ç³»ç»Ÿä¸­çš„ç›‘æ§å¯¹è±¡ï¼‰å½’å±åˆ°å¤šä¸ªä¸šåŠ¡ç»„çš„ã€‚å…³é”®åŸå› æ˜¯ç›‘æ§æ•°æ®ä¸ŠæŠ¥çš„æ—¶å€™å°±æ˜¯è‡ªæè¿°çš„ï¼Œå·²ç»åŒ…å«äº†å„ç±»ä¿¡æ¯äº†ï¼Œä¸éœ€è¦é€šè¿‡å¤–æŒ‚çš„æ–¹å¼é‡æ–°å½’ç±»ç›‘æ§æ•°æ®ï¼Œè€Œæœºå™¨çš„åˆ†ç»„ï¼Œè™½ç„¶æœ‰éœ€æ±‚ï¼Œä½†é‚£æ˜¯CMDBçš„éœ€æ±‚ï¼Œä¹Ÿä¸æ˜¯ç›‘æ§è¦å¤„ç†çš„ã€‚\næ›´æ–°ï¼šå¦å¤–ï¼Œæœºå™¨ï¼ˆå³ç³»ç»Ÿä¸­çš„ç›‘æ§å¯¹è±¡ï¼‰å¯ä»¥æ‰“æ ‡ç­¾ï¼Œå¯ä»¥é€šè¿‡æ ‡ç­¾ä½“ç°ä¸€å®šçš„åˆ†ç±»ä¿¡æ¯ï¼Œæ¯”å¦‚region=bj env=prodè¡¨ç¤ºbjåŒºçš„ç”Ÿäº§ç¯å¢ƒçš„æœºå™¨ã€‚æ ‡ç­¾æ˜¯K=Vçš„æ ¼å¼ï¼ŒKå¯ä»¥ä½“ç°ç»´åº¦ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†å½’ç±»éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡æ ‡ç­¾æ¥è§£å†³ï¼Œå”¯ç‹¬æ¯”è¾ƒéº»çƒ¦çš„æ˜¯ï¼Œåœ¨åŒä¸€ä¸ªç»´åº¦æœ‰å¤šä¸ªå€¼çš„æƒ…å†µï¼Œæ¯”å¦‚K=V1 K=V2è¿™ç§æƒ…å†µï¼Œè¿™ç§æƒ…å†µç›®å‰ä¸æ”¯æŒï¼Œå› ä¸ºæ ‡ç­¾ä¿¡æ¯ä¼šè¢«é™„åˆ°ç›‘æ§å¯¹è±¡çš„æ—¶åºæ•°æ®ä¸Šï¼Œæ—¶åºæ•°æ®çš„æ ‡ç­¾æ˜¯mapç»“æ„ï¼Œæ‰€ä»¥K=V1 K=V2è¿™ç§Kç›¸åŒçš„æƒ…å†µä¼šäº§ç”Ÿè¦†ç›–ï¼Œæ•…è€Œé¡µé¢ä¸Šç›‘æ§å¯¹è±¡æ‰“æ ‡ç­¾çš„æ—¶å€™å‹æ ¹å°±ä¸å…è®¸è¿™ç§æ ‡ç­¾ã€‚\n ä¸ºä½•æˆ‘çš„target_upæŒ‡æ ‡ä¸€ä¼šæ˜¯0ä¸€ä¼šæ˜¯1ï¼Œå¯¼è‡´ä¸€ä¼šæœ‰å‘Šè­¦ä¸€ä¼šåˆæ¢å¤äº†   è¿™ä¸ªå¾ˆå¯èƒ½æ˜¯å› ä¸ºè°ƒæ•´äº†å®¢æˆ·ç«¯é‡‡é›†ä¸ŠæŠ¥é¢‘ç‡å¯¼è‡´çš„ï¼Œé»˜è®¤Telegrafä¸ŠæŠ¥é¢‘ç‡æ˜¯10sï¼Œä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œn9e-serveræ¯15sç”Ÿæˆä¸€æ¬¡target_upçš„å€¼ï¼Œæ ‡è¯†æœºå™¨æ˜¯å¦åœ¨æ­£å¸¸ä¸ŠæŠ¥æ•°æ®ï¼Œå¦‚æœå‘ç°æœºå™¨æœ‰æŒ‡æ ‡åœ¨ä¸ŠæŠ¥ï¼Œtarget_upå°±ç½®ä¸º1ï¼Œå¦åˆ™å°±æ˜¯0ï¼Œå¦‚æœæŠŠå®¢æˆ·ç«¯é‡‡é›†ä¸ŠæŠ¥é¢‘ç‡è°ƒå¤§ï¼Œæ¯”å¦‚æ”¹æˆ60sï¼Œé‚£n9e-serveråœ¨æŸäº›å‘¨æœŸæ£€æŸ¥çš„æ—¶å€™ï¼Œç¡®å®å°±å‘ç°å®¢æˆ·ç«¯æ²¡æœ‰ä¸ŠæŠ¥æ•°æ®ï¼Œæ¯•ç«Ÿä¸ŠæŠ¥é¢‘ç‡å¤ªå¤§äº†ã€‚æ­¤æ—¶å¯ä»¥è°ƒæ•´server.confçš„é…ç½®ï¼ŒæŠŠæ£€æµ‹å®¢æˆ·ç«¯æ˜¯å¦å­˜æ´»çš„å‘¨æœŸä¹Ÿæ”¾å¤§ä¸€äº›ï¼Œæ¯”å¦‚è°ƒæ•´ä¸º60ç§’ï¼š\n[NoData] Metric = \"target_up\" # unit: second Interval = 60 å‘Šè­¦è§„åˆ™ä¹Ÿå¯ä»¥é’ˆå¯¹è¿™ç§æƒ…å†µåšä¸€äº›è°ƒæ•´ï¼Œæ¯”å¦‚æ”¹æˆï¼š\n# å‘Šè­¦è§„åˆ™çš„æŒç»­æ—¶é•¿è®¾ç½®ä¸º0ï¼Œè¯¥PromQLè¡¨ç¤º130så†…ä¸€ç›´éƒ½æ²¡æœ‰ç›‘æ§æ•°æ®ä¸ŠæŠ¥ï¼Œæ•…è€Œè¦æŠ¥è­¦ã€‚ max_over_time(target_up[130s]) == 0 target_upæŒ‡æ ‡æ˜¯0ï¼Œè¿˜æœ‰å¯èƒ½çš„åŸå› æ˜¯å®¢æˆ·ç«¯å¤¯ä½äº†ï¼Œå¯ä»¥é‡å¯ä¸€ä¸‹å®¢æˆ·ç«¯è¯•è¯•ï¼Œæˆ–è€…æ˜¯å®¢æˆ·ç«¯æ‰€åœ¨æœºå™¨å½“å‰å‹åŠ›è¿‡å¤§ï¼Œå½±å“äº†å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ç½‘ç»œé€šä¿¡ã€‚\n å¤œèºç”¨çš„redisæ”¯æŒclusterç‰ˆæœ¬æˆ–è€…sentinelç‰ˆæœ¬å—ï¼Ÿ   ä¸æ”¯æŒï¼Œå°±æ˜¯ç”¨çš„å•æœºç‰ˆï¼Œæ”¹é€ æˆclusterç‰ˆæœ¬æˆ–è€…sentinelåº”è¯¥ä¹Ÿæ²¡å•¥å¤ªå¤§é—®é¢˜ï¼Œä¸€èˆ¬å…¬æœ‰äº‘ä¼šæä¾›é«˜å¯ç”¨çš„redisï¼Œä¸€ä¸»ä¸€ä»é‚£ç§ï¼Œè¶³å¤Ÿç”¨äº†ï¼Œè‡ªå·±æ­å»ºä¹Ÿå¯ä»¥ï¼Œæœºå™¨æŒ‚æ‰çš„æ¦‚ç‡å…¶å®å¾ˆå°ï¼Œæ»¡è¶³slaé—®é¢˜ä¸å¤§çš„\n Telegrafä¸ŠæŠ¥çš„ä¸»æœºæ ‡è¯†é»˜è®¤ç”¨çš„æœºå™¨åï¼Œå¯ä»¥è®©å®ƒè‡ªåŠ¨ä¸ŠæŠ¥IPä½œä¸ºæœ¬æœºæ ‡è¯†å—ï¼Ÿ   å¯ä»¥è®©å®ƒä¸ŠæŠ¥IPä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œä½†æ˜¯è¦æƒ³è‡ªåŠ¨è·å–IPï¼Œåšä¸åˆ°ã€‚ä¸ªäººå»ºè®®æ˜¯ä½¿ç”¨ä¸€äº›æ‰¹é‡æ‰§è¡Œå·¥å…·ï¼Œæ¯”å¦‚ansibleä¹‹ç±»çš„ï¼Œæ‰¹é‡éƒ¨ç½²Telegrafï¼Œéƒ¨ç½²è„šæœ¬é‡Œè‡ªåŠ¨è·å–ç›®æ ‡æœºå™¨çš„IPï¼Œç„¶åå¡«å……åˆ°telegraf.confä¸­ã€‚\n è§¦å‘å‘Šè­¦å’Œè§¦å‘æ¢å¤çš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ   å‘Šè­¦è§„åˆ™é‡Œæœ‰3ä¸ªé…ç½®éå¸¸å…³é”®ï¼Œpromqlã€æ‰§è¡Œé¢‘ç‡ã€æŒç»­æ—¶é•¿ï¼Œæ„æ€å°±æ˜¯æŒ‰ç…§æ‰§è¡Œé¢‘ç‡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡ŒpromqlæŸ¥è¯¢ï¼ˆå³æ—¶æŸ¥è¯¢ï¼Œå³è°ƒç”¨Prometheusåè®®çš„/api/v1/queryæ¥å£ï¼‰ï¼Œå¦‚æœæŸ¥åˆ°æ•°æ®å°±è®¤ä¸ºè§¦å‘äº†é˜ˆå€¼ï¼Œè§¦å‘äº†é˜ˆå€¼æ˜¯å¦ä¼šäº§ç”Ÿå‘Šè­¦äº‹ä»¶ï¼Œä¸ä¸€å®šï¼Œè¿˜è¦çœ‹æŒç»­æ—¶é•¿ï¼Œå¦‚æœæŒç»­æ—¶é•¿ä¸º0ï¼Œå°±ç›¸å½“äºä¸ç”¨ç­‰å¾…ï¼Œè§¦å‘äº†é˜ˆå€¼å°±ç«‹é©¬ç”Ÿæˆäº‹ä»¶ï¼Œå¦‚æœæŒç»­æ—¶é•¿å¤§äº0ï¼Œé‚£å°±è¦ç­‰å¾…ï¼Œè¦ä¿è¯æŒç»­æ—¶é•¿è¿™æ®µæ—¶é—´å†…ï¼Œæ¯æ¬¡æ‰§è¡Œpromqlçš„æŸ¥è¯¢éƒ½è§¦å‘é˜ˆå€¼ï¼Œæ‰è®¤ä¸ºåº”è¯¥ç”Ÿæˆäº‹ä»¶ã€‚æŒç»­æ—¶é•¿å°±ç›¸å½“äºprometheus.ymlä¸­çš„alert ruleä¸­çš„forã€‚\næ¯”å¦‚promqlä¸º cpu_usage_idle{cpu=\"cpu-total\"} \u003c 20ï¼Œæ‰§è¡Œé¢‘ç‡æ˜¯10sï¼ŒæŒç»­æ—¶é•¿æ˜¯60sï¼Œå°±è¡¨ç¤ºåœ¨60så†…æ¯10sæ‰§è¡Œä¸€æ¬¡promqlæŸ¥è¯¢ï¼Œçœ‹promqlæŸ¥è¯¢æ˜¯å¦è¿”å›å†…å®¹ï¼Œå¦‚æœ6æ¬¡éƒ½è¿”å›äº†ï¼Œè¯´æ˜åº”è¯¥ç”Ÿæˆå‘Šè­¦äº‹ä»¶ã€‚\næ¢å¤çš„é€»è¾‘ï¼šæ¯”å¦‚å·²ç»äº§ç”Ÿäº†å‘Šè­¦äº‹ä»¶ï¼Œç„¶åå†æ¬¡æ‹¿ç€promqlå»æŸ¥è¯¢ï¼Œå‘ç°æ²¡æœ‰è¿”å›å†…å®¹ï¼Œé‚£å°±è¯´æ˜å½“å‰çš„ç›‘æ§æ•°æ®å·²ç»ä¸ç¬¦åˆpromqlä¸­æŒ‡å®šçš„é˜ˆå€¼æ¡ä»¶äº†ï¼Œå°±è¡¨ç¤ºæ¢å¤äº†ã€‚å½“ç„¶ï¼Œ å¦‚æœæ•°æ®ä¸¢ç‚¹äº†ï¼Œpromqlè‡ªç„¶ä¹ŸæŸ¥ä¸åˆ°ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯ä¼šæŠ¥æ¢å¤ï¼Œå› ä¸ºå¤œèºç¡®å®æ— æ³•åŒºåˆ†åˆ°åº•æ˜¯å› ä¸ºä¸¢ç‚¹äº†ï¼Œè¿˜æ˜¯å› ä¸ºæ²¡æœ‰æ»¡è¶³é˜ˆå€¼è€Œå¯¼è‡´æ²¡æœ‰è¿”å›å†…å®¹ã€‚é‚£ä½ å¯èƒ½ä¼šé—®ï¼ŒæŠŠpromqlè§£æä¸€ä¸‹ï¼Œå»æ‰promqlä¸­çš„æ“ä½œç¬¦å’Œé˜ˆå€¼ï¼Œåªæ‹¿ç€å‰é¢éƒ¨åˆ†å»æŸ¥è¯¢ï¼Œä¸å°±èƒ½åŒºåˆ†åˆ°åº•æ˜¯æ²¡æ•°æ®è¿˜æ˜¯å› ä¸ºæ²¡æœ‰æ»¡è¶³é˜ˆå€¼äº†å—ï¼Ÿå…¶å®å¾ˆéš¾ï¼Œä¸Šé¢ä¸¾ä¾‹çš„promqlæ˜¯ä¸€ç§ç®€å•æƒ…å†µï¼Œå¤æ‚çš„promqléå¸¸å¤æ‚ï¼Œæ²¡æ³•è¿™ä¹ˆè½»æ˜“çš„æ‹¿æ‰æ“ä½œç¬¦å’Œé˜ˆå€¼ã€‚\n å¦‚ä½•ç›‘æ§æœºå™¨çš„CPUã€å†…å­˜ã€ç£ç›˜ã€IOã€ç½‘ç»œã€è¿›ç¨‹ï¼Ÿ   è¿™ä¸ªé—®é¢˜ï¼Œæ–‡æ¡£é‡Œæœ‰ç­”æ¡ˆï¼ŒTelegrafç« èŠ‚ï¼Œæœ‰ä¸ªè°ƒç ”ç¬”è®°çš„é“¾æ¥ï¼Œè°ƒç ”ç¬”è®°ä¸­æè¿°çš„å¾ˆæ¸…æ¥šäº†ï¼Œé™¤äº†æœºå™¨å±‚é¢çš„è¿™äº›ç›‘æ§é¡¹ï¼Œè¿˜æœ‰è®²å¦‚ä½•åšPINGç›‘æ§ï¼ŒTCPæ¢æµ‹ç­‰\n å¤œèºå¯ä»¥æ¥å…¥åˆ°Grafanaæ¥å±•ç¤ºå—ï¼Ÿ   å¯ä»¥ã€‚ä½†ä¸æ˜¯æŠŠå¤œèºä½œä¸ºDataSourceï¼Œå› ä¸ºå®åœ¨æ˜¯æ²¡å¿…è¦ã€‚å¤œèºåç«¯å¯ä»¥æ¥å…¥å¤šä¸ªæ—¶åºåº“ï¼šPrometheusã€M3DBã€VictoriaMetricsç­‰ï¼Œè¿™äº›æ—¶åºåº“éƒ½å¯ä»¥ç›´æ¥ä½œä¸ºGrafanaçš„DataSourceï¼Œæ‰€ä»¥ï¼Œåªè¦ç›‘æ§æ•°æ®è¿›äº†è¿™äº›æ—¶åºåº“äº†ï¼ŒGrafanaå°±å¯ä»¥ç›´æ¥å±•ç¤ºäº†\n å¤œèºå¯ä»¥é…ç½®InfluxDBçš„QLåšå‘Šè­¦è§„åˆ™å—ï¼Ÿ   ä¸æ”¯æŒï¼Œå½“å‰åªæ”¯æŒé…ç½®promqlï¼Œå¤œèºæ¥å…¥æ—¶åºåº“ï¼Œæœ‰ä¸¤ä¸ªå±‚é¢çš„æ¥å…¥ï¼Œä¸€æ˜¯é€šè¿‡remote writeï¼ŒæŠŠå¤œèºæ”¶åˆ°çš„æ•°æ®è½¬å‘ç»™æ—¶åºåº“ï¼Œæ‰€æœ‰æ”¯æŒremote write æ¥å£çš„å­˜å‚¨éƒ½å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å…¥å¤œèºï¼Œæ¥æ”¶å¤œèºè½¬å‘è¿‡æ¥çš„æ•°æ®ï¼›äºŒæ˜¯æ—¶åºåº“å¦‚æœå¼€æ”¾å…¼å®¹Prometheusçš„Querieræ¥å£ï¼Œé‚£å¤œèºè¿˜å¯ä»¥è¯»å–æ—¶åºåº“çš„æ•°æ®åšå‘Šè­¦åˆ¤æ–­ï¼Œå³Prometheusã€M3DBã€VictoriaMetricsã€Thanosç­‰è¿™äº›å­˜å‚¨ï¼Œéƒ½å®Œå…¨å…¼å®¹Prometheusçš„Querieræ¥å£ï¼Œåˆ™å¤œèºå¯ä»¥é…ç½®å‘Šè­¦è§„åˆ™ï¼Œä»è¿™äº›å­˜å‚¨ä¸­è¯»å–ç›‘æ§æ•°æ®åšå‘Šè­¦åˆ¤æ–­ã€‚è€ŒOpenTSDBã€InfluxDBç­‰ï¼Œå› ä¸ºä¸æ”¯æŒPrometheusçš„Querieræ¥å£ï¼Œæ‰€ä»¥å¤œèºçš„å‘Šè­¦è§„åˆ™ï¼Œæ²¡æ³•è¯»å–è¿™äº›å­˜å‚¨çš„æ•°æ®åšåˆ¤æ–­ï¼Œè¿™äº›å­˜å‚¨åªèƒ½ä½œä¸ºremote writeçš„å†™å…¥ç«¯ã€‚\n ä»å“ªé‡Œè·å–å¾®ä¿¡æœºå™¨äººtokenï¼Ÿ   é¦–å…ˆï¼Œæ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œä¸æ˜¯å¾®ä¿¡ï¼Œåœ¨ä¼ä¸šå¾®ä¿¡é‡Œå»ºä¸ªç¾¤ï¼Œç‚¹å¼€ç¾¤ç®¡ç†ï¼Œæ·»åŠ æœºå™¨äººï¼Œå®Œäº‹æŸ¥çœ‹è¿™ä¸ªæœºå™¨äººçš„ä¿¡æ¯ï¼Œå³å¯çœ‹åˆ°webhookåœ°å€ï¼Œwebhookåœ°å€ä¸­åŒ…å«ä¸€ä¸ªkeyçš„å‚æ•°ï¼Œkey=åé¢å°±æ˜¯tokenã€‚æ‹¿ç€è¿™ä¸ªtokenï¼Œå»å¤œèºé‡Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œæ¯”å¦‚å°±å«xxä¼å¾®æœºå™¨äººï¼Œç»™è¿™ä¸ªç”¨æˆ·è®¾ç½®ä¸€ä¸‹Wecom Robot Tokenï¼Œé…ç½®ä¸ºåˆšæ‰ä»webhookä¸­è·å–çš„tokenï¼Œåé¢æŠŠè¿™ä¸ªäººåŠ å…¥å‘Šè­¦æ¥æ”¶ç»„ï¼Œç›¸å…³çš„å‘Šè­¦å°±ä¼šå‘ç»™ä¼ä¸šå¾®ä¿¡çš„è¿™ä¸ªç¾¤ç»„ã€‚\n ç›‘æ§å¯¹è±¡åˆ—è¡¨ä¸­å¦‚ä½•æ·»åŠ ç›‘æ§å¯¹è±¡ï¼Ÿçœ‹åˆ°ç›‘æ§å¯¹è±¡åˆ—è¡¨å’Œå¯¹è±¡è§†è§’éƒ½æ˜¯ç©ºçš„   å…¬ä¼—å·çš„è§†é¢‘æ•™ç¨‹è¦æ•´ä½“çœ‹ä¸€éï¼Œå°±ç†è§£æ•´ä¸ªè®¾è®¡äº†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œç›‘æ§æ•°æ®éœ€è¦ä¸ŠæŠ¥ç»™n9e-serverï¼Œç„¶åç”±n9e-serverè½¬å‘ç»™æ—¶åºåº“ï¼Œå³ç›‘æ§æ•°æ®è¦æµç»n9e-serverï¼Œn9e-serveræ‰æœ‰å¯èƒ½ä»ç›‘æ§æ•°æ®ä¸­æå–identæ ‡ç­¾çš„å€¼ï¼Œn9e-serverä¼šæŠŠidentæ ‡ç­¾çš„å€¼ä½œä¸ºç›‘æ§å¯¹è±¡æ³¨å†Œåˆ°æ•°æ®åº“ä¸­ï¼Œæ‰èƒ½åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°ã€‚å¦‚æœç›‘æ§æ•°æ®çš„æ•´ä¸ªä¼ è¾“è¿‡ç¨‹æ²¡æœ‰æµç»n9e-serverï¼Œæˆ–ç›‘æ§æ•°æ®ä¸­æ²¡æœ‰identæ ‡ç­¾ï¼Œä¹Ÿå°±æ²¡æ³•æå–åˆ°äº†ã€‚\nå¤œèºå¯ä»¥æ”¯æŒTelegrafä½œä¸ºå®¢æˆ·ç«¯é‡‡é›†å™¨ï¼Œä¹Ÿå¯ä»¥æ”¯æŒgrafana-agentä½œä¸ºé‡‡é›†å™¨ï¼Œè¿™ä¿©é‡‡é›†å™¨å®é™…éƒ½æ²¡æ³•ä¸ŠæŠ¥identæ ‡ç­¾ï¼Œä½†æ˜¯Telegrafä¼šä¸ŠæŠ¥hostæ ‡ç­¾ï¼Œgrafana-agentä¼šä¸ŠæŠ¥agent_hostnameæ ‡ç­¾ï¼Œè¿™ä¿©æ ‡ç­¾ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºidentå­—æ®µã€‚\nå½“ç„¶ï¼Œå³ä½¿æ²¡æœ‰æ³¨å†Œåˆ°å¯¹è±¡è§†è§’ä¸­ï¼Œå…¶å®ä¹Ÿä¸è€½è¯¯ï¼Œæ²¡å•¥å¤§ä¸äº†çš„ï¼Œåªæ˜¯æœªæ¥çœ‹ç›‘æ§å›¾è¡¨çš„æ—¶å€™ï¼Œæ²¡æ³•ä½¿ç”¨å¯¹è±¡è§†è§’çœ‹å›¾ç½¢äº†ã€‚åé¢å¤œèºä¹Ÿä¼šæŒç»­ä¼˜åŒ–ï¼Œå¢åŠ è‡ªå®šä¹‰è§†å›¾ï¼Œåˆ°æ—¶å€™å¯¹è±¡è§†è§’çš„çœ‹å›¾å¯èƒ½å°±å¯æœ‰å¯æ— äº†ã€‚\n v5ç‰ˆæœ¬å¦‚ä½•é€šè¿‡apiæ¥å£ä¸ŠæŠ¥æ•°æ®çš„æ—¶å€™é¡ºä¾¿å¸¦ä¸Šaliaså­—æ®µï¼Ÿ   v5ç›®å‰æ”¯æŒçš„ä¸ŠæŠ¥æ¥å£æ˜¯opentsdbçš„åè®®ã€remote writeåè®®ã€datadogçš„åè®®ï¼Œéƒ½ä¸æ”¯æŒaliaså­—æ®µï¼Œè€Œæ•°æ®åº“ä¸­ä¹Ÿå¹²æ‰äº†è¿™ä¸ªå­—æ®µï¼Œæ‰€ä»¥ï¼Œv5æ²¡æ³•é€šè¿‡apiä¸ŠæŠ¥è¿™ä¸ªå­—æ®µäº†ï¼Œä¸è¿‡v5æœ‰å¤‡æ³¨å­—æ®µï¼Œå’Œè‡ªå®šä¹‰æ ‡ç­¾å­—æ®µï¼Œå¯ä»¥è€ƒè™‘ç”¨è¿™ä¿©å­—æ®µæ”¾ç½®åˆ«åï¼Œè¿™éœ€è¦ç›´æ¥æ“ä½œDBï¼Œæˆ–è€…é€šè¿‡APIä¿®æ”¹ç›‘æ§å¯¹è±¡ï¼Œæ€»ä¹‹ï¼Œæ— æ³•é€šè¿‡ä¸ŠæŠ¥æ•°æ®çš„æ¥å£æ¥æå®š\n v5é‚®ä»¶å‘Šè­¦çš„æœåŠ¡å™¨é…ç½®ï¼ˆsmtpï¼‰åœ¨å“ªé‡Œï¼Ÿ   v5.4ï¼ˆå«ï¼‰ä¹‹åçš„ç‰ˆæœ¬ï¼Œåœ¨server.confä¸­ï¼Œv5.4ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåœ¨etc/script/notify.pyä¸­ï¼Œè„šæœ¬çš„å‰é¢å‡ è¡Œï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°\n æˆ‘åœ¨Aä¸šåŠ¡ç»„é…ç½®çš„å‘Šè­¦è§„åˆ™ï¼Œä¸ºä½•æ”¶åˆ°äº†Bä¸šåŠ¡ç»„çš„æœºå™¨çš„å‘Šè­¦ï¼Ÿ   å‘Šè­¦è§„åˆ™çš„é€»è¾‘å¯ä»¥æŸ¥çœ‹009å·é—®é¢˜ï¼Œæ¯æ¬¡å°±æ˜¯ç”¨promqlæŸ¥è¯¢æ—¶åºåº“ï¼Œè€Œæ—¶åºåº“é‡Œæ˜¯æ²¡æœ‰ä¸šåŠ¡ç»„çš„ä¿¡æ¯çš„ï¼Œæ‰€ä»¥promqlå°±ç”Ÿæ•ˆåˆ°äº†å…¨é‡çš„ç›‘æ§å¯¹è±¡ä¸Šäº†ã€‚æ¨èåšæ³•ï¼šaä¸šåŠ¡ç»„çš„æœºå™¨ï¼Œç»Ÿä¸€æ‰“ä¸Šbg=açš„æ ‡ç­¾ï¼Œbä¸šåŠ¡ç»„çš„æœºå™¨ç»Ÿä¸€æ‰“ä¸Šbg=bçš„æ ‡ç­¾ï¼Œé…ç½®å‘Šè­¦è§„åˆ™çš„æ—¶å€™ï¼Œè¦å¸¦ä¸Šè¿™ä¸ªæ ‡ç­¾åšç­›é€‰ï¼Œæ¯”å¦‚ cpu_usage_idle{bg=\"a\"}\u003c15 å°±è¡¨ç¤ºåªæœ‰bg=aè¿™ä¸ªæ ‡ç­¾çš„æœºå™¨ç”Ÿæ•ˆï¼Œå³åªæœ‰aä¸šåŠ¡ç»„çš„æœºå™¨ç”Ÿæ•ˆã€‚\nè¿‘æœŸå¤œèºæ–°ç‰ˆæœ¬æ”¯æŒåœ¨å‘Šè­¦è§„åˆ™é…ç½®çš„æ—¶å€™æŒ‡å®šåªåœ¨æœ¬ä¸šåŠ¡ç»„ç”Ÿæ•ˆï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œåç»­ä¹Ÿä¼šæ”¯æŒæŠŠä¸šåŠ¡ç»„ç›´æ¥ä½œä¸ºæ ‡ç­¾é™„åˆ°æ—¶åºæ•°æ®ä¸Šï¼Œåˆ°æ—¶å€™å°±æ›´æ–¹ä¾¿äº†\n Telegrafæ¨é€æ•°æ®ç»™n9e-serverï¼Œå¦‚ä½•åŠ ä¸Šè®¤è¯æœºåˆ¶ä¿è¯å®‰å…¨ï¼Ÿ   Telegrafä½¿ç”¨datadogçš„outputåæ•°æ®ç»™n9e-serverï¼ˆç‰ˆæœ¬è¦åœ¨5.2.1ä»¥ä¸Šï¼‰\n[[outputs.datadog]] timeout = \"5s\" url = \"http://localhost:19000/datadog/api/v1/series\" apikey = \"datadog-api-key\" n9e-serverä¸­åŠ ä¸Šè¿™ä¸ªé…ç½®ï¼š\n[BasicAuth] apiKey = \"datadog-api-key\" æ³¨æ„ï¼šè¿™æ ·é…ç½®ä¹‹åï¼Œè¡¨ç¤ºn9e-serverçš„æ‰€æœ‰è¯·æ±‚éƒ½èµ°basic authè®¤è¯ï¼ŒåŸæ¥Telegrafé€šè¿‡openTSDBçš„æ¥å£åæ•°æ®çš„é“¾è·¯å°±èµ°ä¸é€šäº†\n ä»ä½ç‰ˆæœ¬æ€ä¹ˆå‘é«˜ç‰ˆæœ¬å‡çº§ï¼Ÿ   é¦–å…ˆå»githubçš„ releases é¡µé¢ æ‰¾åˆ°è‡ªå·±çš„ç‰ˆæœ¬ï¼Œç„¶åæŒ¨ä¸ªæŸ¥çœ‹æ¯ä¸ªæ¯”ä½ é«˜çš„ç‰ˆæœ¬ï¼Œçœ‹çœ‹å„ä¸ªç‰ˆæœ¬çš„release logä¸­å†™äº†è¦æ›´æ–°å“ªäº›å†…å®¹ï¼Œé‡ç‚¹å…³æ³¨sqlç›¸å…³çš„ï¼Œæ¯”å¦‚ä½ çš„ç‰ˆæœ¬æ˜¯5.1.0ï¼Œå½“å‰ç‰ˆæœ¬æ˜¯5.3.0ï¼Œé‚£ä½ è¦çœ‹ ( 5.1.0, 5.3.0 ]ä¹‹é—´çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œä»ä½åˆ°é«˜æŒ¨ä¸ªæŸ¥çœ‹ï¼ŒæŠŠæ¯ä¸ªç‰ˆæœ¬çš„release logä¸­çš„sqléƒ½æ‰§è¡Œä¸€éï¼ˆå¦‚æœrelease logä¸­æ²¡æœ‰æsqlè¯­å¥ï¼Œè¯´æ˜è¿™å‡ ä¸ªç‰ˆæœ¬æ²¡æœ‰DBè¡¨ç»“æ„å˜æ›´ï¼Œé‚£æ›´ç®€å•äº†ï¼‰ï¼Œæœ€åæ›¿æ¢n9eäºŒè¿›åˆ¶å’Œetcä¸‹çš„å†…å®¹åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœä½ ä¹‹å‰etcä¸‹æœ‰äº›ç‰¹æ®Šé…ç½®ï¼Œè®°å¾—è¦åŸºäºæœ€æ–°çš„é…ç½®æ–‡ä»¶å†ä¿®æ”¹ä¸‹\n telegrafçš„åŸºæœ¬é…ç½®å’Œä¸­é—´ä»¶é‡‡é›†çš„é…ç½®éƒ½æ”¾åˆ°ä¸€ä¸ªtelegraf.confä¸­ä¸å¥½ç®¡ç†æ€ä¹ˆåŠï¼Ÿ   telegrafå¯åŠ¨çš„æ—¶å€™æ”¯æŒä¸¤ä¸ªå‚æ•°--configå’Œ--config-directoryï¼Œè¿™ä¿©å‚æ•°å¯ä»¥ä¸€å¹¶ä½¿ç”¨ï¼Œé€šè¿‡--configæŒ‡å®šä¸»é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡--config-directoryæŒ‡å®šé…ç½®ç›®å½•ï¼Œå„ç§éé€šç”¨çš„é…ç½®ï¼Œéƒ½å¯ä»¥æ”¾åˆ°é…ç½®ç›®å½•é‡Œï¼Œæ¯ä¸ªé…ç½®æ–‡ä»¶ä»¥.confç»“å°¾ï¼Œè¿™æ ·telegrafå°±å¯ä»¥éƒ½è¯†åˆ«åˆ°äº†ï¼Œæ¯”å¦‚ï¼š\n./usr/bin/telegraf --config etc/telegraf/telegraf.conf --config-directory etc/telegraf.d ç„¶åæˆ‘åšäº†ä¸€ä¸ªmysql.confæ”¾åˆ°telegraf.dç›®å½•ä¸‹ï¼Œä¸“é—¨ç”¨äºç›‘æ§mysqlï¼Œå†…å®¹å¦‚ä¸‹ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š\n[[inputs.mysql]] servers = [\"root:1234@tcp(localhost:3306)/?tls=false\"] metric_version = 2 gather_global_variables = true interval_slow = \"1m\" tagexclude = [\"innodb_version\"] Any Questions? å¦‚æœé—®é¢˜ä»ç„¶æ²¡æœ‰è§£å†³ï¼Œè¯·åŠ å¾®ä¿¡å…¬ä¼—å·ï¼šcloudmon å…¬ä¼—å·åº•éƒ¨èœå•æœ‰å„ç§ç­”ç–‘æ–¹å¼\n",
    "description": "",
    "tags": null,
    "title": "FAQ",
    "uri": "/faq/"
  },
  {
    "content": " Telegraf Windowsç‰ˆæœ¬çš„å®‰è£…ï¼Œä¿å§†çº§æ•™ç¨‹ - by SL Telegraf Linuxç‰ˆæœ¬çš„å®‰è£…ï¼Œä¿å§†çº§æ•™ç¨‹ - by SL å¼ƒç”¨Prometheusï¼Œæ­å»ºå•æœºç‰ˆæœ¬çš„VictoriaMetrics - by SL ä¸€é”®éƒ¨ç½²å¤œèºåˆ°Kubernetes - by é™¶æŸ’ ä½¿ç”¨Telegrafåšå¤œèº5.0çš„æ•°æ®é‡‡é›†ï¼Œæ ·ä¾‹åŒ…å«LinuxåŸºæœ¬ä¿¡æ¯é‡‡é›†ã€MySQLã€Redisçš„é‡‡é›† - by æŸ´ä»Šæ ‹@è‰¾æ´¾ telegrafå¸¸ç”¨ä¸­é—´ä»¶é‡‡é›† ä¿®æ”¹notify.pyä¸ºå¤œèºå¢åŠ çŸ­ä¿¡é€šçŸ¥èƒ½åŠ› - by æŸ´ä»Šæ ‹@è‰¾æ´¾ ä½¿ç”¨notify.pyæ¥å…¥é˜¿é‡Œäº‘è¯­éŸ³é€šçŸ¥ - by æœ Oracleçš„ç®€å•ç›‘æ§å®ç° - by æŸ´ä»Šæ ‹@è‰¾æ´¾ RocketMQç®€å•ç›‘æ§çš„å®ç° - by æŸ´ä»Šæ ‹@è‰¾æ´¾ æ‰‹æŠŠæ‰‹æ•™ä½ æ¥å…¥é’‰é’‰å‘Šè­¦ ä¸€æ–‡è¯´é€MySQLç›‘æ§ï¼Œä½¿ç”¨Prometheusç”Ÿæ€çš„Exporter Vsphere-monitoræ•°æ®ä¸ŠæŠ¥å¤œèºV5ç›‘æ§ ä½¿ç”¨pgä½œä¸ºæ•°æ®åº“æ›¿æ¢MySQL  ",
    "description": "",
    "tags": null,
    "title": "ç¤¾åŒºç”¨æˆ·å®è·µåˆ†äº«",
    "uri": "/usecase/"
  },
  {
    "content": "",
    "description": "",
    "tags": null,
    "title": "Categories",
    "uri": "/categories/"
  },
  {
    "content": "",
    "description": "",
    "tags": null,
    "title": "Tags",
    "uri": "/tags/"
  },
  {
    "content": "å¤œèºç®€ä»‹  å¤œèºï¼ˆ Nightingale ï¼‰æ˜¯ä¸€æ¬¾å›½äº§å¼€æºã€äº‘åŸç”Ÿç›‘æ§ç³»ç»Ÿï¼ŒNightingale åœ¨ 2020.3.20 å‘å¸ƒ v1 ç‰ˆæœ¬ï¼Œç›®å‰æ˜¯ v5 ç‰ˆæœ¬ï¼Œä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œä¸ Prometheusã€VictoriaMetricsã€Grafanaã€Telegrafã€Datadog ç­‰ç”Ÿæ€åšäº†ååŒé›†æˆï¼ŒåŠ›äº‰æ‰“é€ å›½å†…æœ€å¥½ç”¨çš„å¼€æºè¿ç»´ç›‘æ§ç³»ç»Ÿã€‚å‡ºè‡ª Open-Falcon ç ”å‘å›¢é˜Ÿã€‚\n é¡¹ç›®ä»£ç   åç«¯ï¼šğŸ’¡ https://github.com/didi/nightingale å‰ç«¯ï¼šğŸ’¡ https://github.com/n9e/fe-v5  å‰åç«¯éƒ½æ˜¯å¼€æºçš„ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ star ä¸€ä¸‹ï¼Œç»™æˆ‘ä»¬æŒç»­åšæŒçš„åŠ¨åŠ›ï¼\näº§å“æˆªå›¾ æŸ¥çœ‹ç›‘æ§æ•°æ®ï¼Œå³ç›‘æ§å¤§ç›˜é¡µé¢ï¼š\né…ç½®å‘Šè­¦è§„åˆ™çš„åˆ—è¡¨é¡µé¢ï¼š\næ´»è·ƒå‘Šè­¦åˆ—è¡¨é¡µé¢ï¼Œå³å½“å‰æœªæ¢å¤çš„å‘Šè­¦é¡µé¢ï¼š\näº§å“æ¶æ„ Nightingale æœ‰å››ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š\n Query Proxyï¼šæ‰¿æ¥å‰ç«¯æ—¶åºæ•°æ®æŸ¥è¯¢è¯·æ±‚ï¼Œè½¬å‘ç»™æ—¶åºåº“ï¼Œå¹¶å°†æ—¶åºåº“è¿”å›çš„ç»“æœè¿”å›ç»™å‰ç«¯ Push Gatewayï¼šæ‰¿æ¥å„ç±»é‡‡é›†å®¢æˆ·ç«¯çš„ç›‘æ§æ•°æ®æ¨é€ï¼Œç„¶åæŠŠæ•°æ®è½¬å­˜åˆ°åç«¯å¤šç§æ—¶åºåº“ Conf Managerï¼šé…ç½®ç®¡ç†ï¼Œæ¯”å¦‚å‘Šè­¦è§„åˆ™ã€å±è”½è§„åˆ™ã€è®¢é˜…è§„åˆ™ã€è‡ªæ„ˆè„šæœ¬ã€æƒé™ç­‰ç›¸å…³é…ç½®çš„ç®¡ç† Alerting Engineï¼šå‘Šè­¦å¼•æ“ï¼Œæ ¹æ®ç”¨æˆ·é…ç½®çš„ PromQLï¼ŒæŸ¥è¯¢æ—¶åºåº“ï¼Œåˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘å‘Šè­¦å¹¶å‘é€  ç³»ç»Ÿæ¶æ„ å¤œèº v5 çš„è®¾è®¡éå¸¸ç®€å•ï¼Œæ ¸å¿ƒæ˜¯ server å’Œ webapi ä¸¤ä¸ªæ¨¡å—ï¼Œwebapi æ— çŠ¶æ€ï¼Œæ”¾åˆ°ä¸­å¿ƒç«¯ï¼Œæ‰¿æ¥å‰ç«¯è¯·æ±‚ï¼Œå°†ç”¨æˆ·é…ç½®å†™å…¥æ•°æ®åº“ï¼›server æ˜¯å‘Šè­¦å¼•æ“å’Œæ•°æ®è½¬å‘æ¨¡å—ï¼Œä¸€èˆ¬éšç€æ—¶åºåº“èµ°ï¼Œä¸€ä¸ªæ—¶åºåº“å°±å¯¹åº”ä¸€å¥— serverï¼Œæ¯å¥— server å¯ä»¥åªç”¨ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå¯ä»¥å¤šä¸ªå®ä¾‹ç»„æˆé›†ç¾¤ï¼Œserver å¯ä»¥æ¥æ”¶ Telegrafã€Grafana-Agentã€Datadog-Agentã€Falcon-Plugins ä¸ŠæŠ¥çš„æ•°æ®ï¼Œå†™å…¥åç«¯æ—¶åºåº“ï¼Œå‘¨æœŸæ€§ä»æ•°æ®åº“åŒæ­¥å‘Šè­¦è§„åˆ™ï¼Œç„¶åæŸ¥è¯¢æ—¶åºåº“åšå‘Šè­¦åˆ¤æ–­ã€‚æ¯å¥— server ä¾èµ–ä¸€ä¸ª redisã€‚æ¶æ„å›¾å¦‚ä¸‹ï¼š\näº§å“å¯¹æ¯” ä¸ Open-Falcon çš„åŒºåˆ« å› ä¸ºå¼€å‘ Open-Falcon å’Œ Nightingale çš„æ˜¯ä¸€æ‹¨äººï¼Œæ‰€ä»¥å¾ˆå¤šç¤¾åŒºä¼™ä¼´ä¼šæ¯”è¾ƒå¥½å¥‡ï¼Œä¸ºä½•è¦æ–°åšä¸€ä¸ªç›‘æ§å¼€æºè½¯ä»¶ã€‚æ ¸å¿ƒç‚¹æ˜¯ Open-Falcon å’Œ Nightingale çš„å·®å¼‚ç‚¹å®åœ¨æ˜¯å¤ªå¤§äº†ï¼ŒNightingale å¹¶éæ˜¯ Open-Falcon è®¾è®¡é€»è¾‘çš„ä¸€ä¸ªå»¶ç»­ï¼Œå°±çœ‹åšä¸¤ä¸ªä¸åŒçš„è½¯ä»¶å°±å¥½ã€‚\nOpen-Falcon æ˜¯ 14 å¹´å¼€å‘çš„ï¼Œå½“æ—¶æ˜¯æƒ³è§£å†³ Zabbix çš„ä¸€äº›å®¹é‡é—®é¢˜ï¼Œå¯ä»¥çœ‹åšæ˜¯ç‰©ç†æœºæ—¶ä»£çš„äº§ç‰©ï¼Œæ•´ä¸ªè®¾è®¡åå‘è¿ç»´è§†è§’ï¼Œè™½ç„¶æ•°æ®ç»“æ„ä¸Šå·²ç»å¼€å§‹è®¾è®¡äº†æ ‡ç­¾ï¼Œä½†æ˜¯æŸ¥è¯¢è¯­æ³•è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œæ— æ³•åº”å¯¹æ¯”è¾ƒå¤æ‚çš„åœºæ™¯ã€‚\nNightingale ç›´æ¥æ”¯æŒ PromQLï¼Œæ”¯æŒ Prometheusã€M3DBã€VictoriaMetrics å¤šç§æ—¶åºåº“ï¼Œæ”¯æŒ Telegrafã€Datadog-Agentã€Grafana-Agent åšç›‘æ§æ•°æ®é‡‡é›†ï¼Œæ”¯æŒ Grafana çœ‹å›¾ï¼Œæ•´ä¸ªè®¾è®¡æ›´åŠ äº‘åŸç”Ÿã€‚\nä¸ Prometheus çš„åŒºåˆ« Nightingale å¯ä»¥ç®€å•çœ‹åšæ˜¯ Prometheus çš„ä¸€ä¸ªä¼ä¸šçº§ç‰ˆæœ¬ï¼ŒæŠŠ Prometheus å½“åš Nightingale çš„ä¸€ä¸ªå†…éƒ¨ç»„ä»¶ï¼ˆæ—¶åºåº“ï¼‰ï¼Œå½“ç„¶ï¼Œä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œæ—¶åºåº“é™¤äº† Prometheusï¼Œè¿˜å¯ä»¥ä½¿ç”¨ VictoriaMetricsã€M3DB ç­‰ï¼Œå„ç§ Exporter é‡‡é›†å™¨ä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚\nNightingale å¯ä»¥æ¥å…¥å¤šä¸ª Prometheusï¼Œå¯ä»¥å…è®¸ç”¨æˆ·åœ¨é¡µé¢ä¸Šé…ç½®å‘Šè­¦è§„åˆ™ã€å±è”½è§„åˆ™ã€è®¢é˜…è§„åˆ™ï¼Œåœ¨é¡µé¢ä¸ŠæŸ¥çœ‹å‘Šè­¦äº‹ä»¶ã€åšå‘Šè­¦äº‹ä»¶èšåˆç»Ÿè®¡ï¼Œé…ç½®å‘Šè­¦è‡ªæ„ˆæœºåˆ¶ï¼Œç®¡ç†ç›‘æ§å¯¹è±¡ï¼Œé…ç½®ç›‘æ§å¤§ç›˜ç­‰ï¼Œå°±æŠŠ Nightingale çœ‹åšæ˜¯ Prometheus çš„ä¸€ä¸ª WEBUI ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡å®é™…ä¸Šï¼Œå®ƒè¿œè¿œä¸æ­¢æ˜¯ä¸€ä¸ª WEBUIï¼Œç”¨ä¸€ä¸‹å°±ä¼šæ·±æœ‰æ„Ÿè§¦ã€‚\nåŠ å…¥ç¤¾åŒº å¾®ä¿¡å…¬ä¼—å·:cloudmonï¼ˆäº‘åŸç”Ÿç›‘æ§ï¼‰è¿™æ˜¯å¤œèºçš„å¤§æœ¬è¥ï¼Œå¯ä»¥åœ¨å…¬ä¼—å·èœå•é‡Œæ‰¾åˆ°åŠ ç¾¤å…¥å£ã€ç¤¾åŒºç­”ç–‘å…¥å£ï¼Œå…³æ³¨èµ·æ¥å§ï¼æˆ‘ä»¬å›¢é˜Ÿåšè¿ç»´ç›‘æ§è¿™ä¸ªäº‹æƒ…å·®ä¸å¤šæœ‰ 10 å¹´äº†ï¼Œä¸€ç›´åœ¨åšæŒï¼Œå¸Œæœ›èƒ½æŠŠè¿™ä¸ªäº‹åšåˆ°æè‡´ï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬ä¸€èµ·ï¼\n",
    "description": "",
    "tags": null,
    "title": "å¤œèºæ‰‹å†Œ",
    "uri": "/"
  }
]
